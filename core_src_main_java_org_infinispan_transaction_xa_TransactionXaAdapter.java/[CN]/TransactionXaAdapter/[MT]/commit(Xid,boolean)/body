{
  Xid xid=convertXid(externalXid);
  LocalXaTransaction localTransaction=getLocalTransactionAndValidate(xid);
  if (trace)   log.trace("Committing transaction %s",localTransaction.getGlobalTransaction());
  try {
    txCoordinator.commit(localTransaction,isOnePhase);
    forgetSuccessfullyCompletedTransaction(recoveryManager,xid,localTransaction);
  }
  finally {
    cleanupImpl(localTransaction,txTable,icc);
  }
}
