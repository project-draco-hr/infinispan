{
  Xid xid=convertXid(externalXid);
  LocalXaTransaction localTransaction=getLocalTransactionAndValidate(xid);
  if (isOnePhase && onePhaseTotalOrder) {
    txCoordinator.commit(localTransaction,true);
  }
 else   if (isOnePhase) {
    txCoordinator.prepare(localTransaction);
    txCoordinator.commit(localTransaction,false);
  }
 else {
    txCoordinator.commit(localTransaction,false);
  }
  forgetSuccessfullyCompletedTransaction(recoveryManager,xid,localTransaction);
}
