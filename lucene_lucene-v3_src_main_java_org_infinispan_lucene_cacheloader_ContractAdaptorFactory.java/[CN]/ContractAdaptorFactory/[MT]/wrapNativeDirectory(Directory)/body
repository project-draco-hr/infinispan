{
  if (LuceneVersionDetector.VERSION == 3) {
    return new DirectoryV3Adaptor(directory);
  }
 else {
    Class<?>[] ctorType=new Class[]{Directory.class};
    InternalDirectoryContract idc;
    try {
      idc=(InternalDirectoryContract)ContractAdaptorFactory.class.getClassLoader().loadClass("org.infinispan.lucene.cacheloader.DirectoryV4Adaptor").getConstructor(ctorType).newInstance(directory);
    }
 catch (    Exception e) {
      throw log.failedToCreateLucene4Directory(e);
    }
    return idc;
  }
}
