{
  command.setOrigin(origin);
  boolean accepted=matcher.accept(command);
  StateSequencerUtil.advanceMultiple(stateSequencer,accepted,statesBefore);
  try {
    handler.handle(command,origin,response,preserveOrder);
  }
  finally {
    StateSequencerUtil.advanceMultiple(stateSequencer,accepted,statesAfter);
  }
}
