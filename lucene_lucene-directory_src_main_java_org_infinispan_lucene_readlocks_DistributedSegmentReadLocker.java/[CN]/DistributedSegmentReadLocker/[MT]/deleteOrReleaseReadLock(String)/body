{
  FileReadLockKey readLockKey=new FileReadLockKey(indexName,filename);
  int newValue=0;
  boolean done=false;
  Object lockValue=locksCache.get(readLockKey);
  while (done == false) {
    if (lockValue == null) {
      lockValue=locksCache.putIfAbsent(readLockKey,0);
      done=(null == lockValue);
    }
 else {
      Integer refCountObject=(Integer)lockValue;
      int refCount=refCountObject.intValue();
      newValue=refCount - 1;
      done=locksCache.replace(readLockKey,refCountObject,newValue);
      if (!done) {
        lockValue=locksCache.get(readLockKey);
      }
    }
  }
  if (newValue == 0) {
    realFileDelete(readLockKey,locksCache,chunksCache,metadataCache,forceSynchronousDeletes);
  }
}
