{
  super(null);
  final ClassLoader cl=OsgiClassLoader.class.getClassLoader();
  if ((cl != null) && cl.getClass().getName().equals("org.osgi.framework.BundleReference")) {
    final BundleContext bundleContext=((BundleReference)OsgiClassLoader.class.getClassLoader()).getBundle().getBundleContext();
    Bundle[] foundBundles=bundleContext.getBundles();
    bundles=new ArrayList<WeakReference<Bundle>>(foundBundles.length);
    for (    Bundle foundBundle : foundBundles) {
      bundles.add(new WeakReference<Bundle>(foundBundle));
    }
  }
 else {
    bundles=Collections.EMPTY_LIST;
  }
}
