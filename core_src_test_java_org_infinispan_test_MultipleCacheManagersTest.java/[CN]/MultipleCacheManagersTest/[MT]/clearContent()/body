{
  if (cleanup == CleanupPhase.AFTER_TEST) {
    log.debug("*** Test method complete; clearing contents on all caches.");
    if (cacheManagers.isEmpty())     throw new IllegalStateException("No caches registered! Use registerCacheManager(Cache... caches) do that!");
    for (    EmbeddedCacheManager cacheManager : cacheManagers) {
      TestingUtil.clearContent(cacheManager);
    }
  }
 else {
    TestingUtil.killCacheManagers(cacheManagers);
    cacheManagers.clear();
  }
}
