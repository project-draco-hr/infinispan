{
  Configuration c=getCache(0,cacheName).getConfiguration();
  if (c.getCacheMode().isReplicated() || c.getCacheMode().isInvalidation()) {
    return getCache(0,cacheName);
  }
 else {
    if (!c.getCacheMode().isDistributed())     throw new IllegalStateException("This is not a clustered cache!");
    final Address address=getCache(0,cacheName).getAdvancedCache().getDistributionManager().locate(key).get(0);
    for (    Cache cache : caches(cacheName)) {
      if (cache.getAdvancedCache().getRpcManager().getTransport().getAddress().equals(address)) {
        return cache;
      }
    }
    throw new IllegalStateException();
  }
}
