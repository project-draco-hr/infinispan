{
  if (ctx.isInTxScope() && !isLocalModeForced(ctx)) {
    if (modifications == null || modifications.isEmpty())     return;
    InvalidationFilterVisitor filterVisitor=new InvalidationFilterVisitor(modifications.size());
    filterVisitor.visitCollection(null,modifications);
    if (filterVisitor.containsPutForExternalRead) {
      log.debug("Modification list contains a putForExternalRead operation.  Not invalidating.");
    }
 else {
      try {
        invalidateAcrossCluster(defaultSynchronous,ctx,filterVisitor.result.toArray(),false,null);
      }
 catch (      Throwable t) {
        log.warn("Unable to broadcast evicts as a part of the prepare phase.  Rolling back.",t);
        if (t instanceof RuntimeException)         throw (RuntimeException)t;
 else         throw new RuntimeException("Unable to broadcast invalidation messages",t);
      }
    }
  }
}
