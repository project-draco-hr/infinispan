{
  Transport transport=getTransport(key,true);
  int retryCount=0;
  do {
    try {
      short status=sendPutOperation(key,value,transport,PUT_IF_ABSENT_REQUEST,PUT_IF_ABSENT_RESPONSE,lifespan,maxIdle,flags);
      if (status == NO_ERROR_STATUS || status == NOT_PUT_REMOVED_REPLACED_STATUS) {
        byte[] bytes=returnPossiblePrevValue(transport,flags);
        if (log.isTraceEnabled()) {
          log.trace("Returning from putIfAbsent: " + Util.printArray(bytes,false));
        }
        return bytes;
      }
    }
 catch (    TransportException te) {
      logErrorAndThrowExceptionIfNeeded(retryCount,te);
    }
 finally {
      releaseTransport(transport);
    }
    if (shouldRetry(retryCount)) {
      transport=getTransport(key,false);
    }
    retryCount++;
  }
 while (shouldRetry(retryCount));
  throw new IllegalStateException("We should not reach here!");
}
