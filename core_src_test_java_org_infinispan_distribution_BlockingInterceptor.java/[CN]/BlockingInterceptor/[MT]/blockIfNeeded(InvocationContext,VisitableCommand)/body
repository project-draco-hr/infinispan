{
  if (commandClass.isInstance(command) && (!originLocalOnly || ctx.isOriginLocal())) {
    if (firstBlocked.compareAndSet(false,true)) {
      try {
        log.tracef("Command blocking %s completion of %s",blockAfter ? "after" : "before",command);
        barrier.await();
        barrier.await();
        log.tracef("Command completed blocking completion of %s",command);
      }
  finally {
        firstBlocked.set(false);
      }
    }
 else {
      log.trace("Command arrived but already found a blocker");
    }
  }
}
