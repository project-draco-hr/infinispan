{
  if (commandClass.isInstance(command)) {
    if (firstBlocked.compareAndSet(false,true)) {
      try {
        getLog().tracef("Command blocking %s completion of %s",blockAfter ? "after" : "before",command);
        barrier.await();
        barrier.await();
        getLog().tracef("Command completed blocking completion of %s",command);
      }
  finally {
        firstBlocked.set(false);
      }
    }
 else {
      getLog().trace("Command arrived but already found a blocker");
    }
  }
}
