{
  PerThreadInstanceHolder instanceHolder=marshallerTL.get();
  if (instanceHolder == null) {
    return factory.createMarshaller(baseCfg);
  }
  if (isReentrant) {
    MarshallingConfiguration customConfiguration=instanceHolder.threadDedicatedConfiguration;
    customConfiguration.setBufferSize(estimatedSize);
    return factory.createMarshaller(customConfiguration);
  }
 else {
    return instanceHolder.reusableMarshaller;
  }
}
