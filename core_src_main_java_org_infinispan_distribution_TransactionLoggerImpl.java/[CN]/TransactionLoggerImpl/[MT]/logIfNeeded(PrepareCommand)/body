{
  if (command.isOnePhaseCommit()) {
    if (enabled) {
      loggingLock.readLock().lock();
      try {
        if (enabled) {
          if (trace)           log.trace("Logging 1PC prepare for tx {0}",command.getGlobalTransaction());
          logModificationsInTransaction(command);
        }
      }
  finally {
        loggingLock.readLock().unlock();
      }
    }
  }
 else {
    if (trace)     log.trace("Logging 2PC prepare for tx {0}",command.getGlobalTransaction());
    uncommittedPrepares.put(command.getGlobalTransaction(),command);
  }
}
