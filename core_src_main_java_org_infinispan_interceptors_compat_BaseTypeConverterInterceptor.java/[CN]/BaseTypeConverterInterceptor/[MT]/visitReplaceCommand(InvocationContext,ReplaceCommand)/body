{
  Object key=command.getKey();
  TypeConverter<Object,Object,Object,Object> converter=determineTypeConverter(command.getFlags());
  Object oldValue=command.getOldValue();
  if (ctx.isOriginLocal()) {
    command.setKey(converter.boxKey(key));
    command.setOldValue(converter.boxValue(oldValue));
    command.setNewValue(converter.boxValue(command.getNewValue()));
  }
  addVersionIfNeeded(command);
  Object ret=ctx.forkInvocationSync(command);
  if (oldValue != null && ret instanceof Boolean)   return ctx.shortCircuit(ret);
  return ctx.shortCircuit(converter.unboxValue(ret));
}
