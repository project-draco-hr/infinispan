{
  if (ch == null) {
    if (withTopology)     ch=new TopologyAwareConsistentHash();
 else     ch=new DefaultConsistentHash();
  }
  if (ch instanceof AbstractWheelConsistentHash) {
    AbstractWheelConsistentHash wch=(AbstractWheelConsistentHash)ch;
    wch.setHashFunction(hashFunction);
    wch.setNumVirtualNodes(numVirtualNodes);
  }
  if (ch instanceof AbstractConsistentHash) {
    AbstractConsistentHash ach=(AbstractConsistentHash)ch;
    if (groupManager != null)     ach.setGroupManager(groupManager);
  }
  return ch;
}
