{
  try {
    JAXBContext jc=JAXBContext.newInstance(InfinispanConfiguration.class);
    Unmarshaller u=jc.createUnmarshaller();
    String s=System.getProperty(VALIDATING_SYSTEM_PROPERTY);
    boolean isValidatingOff=s != null && !Boolean.parseBoolean(s);
    if (schema != null && !isValidatingOff) {
      SchemaFactory factory=SchemaFactory.newInstance("http://www.w3.org/2001/XMLSchema");
      u.setSchema(factory.newSchema(new StreamSource(schema)));
    }
    InfinispanConfiguration doc=(InfinispanConfiguration)u.unmarshal(config);
    doc.parseGlobalConfiguration().setDefaultConfiguration(doc.parseDefaultConfiguration());
    return doc;
  }
 catch (  Exception e) {
    IOException ioe=new IOException(e.getLocalizedMessage());
    ioe.initCause(e);
    throw ioe;
  }
}
