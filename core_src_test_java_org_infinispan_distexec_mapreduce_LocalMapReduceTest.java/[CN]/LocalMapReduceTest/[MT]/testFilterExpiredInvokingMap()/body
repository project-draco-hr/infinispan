{
  String cacheName="expiredResultCache";
  ConfigurationBuilder builder=getDefaultClusteredCacheConfig(CacheMode.LOCAL,true);
  defineConfigurationOnAllManagers(cacheName,builder);
  Cache<String,String> c1=cache(0,cacheName());
  try {
    final long lifespan=EXPIRATION_TIMEOUT;
    final long startTime=now();
    Map<String,String> dataIn=getDataIn();
    Collection<String> valuesIn=dataIn.values();
    c1.putAll(dataIn,lifespan,MILLISECONDS);
    expectCachedAndThenExpired(c1,valuesIn,startTime,lifespan);
    WordCountMapper mapper=new WordCountMapper();
    WordCountReducer reducer=new WordCountReducer();
    MapReduceTask<String,String,String,Integer> task=createMapReduceTask(c1);
    task.mappedWith(mapper).reducedWith(reducer);
    Map<String,Integer> result=task.execute();
    assertEquals(0,result.size());
  }
  finally {
    c1.clear();
    removeCacheFromCluster(cacheName);
  }
}
