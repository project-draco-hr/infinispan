{
  Map<Address,List<T>> addressToKey=new HashMap<Address,List<T>>();
  for (  T key : keysToMap) {
    Address ownerOfKey=null;
    if (useIntermediateCompositeKey) {
      ownerOfKey=dm.getPrimaryLocation(new IntermediateCompositeKey<T>(taskId,key));
    }
 else {
      ownerOfKey=dm.getPrimaryLocation(key);
    }
    List<T> keysAtNode=addressToKey.get(ownerOfKey);
    if (keysAtNode == null) {
      keysAtNode=new ArrayList<T>();
      addressToKey.put(ownerOfKey,keysAtNode);
    }
    keysAtNode.add(key);
  }
  return addressToKey;
}
