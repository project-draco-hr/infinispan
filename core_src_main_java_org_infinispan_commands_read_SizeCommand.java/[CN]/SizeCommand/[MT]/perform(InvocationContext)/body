{
  int size=0;
  Map<Object,CacheEntry> contextEntries=ctx.getLookedUpEntries();
  Set<Object> keys=new HashSet<>();
  try (CloseableIterable<CacheEntry<Object,Void>> iterator=cache.getAdvancedCache().withFlags(flags != null ? flags.toArray(new Flag[flags.size()]) : null).filterEntries(AcceptAllKeyValueFilter.getInstance()).converter(NullValueConverter.getInstance())){
    for (    CacheEntry<Object,Void> entry : iterator) {
      CacheEntry value=contextEntries.get(entry.getKey());
      if (value != null) {
        keys.add(entry.getKey());
        if (!value.isRemoved()) {
          size++;
        }
      }
 else {
        size++;
      }
    }
  }
   for (  Map.Entry<Object,CacheEntry> entry : contextEntries.entrySet()) {
    if (!keys.contains(entry.getKey()) && !entry.getValue().isRemoved()) {
      size++;
    }
  }
  return size;
}
