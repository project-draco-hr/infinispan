{
  final CacheViewInfo cacheViewInfo=viewsInfo.get(cacheName);
  final CacheView committedView=cacheViewInfo.getCommittedView();
  final CacheViewControlCommand cmd=new CacheViewControlCommand(cacheName,CacheViewControlCommand.Type.PREPARE_VIEW,self,pendingView.getViewId(),pendingView.getMembers(),committedView.getViewId(),committedView.getMembers());
  Set<Address> leavers=cacheViewInfo.getPendingChanges().getLeavers();
  if (pendingView.containsAny(leavers))   throw new IllegalStateException("Cannot prepare view " + pendingView + ", some nodes already left the cluster: "+ leavers);
  Future<Map<Address,Response>> future=asyncTransportExecutor.submit(new Callable<Map<Address,Response>>(){
    @Override public Map<Address,Response> call() throws Exception {
      Map<Address,Response> rspList=transport.invokeRemotely(pendingView.getMembers(),cmd,ResponseMode.SYNCHRONOUS,timeout,false,null,false);
      return rspList;
    }
  }
);
  handlePrepareView(cacheName,pendingView,committedView);
  Map<Address,Response> rspList=future.get(timeout,TimeUnit.MILLISECONDS);
  checkRemoteResponse(cacheName,cmd,rspList);
  return pendingView;
}
