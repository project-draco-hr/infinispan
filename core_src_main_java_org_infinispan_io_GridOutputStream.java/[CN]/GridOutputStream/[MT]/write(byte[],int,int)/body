{
  while (len > 0) {
    int remaining=getBytesRemainingInChunk();
    if (remaining == 0) {
      flush();
      local_index=0;
      remaining=chunk_size;
    }
    int bytes_to_write=Math.min(remaining,len);
    System.arraycopy(b,off,current_buffer,local_index,bytes_to_write);
    off+=bytes_to_write;
    len-=bytes_to_write;
    local_index+=bytes_to_write;
    index+=bytes_to_write;
  }
}
