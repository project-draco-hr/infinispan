{
  assertIsEmpty();
  long lifespan=200000;
  long idle=120000;
  InternalCacheEntry se=TestInternalCacheEntryFactory.create("k",wrap("k","v"),lifespan,idle);
  InternalCacheValue icv=se.toInternalCacheValue();
  assertEquals(se.getCreated(),icv.getCreated());
  assertEquals(se.getLastUsed(),icv.getLastUsed());
  cl.write(marshalledEntry(se));
  assertContains("k",true);
  MarshalledEntry ice=cl.load("k");
  assertCorrectExpiry(ice,"v",lifespan,idle,false);
  assertCorrectExpiry(TestingUtil.allEntries(cl).iterator().next(),"v",lifespan,idle,false);
  idle=1;
  se=TestInternalCacheEntryFactory.create("k",wrap("k","v"),lifespan,idle);
  cl.write(marshalledEntry(se));
  Thread.sleep(100);
  purgeExpired(Collections.singleton("k"),10000);
  assertExpired(se,true);
  assertEventuallyExpires("k");
  assertContains("k",false);
  assertIsEmpty();
}
