{
  for (  CacheTransaction tx : transactions) {
    Set<Object> lockedKeys=new HashSet<Object>();
    for (    Object key : tx.getLockedKeys()) {
      if (segments.contains(readCh.getSegment(key))) {
        lockedKeys.add(key);
      }
    }
    for (    Object key : tx.getBackupLockedKeys()) {
      if (segments.contains(readCh.getSegment(key))) {
        lockedKeys.add(key);
      }
    }
    if (!lockedKeys.isEmpty()) {
      List<WriteCommand> txModifications=tx.getModifications();
      WriteCommand[] modifications=null;
      if (txModifications != null) {
        modifications=txModifications.toArray(new WriteCommand[txModifications.size()]);
      }
      transactionsToTransfer.add(new TransactionInfo(tx.getGlobalTransaction(),tx.getViewId(),modifications,lockedKeys));
    }
  }
}
