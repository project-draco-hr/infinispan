{
  MVCCEntry e=(MVCCEntry)ctx.lookupEntry(key);
  if (e != null) {
    if (ctx.isOriginLocal()) {
      if (e.isNull() || e.getValue() == null) {
        e.setChanged(false);
        return returnValue(null,false,ctx);
      }
    }
    if (oldValue == null || oldValue.equals(e.getValue()) || ignorePreviousValue) {
      e.setChanged(true);
      Object old=e.setValue(newValue);
      e.setLifespan(lifespanMillis);
      e.setMaxIdle(maxIdleTimeMillis);
      return returnValue(old,true,ctx);
    }
    e.setChanged(false);
  }
  return returnValue(null,false,ctx);
}
