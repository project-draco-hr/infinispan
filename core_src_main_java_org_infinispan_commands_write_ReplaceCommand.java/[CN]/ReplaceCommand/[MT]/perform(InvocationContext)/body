{
  MVCCEntry e=(MVCCEntry)ctx.lookupEntry(key);
  if (e != null) {
    if (ctx.isOriginLocal()) {
      if (e.isNull() || e.getValue() == null)       return returnValue(null,false,ctx);
      if (oldValue == null || oldValue.equals(e.getValue())) {
        Object old=e.setValue(newValue);
        e.setLifespan(lifespanMillis);
        e.setMaxIdle(maxIdleTimeMillis);
        return returnValue(old,true,ctx);
      }
      return returnValue(null,false,ctx);
    }
 else {
      Object old=e.setValue(newValue);
      e.setLifespan(lifespanMillis);
      e.setMaxIdle(maxIdleTimeMillis);
      return returnValue(old,true,ctx);
    }
  }
  return returnValue(null,false,ctx);
}
