{
  MVCCEntry e=(MVCCEntry)ctx.lookupEntry(key);
  if (e != null) {
    if (ctx.isOriginLocal()) {
      if (e.isNull() || e.getValue() == null || e.isRemoved()) {
        return returnValue(null,false,ctx);
      }
    }
 else {
      if (isConditional() && ctx.isInTxScope()) {
        if (ignorePreviousValue) {
          e.setChanged(true);
          Object old=e.setValue(newValue);
          return returnValue(old,true,ctx);
        }
 else {
          return returnValue(null,false,ctx);
        }
      }
    }
    if (oldValue == null || isValueEquals(oldValue,e.getValue()) || ignorePreviousValue) {
      e.setChanged(true);
      Object old=e.setValue(newValue);
      return returnValue(old,true,ctx);
    }
  }
  return returnValue(null,false,ctx);
}
