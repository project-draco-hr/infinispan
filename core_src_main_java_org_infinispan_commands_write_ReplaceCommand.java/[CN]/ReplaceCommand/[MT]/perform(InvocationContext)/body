{
  if (valueMatcher == ValueMatcher.MATCH_NEVER) {
    successful=false;
    return null;
  }
  MVCCEntry e=(MVCCEntry)ctx.lookupEntry(key);
  if (valueMatcher.matches(e,oldValue,newValue,valueEquivalence)) {
    e.setChanged(true);
    Object old=e.setValue(newValue);
    if (valueMatcher != ValueMatcher.MATCH_EXPECTED_OR_NEW) {
      return returnValue(old,true,ctx);
    }
 else {
      return returnValue(oldValue,true,ctx);
    }
  }
  return returnValue(null,false,ctx);
}
