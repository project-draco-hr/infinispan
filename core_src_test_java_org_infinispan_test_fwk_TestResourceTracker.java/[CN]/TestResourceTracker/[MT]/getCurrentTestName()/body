{
  String testName=threadTestName.get();
  if (testName == null) {
    String threadName=Thread.currentThread().getName();
    String pattern="TestNGInvoker-";
    if (threadName.startsWith(pattern)) {
      throw new IllegalStateException("Test name is not set! Please call TestResourceTracker.testStarted(this) in your test method!");
    }
 else     if (Thread.currentThread().getName().equals("main")) {
      testName="main";
    }
 else {
      log.warnf("Test name not set in unknown thread %s",Thread.currentThread().getName());
      testName="unknown";
    }
  }
  return testName;
}
