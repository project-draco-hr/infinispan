{
  if (txLockLatch.await(0,TimeUnit.MILLISECONDS)) {
    if (txLock.readLock().tryLock(0,TimeUnit.MILLISECONDS)) {
      if (trace)       log.tracef("Acquired shared state transfer shared lock, remaining holders: %d",txLock.getReadLockCount());
      return true;
    }
  }
  if (!ctx.isOriginLocal())   return false;
  boolean hasAcquiredLocks=ctx.getLockedKeys().size() > 0;
  long timeout=hasAcquiredLocks ? lockTimeout / 100 : lockTimeout;
  long endTime=System.currentTimeMillis() + timeout;
  while (true) {
    if (!txLockLatch.await(timeout,TimeUnit.MILLISECONDS))     return false;
    if (txLock.readLock().tryLock(0,TimeUnit.MILLISECONDS)) {
      if (trace)       log.tracef("Acquired shared state transfer shared lock, remaining holders: %d",txLock.getReadLockCount());
      return true;
    }
    timeout=endTime - System.currentTimeMillis();
    if (timeout < 0)     return false;
  }
}
