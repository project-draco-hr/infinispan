{
  cache1.put("key","value");
  ReplicationQueue replicationQueue=TestingUtil.extractComponent(cache1,ReplicationQueue.class);
  assertNotNull(replicationQueue);
  assertEquals(1,replicationQueue.getElementsCount());
  assertNull(cache2.get("key"));
  assertEquals("value",cache1.get("key"));
  replicationQueue.flush();
  eventually(new Condition(){
    @Override public boolean isSatisfied() throws Exception {
      return cache2.get("key") != null;
    }
  }
);
  assertEquals(cache2.get("key"),"value");
  assertEquals(0,replicationQueue.getElementsCount());
}
