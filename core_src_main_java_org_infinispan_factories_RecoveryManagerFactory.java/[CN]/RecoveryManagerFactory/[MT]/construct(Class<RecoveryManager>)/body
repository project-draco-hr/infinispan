{
  boolean recoveryEnabled=configuration.transaction().recovery().enabled() && !configuration.transaction().useSynchronization();
  if (recoveryEnabled) {
    String recoveryCacheName=configuration.transaction().recovery().recoveryInfoCacheName();
    log.tracef("Using recovery cache name %s",recoveryCacheName);
    EmbeddedCacheManager cm=componentRegistry.getGlobalComponentRegistry().getComponent(EmbeddedCacheManager.class);
    boolean useDefaultCache=recoveryCacheName.equals(RecoveryConfiguration.DEFAULT_RECOVERY_INFO_CACHE);
    if (!useDefaultCache) {
      if (!cm.getCacheNames().contains(recoveryCacheName)) {
        throw new ConfigurationException("Recovery cache (" + recoveryCacheName + ") does not exist!!");
      }
    }
 else {
      if (!cm.getCacheNames().contains(recoveryCacheName)) {
        Configuration config=getDefaultRecoveryCacheConfig();
        cm.defineConfiguration(recoveryCacheName,config);
      }
    }
    return (RecoveryManager)buildRecoveryManager(componentRegistry.getCacheName(),recoveryCacheName,cm,useDefaultCache);
  }
 else {
    return null;
  }
}
