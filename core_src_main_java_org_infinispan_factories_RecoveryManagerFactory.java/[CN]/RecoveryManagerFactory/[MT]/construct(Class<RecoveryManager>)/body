{
  checkAsyncCache(configuration);
  boolean recoveryEnabled=configuration.isTransactionRecoveryEnabled();
  String cacheName=configuration.getName() == null ? CacheContainer.DEFAULT_CACHE_NAME : configuration.getName();
  if (recoveryEnabled) {
    String recoveryCacheName=configuration.getTransactionRecoveryCacheName();
    if (log.isTraceEnabled())     log.trace("Using recovery cache name %s",recoveryCacheName);
    EmbeddedCacheManager cm=componentRegistry.getGlobalComponentRegistry().getComponent(EmbeddedCacheManager.class);
    boolean useDefaultCache=recoveryCacheName.equals(Configuration.RecoveryType.DEFAULT_RECOVERY_INFO_CACHE);
    if (!useDefaultCache) {
      if (!cm.getCacheNames().contains(recoveryCacheName)) {
        throw new ConfigurationException("Recovery cache (" + recoveryCacheName + ") does not exist!!");
      }
    }
 else {
      if (!cm.getCacheNames().contains(recoveryCacheName)) {
        Configuration config=getDefaultRecoveryCacheConfig();
        cm.defineConfiguration(recoveryCacheName,config);
      }
    }
    return (RecoveryManager)buildRecoveryManager(cacheName,recoveryCacheName,cm,useDefaultCache);
  }
 else {
    return null;
  }
}
