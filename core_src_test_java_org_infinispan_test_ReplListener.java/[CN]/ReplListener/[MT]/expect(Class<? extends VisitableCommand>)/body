{
  expectationSetupLock.lock();
  try {
    if (this.expectedCommands == null) {
      this.expectedCommands=new LinkedList<Class<? extends VisitableCommand>>();
    }
    this.expectedCommands.addAll(Arrays.asList(expectedCommands));
    log.trace("Setting expected commands to {0}",this.expectedCommands);
    log.trace("Record eagerly is {0}, and eager commands are {1}",recordCommandsEagerly,eagerCommands);
    if (recordCommandsEagerly) {
      this.expectedCommands.removeAll(eagerCommands);
      if (!eagerCommands.isEmpty())       sawAtLeastOneInvocation=true;
      eagerCommands.clear();
    }
  }
  finally {
    expectationSetupLock.unlock();
  }
}
