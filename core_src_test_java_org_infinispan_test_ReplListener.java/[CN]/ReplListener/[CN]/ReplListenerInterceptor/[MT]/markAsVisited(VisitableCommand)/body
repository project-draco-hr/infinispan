{
  if (expectedCommands != null) {
    expectedCommands.remove(cmd.getClass());
    if (expectedCommands.isEmpty())     latch.countDown();
  }
 else {
    if (recordCommandsEagerly) {
      eagerCommands.add(cmd.getClass());
    }
 else {
      System.out.println("Received unexpected command: " + cmd);
    }
  }
}
