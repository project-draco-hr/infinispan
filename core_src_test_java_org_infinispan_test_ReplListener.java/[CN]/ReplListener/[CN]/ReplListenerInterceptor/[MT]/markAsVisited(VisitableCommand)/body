{
  if (expectedCommands != null) {
    expectedCommands.remove(cmd.getClass());
    if (expectedCommands.isEmpty())     latch.countDown();
  }
 else {
    if (recordCommandsEagerly) {
      eagerCommandsLock.lock();
      try {
        eagerCommands.add(cmd.getClass());
      }
  finally {
        eagerCommandsLock.unlock();
      }
    }
 else {
      System.out.println("Received unexpected command: " + cmd);
    }
  }
}
