{
  TransactionManager transactionManager=null;
  TransactionManagerLookup lookup=configuration.getTransactionManagerLookup();
  if (lookup == null) {
    if (configuration.getTransactionManagerLookupClass() != null) {
      lookup=instantiateLookup(configuration.getTransactionManagerLookupClass());
    }
  }
  if (lookup != null) {
    transactionManager=extractTxManager(lookup);
  }
  if (transactionManager == null && configuration.isInvocationBatchingEnabled()) {
    log.info("Using a batchMode transaction manager");
    transactionManager=BatchModeTransactionManager.getInstance();
  }
  if (configuration.isTransactionalCache() && transactionManager == null) {
    log.noTransactionManagerLookupForTransactionalCache();
    try {
      final TransactionManagerLookup transactionManagerLookup=instantiateLookup(GenericTransactionManagerLookup.class.getName());
      transactionManager=extractTxManager(transactionManagerLookup);
    }
 catch (    Exception e) {
      throw new CacheException("Could not find a transaction manager",e);
    }
  }
  return componentType.cast(transactionManager);
}
