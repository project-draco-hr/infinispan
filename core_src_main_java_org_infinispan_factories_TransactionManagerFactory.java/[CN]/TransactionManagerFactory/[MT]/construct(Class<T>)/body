{
  if (!configuration.isTransactionalCache()) {
    return null;
  }
  TransactionManager transactionManager=null;
  TransactionManagerLookup lookup=configuration.getTransactionManagerLookup();
  if (lookup == null) {
    if (configuration.getTransactionManagerLookupClass() != null) {
      lookup=(TransactionManagerLookup)Util.getInstance(configuration.getTransactionManagerLookupClass(),configuration.getClassLoader());
    }
  }
  try {
    if (lookup != null) {
      componentRegistry.wireDependencies(lookup);
      transactionManager=lookup.getTransactionManager();
    }
  }
 catch (  Exception e) {
    log.couldNotInstantiateTransactionManager(e);
  }
  if (transactionManager == null && configuration.isInvocationBatchingEnabled()) {
    log.usingBatchModeTransactionManager();
    transactionManager=BatchModeTransactionManager.getInstance();
  }
  if (transactionManager == null) {
    throw new CacheException("This is transactional cache but no transaction manager could be found. " + "Configure the transaction manager lookup properly.");
  }
  return componentType.cast(transactionManager);
}
