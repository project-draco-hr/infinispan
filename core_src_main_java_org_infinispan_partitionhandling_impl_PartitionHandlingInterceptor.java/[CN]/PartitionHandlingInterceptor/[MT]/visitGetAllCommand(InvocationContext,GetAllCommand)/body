{
  Map<Object,Object> result;
  try {
    result=(Map<Object,Object>)ctx.forkInvocationSync(command);
  }
 catch (  RpcException e) {
    if (performPartitionCheck(ctx,command)) {
      throw log.degradedModeKeysUnavailable(command.getKeys());
    }
 else {
      throw e;
    }
  }
  if (performPartitionCheck(ctx,command)) {
    for (    Object key : command.getKeys()) {
      partitionHandlingManager.checkRead(key);
    }
    if (result.size() != command.getKeys().size()) {
      Set<Object> missingKeys=new HashSet<>(command.getKeys());
      missingKeys.removeAll(result.keySet());
      for (Iterator<Object> it=missingKeys.iterator(); it.hasNext(); ) {
        Object key=it.next();
        if (InfinispanCollections.containsAny(transport.getMembers(),distributionManager.locate(key))) {
          it.remove();
        }
      }
      if (!missingKeys.isEmpty()) {
        throw log.degradedModeKeysUnavailable(missingKeys);
      }
    }
  }
  return ctx.shortCircuit(result);
}
