{
  Map<Object,String> values=putValueInEachCache(3);
  Cache<Object,String> cache0=cache(0,CACHE_NAME);
  Cache<Object,String> cache1=cache(1,CACHE_NAME);
  CheckPoint checkPoint=new CheckPoint();
  checkPoint.triggerForever("post_send_response_released");
  waitUntilSendingResponse(cache1,checkPoint);
  final EntryRetriever<Object,String> retriever=cache0.getAdvancedCache().getComponentRegistry().getComponent(EntryRetriever.class);
  final BlockingQueue<Map.Entry<Object,String>> returnQueue=new ArrayBlockingQueue<Map.Entry<Object,String>>(10);
  Future<Void> future=fork(new Callable<Void>(){
    @Override public Void call() throws Exception {
      Iterator<CacheEntry<Object,String>> iter=retriever.retrieveEntries(null,null,null);
      while (iter.hasNext()) {
        Map.Entry<Object,String> entry=iter.next();
        returnQueue.add(entry);
      }
      return null;
    }
  }
);
  checkPoint.awaitStrict("pre_send_response_invoked",10,TimeUnit.SECONDS);
  killMember(1,CACHE_NAME);
  checkPoint.trigger("pre_send_response_released");
  future.get(10,TimeUnit.SECONDS);
  for (  Map.Entry<Object,String> entry : values.entrySet()) {
    assertTrue(returnQueue.contains(entry),"Entry wasn't found:" + entry);
  }
}
