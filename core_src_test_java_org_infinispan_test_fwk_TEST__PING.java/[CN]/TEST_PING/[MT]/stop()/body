{
  super.stop();
  DiscoveryKey key=new DiscoveryKey(testName,clusterName);
  Map<Address,Discovery> discoveries=all.get(key);
  if (discoveries != null) {
    discoveries.remove(local_addr);
    if (discoveries.isEmpty()) {
      boolean removed=all.remove(key,discoveries);
      if (!removed && all.containsKey(key)) {
        throw new IllegalStateException(String.format("Concurrent discovery removal for test=%s but not removed??",testName));
      }
    }
  }
 else {
    log.debug(String.format("Test (%s) started but not registered discovery",key));
  }
}
