{
  clusterName=cluster_name;
  DiscoveryKey key=new DiscoveryKey(testName,clusterName);
  Map<Address,Discovery> discoveries=all.get(key);
  if (discoveries == null) {
    discoveries=new HashMap<Address,Discovery>();
    Map ret=all.putIfAbsent(key,discoveries);
    if (ret != null)     discoveries=ret;
  }
  if (log.isTraceEnabled())   log.trace(String.format("Discoveries for %s are : %s",key,discoveries));
  if (!discoveries.containsKey(local_addr)) {
    discoveries.put(local_addr,this);
    if (log.isTraceEnabled())     log.trace(String.format("Add discovery for %s to cache.  The cache now contains: %s",local_addr,discoveries));
  }
  if (discard == null || !discard.isDiscardAll()) {
    Message msg=createGetMbrsReqMsg(clusterName,returnViewsOnly);
    if (!discoveries.isEmpty()) {
      for (      Discovery discovery : discoveries.values()) {
        if (discovery != this) {
          discovery.up(new Event(Event.MSG,msg));
        }
      }
    }
 else {
      log.debug("No other nodes yet, so skip sending get-members request");
    }
  }
 else   if (discard != null && discard.isDiscardAll()) {
    log.debug("Not sending discovery because DISCARD is on");
  }
}
