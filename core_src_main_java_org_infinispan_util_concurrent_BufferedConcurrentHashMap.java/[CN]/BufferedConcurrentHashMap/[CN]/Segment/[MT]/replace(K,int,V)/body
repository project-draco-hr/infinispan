{
  lock();
  Set<HashEntry<K,V>> evicted=null;
  try {
    HashEntry<K,V> e=getFirst(hash);
    while (e != null && (e.hash != hash || !key.equals(e.key)))     e=e.next;
    V oldValue=null;
    if (e != null) {
      oldValue=e.value;
      e.value=newValue;
      if (ea.onEntryHit(e)) {
        evicted=attemptEviction(true);
      }
    }
    return oldValue;
  }
  finally {
    unlock();
    if (evictionListener != null && evicted != null) {
      for (      HashEntry<K,V> he : evicted) {
        evictionListener.evicted(he.key,he.value);
      }
    }
  }
}
