{
  Configuration config=createConfiguration();
  EmbeddedCacheManager cm1=TestCacheManagerFactory.createCacheManager(config,true);
  EmbeddedCacheManager cm2=TestCacheManagerFactory.createCacheManager(config,true);
  registerCacheManager(cm1);
  registerCacheManager(cm2);
  TestingUtil.blockUntilViewsReceived(10000,cache(0),cache(1));
  BaseDistFunctionalTest.RehashWaiter.waitForInitRehashToComplete(cache(0),cache(1));
  cas=KeyAffinityServiceFactory.newKeyAffinityService(cache(0),new Executor(){
    public void execute(    Runnable command){
      new Thread(command).start();
    }
  }
,new RndKeyGenerator(),2,true);
  k0=cas.getKeyForAddress(address(0));
  k1=cas.getKeyForAddress(address(1));
  cas.stop();
}
