{
  InvocationContext ctx;
  if (tx != null) {
    LocalTxInvocationContext localContext;
    localContext=new LocalTxInvocationContext();
    LocalTransaction localTransaction=transactionTable.getLocalTransaction(tx);
    localContext.setLocalTransaction(localTransaction);
    localContext.setTransaction(tx);
    ctx=localContext;
  }
 else {
    NonTxInvocationContext nonTxContext;
    nonTxContext=new NonTxInvocationContext();
    nonTxContext.setOriginLocal(true);
    ctx=nonTxContext;
  }
  ctxHolder.set(ctx);
  return ctx;
}
