{
  if (isChanged() || isLoaded()) {
    if (trace)     log.tracef("Updating entry (key=%s removed=%s valid=%s changed=%s created=%s loaded=%s value=%s]",toStr(getKey()),isRemoved(),isValid(),isChanged(),isCreated(),isLoaded(),toStr(value));
    if (value instanceof AtomicHashMap) {
      AtomicHashMap<?,?> ahm=(AtomicHashMap<?,?>)value;
      if (isRemoved() && !isEvicted())       ahm.markRemoved(true);
    }
    if (isRemoved()) {
      container.remove(key);
    }
 else     if (value != null) {
      container.put(key,value,providedMetadata == null ? metadata : providedMetadata);
    }
    reset();
  }
}
