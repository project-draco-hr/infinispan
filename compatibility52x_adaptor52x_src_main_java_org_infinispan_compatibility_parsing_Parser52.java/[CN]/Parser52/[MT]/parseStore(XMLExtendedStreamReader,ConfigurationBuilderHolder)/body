{
  ConfigurationBuilder builder=holder.getCurrentConfigurationBuilder();
  Object loader=null;
  Boolean fetchPersistentState=null;
  Boolean ignoreModifications=null;
  Boolean purgeOnStartup=null;
  for (int i=0; i < reader.getAttributeCount(); i++) {
    ParseUtils.requireNoNamespaceAttribute(reader,i);
    String value=replaceProperties(reader.getAttributeValue(i));
    Attribute attribute=Attribute.forName(reader.getAttributeLocalName(i));
switch (attribute) {
case CLASS:
      loader=Util.getInstance(value,holder.getClassLoader());
    break;
case FETCH_PERSISTENT_STATE:
  fetchPersistentState=Boolean.valueOf(value);
break;
case IGNORE_MODIFICATIONS:
ignoreModifications=Boolean.valueOf(value);
break;
case PURGE_ON_STARTUP:
purgeOnStartup=Boolean.valueOf(value);
break;
case PURGER_THREADS:
log.trace(Attribute.PURGER_THREADS + " is deprecated and ignored.");
break;
case PURGE_SYNCHRONOUSLY:
log.trace(Attribute.PURGE_SYNCHRONOUSLY + " is deprecated and ignored.");
break;
default :
throw ParseUtils.unexpectedAttribute(reader,i);
}
}
if (loader != null) {
if (loader instanceof SingleFileStore) {
SingleFileStoreConfigurationBuilder fcscb=builder.persistence().addSingleFileStore();
if (fetchPersistentState != null) fcscb.fetchPersistentState(fetchPersistentState);
if (ignoreModifications != null) fcscb.ignoreModifications(ignoreModifications);
if (purgeOnStartup != null) fcscb.purgeOnStartup(purgeOnStartup);
parseStoreChildren(reader,fcscb,builder.persistence());
}
 else if (loader instanceof CacheStore) {
Adaptor52xStoreConfigurationBuilder scb=builder.persistence().addStore(Adaptor52xStoreConfigurationBuilder.class);
scb.loader((org.infinispan.loaders.CacheLoader)loader);
if (fetchPersistentState != null) scb.fetchPersistentState(fetchPersistentState);
if (ignoreModifications != null) scb.ignoreModifications(ignoreModifications);
parseStoreChildren(reader,scb,builder.persistence());
}
 else if (loader instanceof ClusterLoader) {
ClusterLoaderConfigurationBuilder cclb=builder.persistence().addClusterLoader();
parseLoaderChildren(reader,cclb);
}
 else if (loader instanceof CacheLoader) {
Adaptor52xStoreConfigurationBuilder scb=builder.persistence().addStore(Adaptor52xStoreConfigurationBuilder.class);
scb.loader((org.infinispan.loaders.CacheLoader)loader);
if (fetchPersistentState != null) scb.fetchPersistentState(fetchPersistentState);
if (ignoreModifications != null) scb.ignoreModifications(ignoreModifications);
parseStoreChildren(reader,scb,builder.persistence());
}
 else {
throw log.invalidCacheLoaderClass(loader.getClass().getName());
}
}
}
