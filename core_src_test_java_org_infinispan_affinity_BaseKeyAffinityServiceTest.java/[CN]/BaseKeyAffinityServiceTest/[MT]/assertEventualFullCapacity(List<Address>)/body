{
  Map<Address,BlockingQueue> blockingQueueMap=keyAffinityService.getAddress2KeysMapping();
  long maxWaitTime=20 * 60 * 1000;
  for (  Address addr : addresses) {
    BlockingQueue queue=blockingQueueMap.get(addr);
    long giveupTime=System.currentTimeMillis() + maxWaitTime;
    while (queue.size() != 100 && System.currentTimeMillis() < giveupTime)     Thread.sleep(100);
    assertEquals(100,queue.size());
  }
  assertEquals(keyAffinityService.getMaxNumberOfKeys(),keyAffinityService.getExitingNumberOfKeys());
  assertEquals(addresses.size() * 100,keyAffinityService.getExitingNumberOfKeys());
  assertEquals(false,keyAffinityService.isKeyGeneratorThreadActive());
}
