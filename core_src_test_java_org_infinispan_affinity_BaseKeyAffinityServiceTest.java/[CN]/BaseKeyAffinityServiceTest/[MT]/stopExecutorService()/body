{
  if (keyAffinityService != null)   keyAffinityService.stop();
  if (executor != null)   executor.shutdown();
  boolean terminatedGracefully=executor.awaitTermination(100,TimeUnit.MILLISECONDS);
  if (!terminatedGracefully) {
    executor.shutdownNow();
    Assert.fail("KeyGenerator Executor not terminated in expected time");
  }
}
