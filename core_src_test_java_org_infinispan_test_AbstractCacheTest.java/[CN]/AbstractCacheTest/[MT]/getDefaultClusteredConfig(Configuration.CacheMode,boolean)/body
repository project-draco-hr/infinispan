{
  if (mode.isSynchronous()) {
    return TestCacheManagerFactory.getDefaultConfiguration(transactional).fluent().mode(mode).clustering().sync().stateRetrieval().fetchInMemoryState(false).transaction().syncCommitPhase(true).syncRollbackPhase(true).build();
  }
 else {
    return TestCacheManagerFactory.getDefaultConfiguration(transactional).fluent().mode(mode).clustering().async().stateRetrieval().fetchInMemoryState(false).transaction().syncCommitPhase(true).syncRollbackPhase(true).build();
  }
}
