{
  ConfigurationBuilder builder=TestCacheManagerFactory.getDefaultCacheConfiguration(transactional,useCustomTxLookup);
  builder.clustering().cacheMode(mode).stateTransfer().fetchInMemoryState(true).transaction().syncCommitPhase(true).syncRollbackPhase(true).cacheStopTimeout(0L);
  if (mode.isSynchronous())   builder.clustering().sync();
 else   builder.clustering().async();
  if (mode.isReplicated()) {
    builder.clustering().hash().numSegments(1);
  }
  return builder;
}
