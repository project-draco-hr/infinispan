{
  StateTransferControlCommand.Type type;
  if (state != null) {
    log.debugf("Pushing to nodes %s %d keys",targets,state.size());
    log.tracef("Pushing to nodes %s keys: %s",targets,keys(state));
    type=StateTransferControlCommand.Type.APPLY_STATE;
  }
 else   if (lockInfo != null) {
    log.debugf("Migrating %d locks to node(s) %s",lockInfo.size(),targets);
    type=StateTransferControlCommand.Type.APPLY_LOCKS;
  }
 else {
    throw new IllegalStateException("Cannot have both locks and state set to null.");
  }
  final StateTransferControlCommand cmd=cf.buildStateTransferCommand(type,getAddress(),viewId,state,lockInfo);
  rpcManager.invokeRemotelyInFuture(targets,cmd,false,stateTransferFuture,getTimeout());
}
