{
  if (configuration.isTransactionalCache() && configuration.isEnableVersioning() && configuration.isWriteSkewCheck()&& configuration.getTransactionLockingMode() == LockingMode.OPTIMISTIC && configuration.getCacheMode().isClustered()) {
    commandBuilder=new CommandBuilder(){
      @Override public PutKeyValueCommand buildPut(      InvocationContext ctx,      CacheEntry e){
        return cf.buildVersionedPutKeyValueCommand(e.getKey(),e.getValue(),e.getLifespan(),e.getMaxIdle(),e.getVersion(),ctx.getFlags());
      }
    }
;
  }
 else {
    commandBuilder=new CommandBuilder(){
      @Override public PutKeyValueCommand buildPut(      InvocationContext ctx,      CacheEntry e){
        return cf.buildPutKeyValueCommand(e.getKey(),e.getValue(),e.getLifespan(),e.getMaxIdle(),ctx.getFlags());
      }
    }
;
  }
  if (trace)   log.tracef("Starting state transfer manager on " + getAddress());
  cacheViewsManager.join(configuration.getName(),this);
}
