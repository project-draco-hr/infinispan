{
  jmxConnectionProvider=new MBeanServerConnectionProvider(getServer().getHotrodEndpoint().getInetAddress().getHostName(),SERVER1_MGMT_PORT);
  rcmFactory=new RemoteCacheManagerFactory();
  ConfigurationBuilder clientBuilder=new ConfigurationBuilder();
  clientBuilder.addServer().host(getServer().getHotrodEndpoint().getInetAddress().getHostName()).port(getServer().getHotrodEndpoint().getPort()).marshaller(new ProtoStreamMarshaller());
  remoteCacheManager=rcmFactory.createManager(clientBuilder);
  remoteCache=remoteCacheManager.getCache(cacheName);
  ModelNode nameList=new ModelNode().add("/infinispan/indexing.proto").add("/sample_bank_account/bank.proto").add("/google/protobuf/descriptor.proto");
  ModelNode urlList=new ModelNode().add(getClass().getResource("/infinispan/indexing.proto").toString()).add(getClass().getResource("/sample_bank_account/bank.proto").toString()).add(getClass().getResource("/google/protobuf/descriptor.proto").toString());
  ModelControllerClient client=ModelControllerClient.Factory.create(getServer().getHotrodEndpoint().getInetAddress().getHostName(),SERVER1_MGMT_PORT);
  ModelNode addProtobufFileOp=getOperation("clustered","upload-proto-schemas",nameList,urlList);
  ModelNode result=client.execute(addProtobufFileOp);
  Assert.assertEquals(SUCCESS,result.get(OUTCOME).asString());
  client.close();
  MarshallerRegistration.registerMarshallers(ProtoStreamMarshaller.getSerializationContext(remoteCacheManager));
}
