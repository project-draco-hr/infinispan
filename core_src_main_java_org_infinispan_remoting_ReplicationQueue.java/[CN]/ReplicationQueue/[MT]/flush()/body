{
  List<ReplicableCommand> toReplicate=new LinkedList<ReplicableCommand>();
  elements.drainTo(toReplicate);
  if (log.isTraceEnabled())   log.trace("flush(): flushing repl queue (num elements={0})",toReplicate.size());
  int toReplicateSize=toReplicate.size();
  if (toReplicateSize > 0) {
    try {
      log.trace("Flushing {0} elements",toReplicateSize);
      MultipleRpcCommand multipleRpcCommand=commandsFactory.buildReplicateCommand(toReplicate);
      rpcManager.invokeRemotely(null,multipleRpcCommand,ResponseMode.ASYNCHRONOUS,configuration.getSyncReplTimeout());
    }
 catch (    Throwable t) {
      log.error("failed replicating " + toReplicate.size() + " elements in replication queue",t);
    }
  }
}
