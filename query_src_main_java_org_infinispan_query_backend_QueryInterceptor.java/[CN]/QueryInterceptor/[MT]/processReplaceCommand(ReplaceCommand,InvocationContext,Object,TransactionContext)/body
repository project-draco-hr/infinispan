{
  if (valueReplaced != null && command.isSuccessful() && shouldModifyIndexes(command,ctx)) {
    final boolean usingSkipIndexCleanupFlag=usingSkipIndexCleanup(command);
    Object[] parameters=command.getParameters();
    Object p2=extractValue(parameters[2]);
    final boolean newValueIsIndexed=updateKnownTypesIfNeeded(p2);
    Object key=extractValue(command.getKey());
    if (!usingSkipIndexCleanupFlag) {
      final Object p1=extractValue(parameters[1]);
      final boolean originalIsIndexed=updateKnownTypesIfNeeded(p1);
      if (p1 != null && originalIsIndexed) {
        transactionContext=transactionContext == null ? makeTransactionalEventContext() : transactionContext;
        removeFromIndexes(p1,key,transactionContext);
      }
    }
    if (newValueIsIndexed) {
      transactionContext=transactionContext == null ? makeTransactionalEventContext() : transactionContext;
      updateIndexes(usingSkipIndexCleanupFlag,p2,key,transactionContext);
    }
  }
}
