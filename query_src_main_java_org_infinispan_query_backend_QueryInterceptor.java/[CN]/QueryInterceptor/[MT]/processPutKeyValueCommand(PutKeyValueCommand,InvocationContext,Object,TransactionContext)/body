{
  final boolean usingSkipIndexCleanupFlag=usingSkipIndexCleanup(command);
  Object value=extractValue(command.getValue());
  if (!usingSkipIndexCleanupFlag && updateKnownTypesIfNeeded(previousValue) && shouldRemove(value,previousValue)) {
    if (shouldModifyIndexes(command,ctx)) {
      transactionContext=transactionContext == null ? makeTransactionalEventContext() : transactionContext;
      removeFromIndexes(previousValue,extractValue(command.getKey()),transactionContext);
    }
  }
  if (updateKnownTypesIfNeeded(value)) {
    if (shouldModifyIndexes(command,ctx)) {
      transactionContext=transactionContext == null ? makeTransactionalEventContext() : transactionContext;
      updateIndexes(usingSkipIndexCleanupFlag,value,extractValue(command.getKey()),transactionContext);
    }
  }
}
