{
  Object key=ice == null ? k : ice.getKey();
  if (keysHandled.contains(key))   return;
  InternalCacheValue icv=null;
  for (  Address leaver : leavers) {
    List<Address> owners=oldCH.locate(key,replCount);
    int leaverIndex=owners.indexOf(leaver);
    if (leaverIndex > -1) {
      int numOwners=owners.size();
      int selfIndex=owners.indexOf(self);
      boolean isLeaverLast=leaverIndex == numOwners - 1;
      if ((isLeaverLast && selfIndex == numOwners - 2) || (!isLeaverLast && selfIndex == leaverIndex + 1)) {
        List<Address> newOwners=newCH.locate(key,replCount);
        newOwners.removeAll(owners);
        if (!newOwners.isEmpty()) {
          for (          Address no : newOwners) {
            Map<Object,InternalCacheValue> s=state.get(no);
            if (s == null) {
              s=new HashMap<Object,InternalCacheValue>();
              state.put(no,s);
            }
            if (icv == null) {
              if (ice == null) {
                try {
                  InternalCacheEntry payload=loader.load(key);
                  if (payload != null)                   icv=payload.toInternalCacheValue();
                }
 catch (                Exception e) {
                  log.warn("Unable to load " + key + " from cache loader",e);
                }
              }
 else {
                icv=ice.toInternalCacheValue();
              }
            }
            s.put(key,icv);
          }
        }
      }
    }
  }
  keysHandled.add(key);
}
