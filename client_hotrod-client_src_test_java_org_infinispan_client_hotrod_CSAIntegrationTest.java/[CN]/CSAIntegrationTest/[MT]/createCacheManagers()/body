{
  cleanup=CleanupPhase.AFTER_METHOD;
  Configuration config=getDefaultClusteredConfig(Configuration.CacheMode.DIST_SYNC);
  CacheManager cm1=addClusterEnabledCacheManager();
  CacheManager cm2=addClusterEnabledCacheManager();
  CacheManager cm3=addClusterEnabledCacheManager();
  cm1.defineConfiguration(CACHE_NAME,config);
  cm2.defineConfiguration(CACHE_NAME,config);
  cm3.defineConfiguration(CACHE_NAME,config);
  BaseDistFunctionalTest.RehashWaiter.waitForInitRehashToComplete(manager(0).getCache(CACHE_NAME),manager(1).getCache(CACHE_NAME),manager(2).getCache(CACHE_NAME));
  hotRodServer1=TestHelper.startHotRodServer(manager(0));
  hotRodServer2=TestHelper.startHotRodServer(manager(1));
  hotRodServer3=TestHelper.startHotRodServer(manager(2));
  manager(0).getCache(CACHE_NAME).put("k","v");
  manager(0).getCache(CACHE_NAME).get("k").equals("v");
  manager(1).getCache(CACHE_NAME).get("k").equals("v");
  manager(2).getCache(CACHE_NAME).get("k").equals("v");
  log.info("Local replication test passed!");
  remoteCacheManager=new RemoteCacheManager("localhost:" + hotRodServer2.getPort() + ";localhost:"+ hotRodServer2.getPort());
  remoteCache=remoteCacheManager.getCache();
  tcpConnectionFactory=(TcpTransportFactory)TestingUtil.extractField(remoteCacheManager,"transportFactory");
}
