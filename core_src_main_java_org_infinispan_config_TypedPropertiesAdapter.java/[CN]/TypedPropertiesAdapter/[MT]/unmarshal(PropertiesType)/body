{
  TypedProperties tp=new TypedProperties();
  if (props != null && props.properties != null) {
    for (    Property p : props.properties) {
      if (p.value != null) {
        String originalValue=p.value;
        boolean needsTokenReplacement=originalValue.indexOf('$') >= 0 && originalValue.indexOf('{') > 0 && originalValue.indexOf('}') > 0;
        if (needsTokenReplacement) {
          p.value=StringPropertyReplacer.replaceProperties(originalValue);
          if (originalValue.equals(p.value)) {
            log.warn("Property " + p.name + " with value "+ originalValue+ " could not be replaced as intended!");
          }
        }
      }
      tp.put(p.name,p.value);
    }
  }
  return tp;
}
