{
  if (joinerViewId > viewId) {
    log.tracef("Received a cache topology command with a higher view id: %s, our view id is %s",joinerViewId,viewId);
    long endTime=timeService.expectedEndTime(timeout,TimeUnit.MILLISECONDS);
synchronized (clusterManagerLock) {
      while (viewId < joinerViewId || clusterManagerStatus == ClusterManagerStatus.RECOVERING_CLUSTER) {
        if (timeService.isTimeExpired(endTime) || !clusterManagerStatus.isRunning())         break;
        clusterManagerLock.wait(timeService.remainingTime(endTime,TimeUnit.MILLISECONDS));
      }
    }
    if (timeService.isTimeExpired(endTime)) {
      throw new TimeoutException("Timed out waiting for view " + joinerViewId);
    }
  }
}
