{
  if (joinerViewId > viewId || clusterManagerStatus == ClusterManagerStatus.RECOVERING_CLUSTER) {
    if (trace) {
      if (joinerViewId > viewId) {
        log.tracef("Waiting to install view %s before processing join request from %s",joinerViewId,joiner);
      }
 else {
        log.tracef("Waiting to recover cluster status before processing join request from %s",joiner);
      }
    }
    long endTime=timeService.expectedEndTime(timeout,TimeUnit.MILLISECONDS);
synchronized (clusterManagerLock) {
      while (viewId < joinerViewId || clusterManagerStatus == ClusterManagerStatus.RECOVERING_CLUSTER) {
        if (timeService.isTimeExpired(endTime) || !clusterManagerStatus.isRunning())         break;
        clusterManagerLock.wait(timeService.remainingTime(endTime,TimeUnit.MILLISECONDS));
      }
    }
    if (timeService.isTimeExpired(endTime)) {
      throw new TimeoutException("Timed out waiting for view " + joinerViewId);
    }
  }
}
