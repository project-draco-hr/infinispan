{
  GlobalConfiguration globalConfiguration=GlobalConfiguration.getNonClusteredDefault();
  globalConfiguration.setMBeanServerLookup(PerThreadMBeanServerLookup.class.getName());
  globalConfiguration.setJmxDomain(JMX_DOMAIN);
  globalConfiguration.setExposeGlobalJmxStatistics(true);
  cacheManager=TestCacheManagerFactory.createCacheManagerEnforceJmxDomain(globalConfiguration);
  DummyInMemoryCacheStore.Cfg cfg=new DummyInMemoryCacheStore.Cfg();
  CacheLoaderManagerConfig clManagerConfig=new CacheLoaderManagerConfig();
  clManagerConfig.setPassivation(false);
  clManagerConfig.addCacheLoaderConfig(cfg);
  Configuration configuration=getDefaultClusteredConfig(Configuration.CacheMode.LOCAL);
  configuration.setExposeJmxStatistics(true);
  configuration.setCacheLoaderManagerConfig(clManagerConfig);
  cacheManager.defineConfiguration("test",configuration);
  cache=cacheManager.getCache("test");
  loaderInterceptorObjName=new ObjectName(JMX_DOMAIN + ":cache-name=\"test(local)\",jmx-resource=CacheLoader");
  storeInterceptorObjName=new ObjectName(JMX_DOMAIN + ":cache-name=\"test(local)\",jmx-resource=CacheStore");
  threadMBeanServer=PerThreadMBeanServerLookup.getThreadMBeanServer();
  cacheStore=TestingUtil.extractComponent(cache,CacheLoaderManager.class).getCacheStore();
  return cacheManager;
}
