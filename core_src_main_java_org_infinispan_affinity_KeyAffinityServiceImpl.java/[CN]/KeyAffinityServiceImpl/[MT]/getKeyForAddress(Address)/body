{
  if (!started) {
    throw new IllegalStateException("You have to start the service first!");
  }
  BlockingQueue queue=address2key.get(address);
  try {
    maxNumberInvariant.readLock().lock();
    Object result;
    try {
      result=queue.take();
    }
  finally {
      maxNumberInvariant.readLock().unlock();
    }
    exitingNumberOfKeys.decrementAndGet();
    return result;
  }
 catch (  InterruptedException e) {
    Thread.currentThread().interrupt();
    return null;
  }
 finally {
    if (maxNumberOfKeys.equals(exitingNumberOfKeys)) {
      keyProducerStartLatch.open();
    }
  }
}
