{
  maxNumberInvariant.readLock().lock();
  try {
    while (maxNumberOfKeys.get() != exitingNumberOfKeys.get()) {
      Object key=keyGenerator.getKey();
      Address addressForKey=getAddressForKey(key);
      if (interestedInAddress(addressForKey)) {
        tryAddKey(addressForKey,key);
      }
    }
    keyProducerStartLatch.close();
  }
  finally {
    maxNumberInvariant.readLock().unlock();
  }
}
