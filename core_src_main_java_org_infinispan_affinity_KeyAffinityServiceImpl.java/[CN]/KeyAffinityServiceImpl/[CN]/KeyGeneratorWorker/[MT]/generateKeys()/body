{
  maxNumberInvariant.readLock().lock();
  try {
    while (!Thread.currentThread().isInterrupted() && exitingNumberOfKeys.get() < maxNumberOfKeys.get()) {
      Object key=keyGenerator.getKey();
      Address addressForKey=getAddressForKey(key);
      if (interestedInAddress(addressForKey)) {
        tryAddKey(addressForKey,key);
      }
    }
    keyProducerStartLatch.close();
  }
  finally {
    maxNumberInvariant.readLock().unlock();
  }
}
