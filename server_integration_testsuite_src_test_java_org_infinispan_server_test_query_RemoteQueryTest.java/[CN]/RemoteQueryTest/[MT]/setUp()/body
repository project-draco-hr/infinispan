{
  provider=new MBeanServerConnectionProvider(server.getHotrodEndpoint().getInetAddress().getHostName(),9999);
  rcmFactory=new RemoteCacheManagerFactory();
  ConfigurationBuilder clientBuilder=new ConfigurationBuilder();
  clientBuilder.addServer().host(server.getHotrodEndpoint().getInetAddress().getHostName()).port(server.getHotrodEndpoint().getPort()).marshaller(new ProtoStreamMarshaller());
  remoteCacheManager=rcmFactory.createManager(clientBuilder);
  remoteCache=remoteCacheManager.getCache(DEFAULT_CACHE);
  String mbean="jboss.infinispan:type=RemoteQuery,name=" + ObjectName.quote("local") + ",component=ProtobufMetadataManager";
  byte[] descriptor=readClasspathResource("/bank.protobin");
  invokeOperation(provider,mbean,"registerProtofile",new Object[]{descriptor},new String[]{byte[].class.getName()});
  MarshallerRegistration.registerMarshallers(ProtoStreamMarshaller.getSerializationContext(remoteCacheManager));
}
