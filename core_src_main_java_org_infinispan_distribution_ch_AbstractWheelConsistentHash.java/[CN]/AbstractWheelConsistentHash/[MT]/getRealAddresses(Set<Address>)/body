{
  if (virtualAddresses.isEmpty())   return Collections.emptySet();
 else   if (virtualAddresses.size() == 1) {
    if (isVirtualNodesEnabled()) {
      VirtualAddress a=(VirtualAddress)virtualAddresses.iterator().next();
      return Collections.singleton(a.getRealAddress());
    }
 else     return virtualAddresses;
  }
 else {
    if (isVirtualNodesEnabled()) {
      Set<Address> addresses=new HashSet<Address>();
      for (      Address a : virtualAddresses) {
        VirtualAddress va=(VirtualAddress)a;
        addresses.add(va.getRealAddress());
      }
      return addresses;
    }
 else     return virtualAddresses;
  }
}
