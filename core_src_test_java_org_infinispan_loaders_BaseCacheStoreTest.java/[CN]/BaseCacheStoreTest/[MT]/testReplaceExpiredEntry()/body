{
  final long startTime=System.currentTimeMillis();
  final long lifespan=3000;
  cs.store(TestInternalCacheEntryFactory.create("k1","v1",lifespan));
  while (true) {
    InternalCacheEntry entry=cs.load("k1");
    if (System.currentTimeMillis() >= startTime + lifespan)     break;
    assertEquals("v1",entry.getValue());
    Thread.sleep(100);
  }
  while (System.currentTimeMillis() < startTime + lifespan + 20000) {
    if (cs.load("k1") == null)     break;
  }
  assertNull(cs.load("k1"));
  cs.store(TestInternalCacheEntryFactory.create("k1","v2",lifespan));
  while (true) {
    InternalCacheEntry entry=cs.load("k1");
    if (System.currentTimeMillis() >= startTime + lifespan)     break;
    assertEquals("v2",entry.getValue());
    Thread.sleep(100);
  }
  while (System.currentTimeMillis() < startTime + lifespan + 20000) {
    if (cs.load("k1") == null)     break;
  }
  assertNull(cs.load("k1"));
}
