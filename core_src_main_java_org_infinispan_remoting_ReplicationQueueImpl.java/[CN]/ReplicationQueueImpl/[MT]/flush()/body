{
  List<ReplicableCommand> toReplicate=drainReplQueue();
  if (trace)   log.tracef("flush(): flushing repl queue (num elements=%s)",toReplicate.size());
  int toReplicateSize=toReplicate.size();
  if (toReplicateSize > 0) {
    try {
      log.tracef("Flushing %s elements",toReplicateSize);
      MultipleRpcCommand multipleRpcCommand=commandsFactory.buildReplicateCommand(toReplicate);
      rpcManager.invokeRemotely(null,multipleRpcCommand,rpcManager.getRpcOptionsBuilder(ResponseMode.ASYNCHRONOUS).skipReplicationQueue(true).build());
    }
 catch (    Throwable t) {
      log.failedReplicatingQueue(toReplicate.size(),t);
    }
  }
  return toReplicateSize;
}
