{
  JMXConnector jmxConnector=JMXConnectorFactory.connect(new JMXServiceURL("service:jmx:http-remoting-jmx://" + host + ":"+ jmxPort));
  MBeanServerConnection jmxConnection=jmxConnector.getMBeanServerConnection();
  ObjectName objName=new ObjectName("jboss.infinispan:type=RemoteQuery,name=" + ObjectName.quote("clustered") + ",component=ProtobufMetadataManager");
  LinkedList<String> fileNames=new LinkedList<>();
  LinkedList<String> fileContents=new LinkedList<>();
  for (  String protofile : protofilesPath.split(",")) {
    String absPath=protofile.startsWith("/") ? protofile : "/" + protofile;
    String descriptor=readClasspathResource(absPath);
    String name=protofile.startsWith("/") ? protofile.substring(1) : protofile;
    fileNames.add(name);
    fileContents.add(descriptor);
  }
  String[] names=fileNames.toArray(new String[fileNames.size()]);
  String[] contents=fileContents.toArray(new String[fileContents.size()]);
  jmxConnection.invoke(objName,"registerProtofiles",new Object[]{names,contents},new String[]{String[].class.getName(),String[].class.getName()});
  System.out.printf("Successfully registered protofile(s) %s at %s/%d\n",protofilesPath,host,jmxPort);
}
