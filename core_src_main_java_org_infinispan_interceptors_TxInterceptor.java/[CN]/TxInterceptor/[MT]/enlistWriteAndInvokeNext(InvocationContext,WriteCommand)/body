{
  if (shouldEnlist(ctx)) {
    TransactionXaAdapter xaAdapter=enlist();
    LocalTxInvocationContext localTxContext=(LocalTxInvocationContext)ctx;
    if (!isLocalModeForced(ctx)) {
      xaAdapter.addModification(command);
    }
    localTxContext.setXaCache(xaAdapter);
  }
  if (!ctx.isInTxScope())   transactionLog.logNoTxWrite(command);
  return invokeNextInterceptor(ctx,command);
}
