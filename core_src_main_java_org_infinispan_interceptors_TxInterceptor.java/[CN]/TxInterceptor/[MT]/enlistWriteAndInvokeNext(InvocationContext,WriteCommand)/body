{
  LocalTransaction localTransaction=null;
  boolean shouldAddMod=false;
  if (shouldEnlist(ctx)) {
    localTransaction=enlist(ctx);
    LocalTxInvocationContext localTxContext=(LocalTxInvocationContext)ctx;
    if (localModeNotForced(ctx))     shouldAddMod=true;
    localTxContext.setLocalTransaction(localTransaction);
  }
  Object rv;
  rv=invokeNextInterceptor(ctx,command);
  if (!ctx.isInTxScope())   transactionLog.logNoTxWrite(command);
  if (command.isSuccessful() && shouldAddMod)   localTransaction.addModification(command);
  return rv;
}
