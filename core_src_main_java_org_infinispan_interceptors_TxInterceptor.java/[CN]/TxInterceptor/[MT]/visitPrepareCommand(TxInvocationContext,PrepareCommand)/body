{
  if (!ctx.isOriginLocal()) {
    for (    VisitableCommand modification : command.getModifications()) {
      VisitableCommand toReplay=getCommandToReplay(modification);
      if (toReplay != null) {
        invokeNextInterceptor(ctx,toReplay);
      }
    }
  }
  if (!command.isOnePhaseCommit()) {
    transactionLog.logPrepare(command);
  }
  if (getStatisticsEnabled())   prepares.incrementAndGet();
  try {
    return invokeNextInterceptor(ctx,command);
  }
  finally {
    if (command.isOnePhaseCommit()) {
      transactionLog.logOnePhaseCommit(ctx.getGlobalTransaction(),Arrays.asList(command.getModifications()));
    }
  }
}
