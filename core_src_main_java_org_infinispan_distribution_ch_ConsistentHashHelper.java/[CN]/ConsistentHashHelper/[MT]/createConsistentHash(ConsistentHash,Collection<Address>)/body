{
  Hash hf=null;
  int numVirtualNodes=1;
  GroupManager groupManager=null;
  boolean withTopology=false;
  if (template instanceof AbstractWheelConsistentHash) {
    AbstractWheelConsistentHash wTemplate=(AbstractWheelConsistentHash)template;
    hf=wTemplate.hashFunction;
    numVirtualNodes=wTemplate.numVirtualNodes;
    groupManager=wTemplate.groupManager;
    withTopology=true;
  }
  ConsistentHash ch=constructConsistentHashInstance(Util.getInstance(template.getClass()),hf,numVirtualNodes,groupManager,withTopology);
  if (addresses != null && !addresses.isEmpty())   ch.setCaches(toSet(addresses));
  return ch;
}
