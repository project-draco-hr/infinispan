{
  ConsistentHash ch=(ConsistentHash)Util.getInstance(c.getConsistentHashClass(),Thread.currentThread().getContextClassLoader());
  if (ch instanceof AbstractWheelConsistentHash) {
    Hash h=(Hash)Util.getInstance(c.getHashFunctionClass(),Thread.currentThread().getContextClassLoader());
    AbstractWheelConsistentHash wch=(AbstractWheelConsistentHash)ch;
    wch.setHashFunction(h);
    wch.setNumVirtualNodes(c.getNumVirtualNodes());
  }
  if (ch instanceof AbstractConsistentHash) {
    AbstractConsistentHash ach=(AbstractConsistentHash)ch;
    if (c.isGroupsEnabled())     ach.setGroupManager(new GroupManagerImpl(c.getGroupers()));
  }
  return ch;
}
