{
  if (trace)   log.tracef("Checking availability for key=%s, status=%s",key,state);
  if (state == PartitionState.AVAILABLE)   return;
  if (state == PartitionState.UNAVAILABLE)   throw log.partitionUnavailable();
  List<Address> owners=distributionManager.locate(key);
  if (!rpcManager.getTransport().getMembers().containsAll(owners)) {
    if (trace)     log.tracef("Partition is in %s mode, access is not allowed for key %s",state,key);
    throw log.degradedModeKeyUnavailable(key);
  }
 else {
    if (trace)     log.tracef("Key %s is available.",key);
  }
}
