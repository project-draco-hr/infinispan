{
  InputStream schemaInputStream=InfinispanConfiguration.findSchemaInputStream();
  try {
    InfinispanConfiguration configuration=InfinispanConfiguration.newInfinispanConfiguration(configurationStream,schemaInputStream,new ConfigurationValidatingVisitor());
    globalConfiguration=configuration.parseGlobalConfiguration();
    defaultConfiguration=configuration.parseDefaultConfiguration();
    for (    Map.Entry<String,Configuration> entry : configuration.parseNamedConfigurations().entrySet()) {
      Configuration c=defaultConfiguration.clone();
      c.applyOverrides(entry.getValue());
      configurationOverrides.put(entry.getKey(),c);
    }
    globalComponentRegistry=new GlobalComponentRegistry(globalConfiguration,this,reflectionCache,caches.keySet());
    cacheCreateLock=new ReentrantLock();
  }
 catch (  ConfigurationException ce) {
    throw ce;
  }
catch (  RuntimeException re) {
    throw new ConfigurationException(re);
  }
 finally {
    Util.close(schemaInputStream);
  }
  if (start)   start();
}
