{
  CacheWrapper existingCache=caches.get(cacheName);
  if (existingCache != null)   return existingCache.getCache();
  Configuration c;
  if (cacheName.equals(DEFAULT_CACHE_NAME) || !configurationOverrides.containsKey(cacheName))   c=defaultConfiguration.clone();
 else   c=configurationOverrides.get(cacheName);
  c.setGlobalConfiguration(globalConfiguration);
  c.assertValid();
  Cache cache=new InternalCacheFactory().createCache(c,globalComponentRegistry,cacheName,reflectionCache);
  CacheWrapper cw=new CacheWrapper(cache);
  try {
    existingCache=caches.putIfAbsent(cacheName,cw);
    if (existingCache != null) {
      throw new IllegalStateException("attempt to initialize the cache twice");
    }
    cache.start();
  }
  finally {
    cw.latch.countDown();
  }
  return cache;
}
