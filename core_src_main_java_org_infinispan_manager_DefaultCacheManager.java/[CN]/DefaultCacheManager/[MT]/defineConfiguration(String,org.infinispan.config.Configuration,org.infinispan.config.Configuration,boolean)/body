{
  assertIsNotTerminated();
  if (cacheName == null || configOverride == null)   throw new NullPointerException("Null arguments not allowed");
  if (cacheName.equals(DEFAULT_CACHE_NAME))   throw new IllegalArgumentException("Cache name cannot be used as it is a reserved, internal name");
  if (checkExisting) {
    org.infinispan.config.Configuration existing=LegacyConfigurationAdaptor.adapt(configurationOverrides.get(cacheName));
    if (existing != null) {
      existing.applyOverrides(configOverride);
      return existing.clone();
    }
  }
  org.infinispan.config.Configuration configuration=defaultConfigIfNotPresent.clone();
  configuration.applyOverrides(configOverride.clone());
  configurationOverrides.put(cacheName,LegacyConfigurationAdaptor.adapt(configuration));
  return configuration;
}
