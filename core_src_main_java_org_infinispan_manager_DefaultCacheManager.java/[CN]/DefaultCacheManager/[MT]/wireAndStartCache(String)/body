{
  CacheWrapper cacheWrapper;
synchronized (caches) {
    cacheWrapper=caches.get(cacheName);
    if (cacheWrapper != null) {
      return null;
    }
    cacheWrapper=new CacheWrapper();
    if (caches.put(cacheName,cacheWrapper) != null) {
      throw new IllegalStateException("attempt to initialize the cache twice");
    }
  }
  globalComponentRegistry.start();
  Configuration c=getConfiguration(cacheName);
  log.tracef("About to wire and start cache %s",cacheName);
  Cache<K,V> cache=new InternalCacheFactory<K,V>().createCache(c,globalComponentRegistry,cacheName);
  cacheWrapper.setCache(cache);
  try {
    cache.start();
  }
  finally {
    cacheWrapper.latch.countDown();
  }
  return cache;
}
