{
  try {
    currentTransaction.beginTransaction(null);
    for (    Database db : new Database[]{cacheDb,expiryDb}) {
      long recordCount=ois.readLong();
      log.debug("clearing and reading {0} records from stream",recordCount);
      Cursor cursor=null;
      try {
        cursor=db.openCursor(currentTransaction.getTransaction(),null);
        for (int i=0; i < recordCount; i++) {
          byte[] keyBytes=(byte[])ois.readObject();
          byte[] dataBytes=(byte[])ois.readObject();
          DatabaseEntry key=new DatabaseEntry(keyBytes);
          DatabaseEntry data=new DatabaseEntry(dataBytes);
          cursor.put(key,data);
        }
      }
  finally {
        if (cursor != null)         cursor.close();
      }
    }
    completeCurrentTransaction(true);
  }
 catch (  Exception caught) {
    completeCurrentTransaction(false);
    clear();
    throw convertToCacheLoaderException("Problems reading from stream",caught);
  }
}
