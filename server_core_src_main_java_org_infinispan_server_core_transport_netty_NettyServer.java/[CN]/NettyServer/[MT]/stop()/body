{
  ChannelGroupFuture future=serverChannels.unbind().awaitUninterruptibly();
  if (!future.isCompleteSuccess()) {
    log.warn("Server channel group did not completely unbind");
    for (    Channel ch : future.getGroup()) {
      if (ch.isBound()) {
        log.warn("{0} is still bound to {1}",ch,ch.getRemoteAddress());
      }
    }
  }
  masterExecutor.shutdown();
  try {
    masterExecutor.awaitTermination(30,TimeUnit.SECONDS);
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  workerExecutor.shutdown();
  serverChannels.close().awaitUninterruptibly();
  future=acceptedChannels.close().awaitUninterruptibly();
  if (!future.isCompleteSuccess()) {
    log.warn("Channel group did not completely close");
    for (    Channel ch : future.getGroup()) {
      if (ch.isBound()) {
        log.warn(ch + " is still connected to " + ch.getRemoteAddress());
      }
    }
  }
  log.debug("Channel group completely closed, release external resources");
  factory.releaseExternalResources();
}
