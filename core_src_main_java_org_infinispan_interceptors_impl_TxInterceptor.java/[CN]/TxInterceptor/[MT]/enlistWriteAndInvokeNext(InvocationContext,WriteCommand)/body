{
  LocalTransaction localTransaction=null;
  if (shouldEnlist(ctx)) {
    localTransaction=enlist((TxInvocationContext)ctx);
    boolean implicitWith1Pc=useOnePhaseForAutoCommitTx && localTransaction.isImplicitTransaction();
    if (implicitWith1Pc) {
      command.addFlag(Flag.SKIP_LOCKING);
    }
  }
  Object rv;
  try {
    rv=ctx.forkInvocationSync(command);
  }
 catch (  OutdatedTopologyException e) {
    throw e;
  }
catch (  Throwable throwable) {
    if (ctx.isOriginLocal() && ctx.isInTxScope() && !command.hasFlag(Flag.FAIL_SILENTLY)) {
      TxInvocationContext txCtx=(TxInvocationContext)ctx;
      txCtx.getTransaction().setRollbackOnly();
    }
    throw throwable;
  }
  if (localTransaction != null && command.isSuccessful()) {
    localTransaction.addModification(command);
  }
  return rv;
}
