{
  if (ctx.isOriginLocal()) {
    allowRehashToComplete(ctx);
    if (configuration.isEagerLockSingleNode()) {
      Map<Object,List<Address>> toMulticast=dm.locateAll(command.getKeys(),1);
      Collection<Address> where;
      if (toMulticast.size() == 1) {
        where=toMulticast.values().iterator().next();
      }
 else {
        where=new HashSet<Address>();
        for (        List<Address> values : toMulticast.values())         where.addAll(values);
      }
      rpcManager.invokeRemotely(where,command,true,true);
      ((LocalTxInvocationContext)ctx).remoteLocksAcquired(where);
    }
 else {
      Collection<Address> where=dm.getAffectedNodes(command.getKeys());
      rpcManager.invokeRemotely(where,command,true,true);
      ((LocalTxInvocationContext)ctx).remoteLocksAcquired(where);
    }
    ctx.addAffectedKeys(command.getKeys());
  }
  return invokeNextInterceptor(ctx,command);
}
