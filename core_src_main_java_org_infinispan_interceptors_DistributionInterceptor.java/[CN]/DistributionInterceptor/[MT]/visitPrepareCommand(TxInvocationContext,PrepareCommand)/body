{
  Object retVal=invokeNextInterceptor(ctx,command);
  if (shouldInvokeRemoteTxCommand(ctx)) {
    if (command.isOnePhaseCommit())     flushL1Caches(ctx);
    boolean affectsAllNodes=ctx.getCacheTransaction().hasModification(ClearCommand.class);
    Collection<Address> recipients=affectsAllNodes ? dm.getConsistentHash().getMembers() : dm.getAffectedNodes(ctx.getAffectedKeys());
    prepareOnAffectedNodes(ctx,command,recipients,defaultSynchronous);
    ((LocalTxInvocationContext)ctx).remoteLocksAcquired(recipients);
  }
 else   if (isL1CacheEnabled && command.isOnePhaseCommit() && !ctx.isOriginLocal()&& !ctx.getLockedKeys().isEmpty()) {
    flushL1Caches(ctx);
  }
  return retVal;
}
