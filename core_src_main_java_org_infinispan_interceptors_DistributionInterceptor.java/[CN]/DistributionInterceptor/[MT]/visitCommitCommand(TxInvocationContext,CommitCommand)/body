{
  if (shouldInvokeRemoteTxCommand(ctx)) {
    Collection<Address> preparedOn=((LocalTxInvocationContext)ctx).getRemoteLocksAcquired();
    List<Address> recipients=dm.getAffectedNodes(ctx.getAffectedKeys());
    boolean goodToCommit=recipients.containsAll(preparedOn);
    if (!goodToCommit)     throw new IllegalStateException("Can not commit since " + ctx.getGlobalTransaction() + " was prepared on "+ preparedOn+ " nodes while it is being committed to "+ recipients);
    NotifyingNotifiableFuture<Object> f=flushL1Cache(recipients.size(),ctx.getLockedKeys(),null);
    rpcManager.invokeRemotely(recipients,command,configuration.isSyncCommitPhase(),true);
    if (f != null && configuration.isSyncCommitPhase())     try {
      f.get();
    }
 catch (    Exception e) {
      if (log.isInfoEnabled())       log.info("Failed invalidating remote cache: ",e);
    }
  }
  return invokeNextInterceptor(ctx,command);
}
