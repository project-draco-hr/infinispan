{
  deleted(pid);
  String config=(String)properties.get("config");
  if (config == null) {
    throw new ConfigurationException("config","Property must be set");
  }
  String instanceId=(String)properties.get(INSTANCE_ID);
  if (instanceId == null) {
    throw new ConfigurationException(INSTANCE_ID,"Property must be set");
  }
  ClassLoader classLoader=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(DefaultCacheManager.class.getClassLoader());
    DefaultCacheManager cacheManager=new DefaultCacheManager(config);
    cacheManager.start();
    cacheManagers.put(pid,cacheManager);
    Hashtable ht=new Hashtable();
    ht.put(Constants.SERVICE_PID,pid);
    ht.put(INSTANCE_ID,instanceId);
    ServiceRegistration serviceRegistration=bundleContext.registerService(EmbeddedCacheManager.class.getName(),cacheManager,ht);
    managedRegistrations.put(pid,serviceRegistration);
  }
 catch (  Exception e) {
    throw new ConfigurationException(null,"Cannot start the CacheManager",e);
  }
 finally {
    Thread.currentThread().setContextClassLoader(classLoader);
  }
}
