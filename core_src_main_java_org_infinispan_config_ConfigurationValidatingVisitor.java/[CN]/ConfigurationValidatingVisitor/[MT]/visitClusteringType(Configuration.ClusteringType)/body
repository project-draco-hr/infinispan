{
  Configuration.CacheMode mode=clusteringType.mode;
  Configuration.AsyncType async=clusteringType.async;
  Configuration.StateRetrievalType state=clusteringType.stateRetrieval;
  if (mode.isInvalidation() && state.fetchInMemoryState)   throw new ConfigurationException("Cache cannot use INVALIDATION mode and have fetchInMemoryState set to true.");
  if (mode.isDistributed() && async.useReplQueue)   throw new ConfigurationException("Use of the replication queue is invalid when using DISTRIBUTED mode.");
  if (mode.isSynchronous() && async.useReplQueue)   throw new ConfigurationException("Use of the replication queue is only allowed with an ASYNCHRONOUS cluster mode.");
  Set<String> overriden=clusteringType.stateRetrieval.overriddenConfigurationElements;
  if (mode.isReplicated() && !state.isFetchInMemoryState() && !overriden.contains("fetchInMemoryState")) {
    log.debug("Cache is replicated but state transfer was not defined, so force enabling it");
    state.fetchInMemoryState(true);
  }
}
