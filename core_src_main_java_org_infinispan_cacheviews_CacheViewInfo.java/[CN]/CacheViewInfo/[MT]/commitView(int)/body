{
  log.tracef("%s: Committing view %s",cacheName,viewId);
synchronized (lock) {
    if ((pendingView == null && viewId != committedView.getViewId()) || viewId != pendingView.getViewId())     throw new IllegalArgumentException(String.format("Cannot commit view %d, we are currently preparing view %s",viewId,pendingView));
    committedView=pendingView;
    pendingView=null;
  }
}
