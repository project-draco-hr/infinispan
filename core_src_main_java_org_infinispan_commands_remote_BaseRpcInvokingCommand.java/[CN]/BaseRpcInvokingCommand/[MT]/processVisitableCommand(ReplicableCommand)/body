{
  if (cacheCommand instanceof VisitableCommand) {
    VisitableCommand vc=(VisitableCommand)cacheCommand;
    final InvocationContext ctx;
    if (vc instanceof FlagAffectedCommand) {
      ctx=icc.createRemoteInvocationContextForCommand(vc,getOrigin());
    }
 else {
      ctx=icc.createRemoteInvocationContext(getOrigin());
    }
    if (vc.shouldInvoke(ctx)) {
      if (trace)       log.trace("Invoking command " + cacheCommand + ", with originLocal flag set to "+ ctx.isOriginLocal()+ ".");
      return interceptorChain.invoke(ctx,vc);
    }
 else {
      if (trace)       log.trace("Not invoking command " + cacheCommand + " since shouldInvoke() returned false with context "+ ctx);
      return null;
    }
  }
 else {
    throw new RuntimeException("Do we still need to deal with non-visitable commands? (" + cacheCommand.getClass().getName() + ")");
  }
}
