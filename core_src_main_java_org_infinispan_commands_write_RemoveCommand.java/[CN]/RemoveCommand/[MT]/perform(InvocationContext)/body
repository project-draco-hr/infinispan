{
  CacheEntry e=ctx.lookupEntry(key);
  if (e == null || e.isNull()) {
    nonExistent=true;
    log.trace("Nothing to remove since the entry is null or we have a null entry");
    if (value == null) {
      return null;
    }
 else {
      successful=false;
      return false;
    }
  }
  if (!(e instanceof MVCCEntry))   ctx.putLookedUpEntry(key,null);
  if (value != null && e.getValue() != null && !e.getValue().equals(value)) {
    successful=false;
    return false;
  }
  final Object removedValue=e.getValue();
  if (removedValue != null && removedValue instanceof AtomicHashMap)   markAtomicMapRemoved((AtomicHashMap)removedValue);
  notify(ctx,removedValue,true);
  e.setRemoved(true);
  e.setValid(false);
  if (this instanceof EvictCommand) {
    notify(ctx,removedValue,false);
  }
 else {
    notify(ctx,null,false);
  }
  return value == null ? removedValue : true;
}
