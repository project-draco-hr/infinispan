{
  List<NotifyingFuture<String>> futures=new ArrayList<>();
  final CountDownLatch startLatch=new CountDownLatch(1);
  final CountDownLatch endLatch=new CountDownLatch(1);
  for (int i=0; i < 100; i++) {
    futures.add(createImmediate("res" + i,startLatch));
  }
  NotifyingFuture<List<String>> compositeFuture=Futures.combine(futures);
  final AtomicInteger triggerCount=new AtomicInteger(0);
  compositeFuture.attachListener(new FutureListener<List<String>>(){
    @Override public void futureDone(    Future<List<String>> future){
      assertTrue(future.isDone());
      assertFalse(future.isCancelled());
      assertNoErrors(future);
      try {
        List<String> result=future.get();
        for (int i=0; i < 100; i++) {
          assertTrue(result.contains("res" + 1));
        }
      }
 catch (      InterruptedException|ExecutionException ignored) {
      }
      triggerCount.incrementAndGet();
      endLatch.countDown();
    }
  }
);
  startLatch.countDown();
  endLatch.await();
  assertEquals(1,triggerCount.get());
  assertTrue(compositeFuture.isDone());
  assertFalse(compositeFuture.isCancelled());
  assertAllDone(futures);
}
