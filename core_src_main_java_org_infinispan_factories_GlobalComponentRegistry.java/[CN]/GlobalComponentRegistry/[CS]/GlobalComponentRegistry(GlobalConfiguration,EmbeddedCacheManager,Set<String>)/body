{
  super(configuration.getClassLoader());
  if (configuration == null)   throw new NullPointerException("GlobalConfiguration cannot be null!");
  moduleLifecycles=moduleProperties.resolveModuleLifecycles(defaultClassLoader);
  try {
    globalConfiguration=configuration;
    registerComponent(this,GlobalComponentRegistry.class);
    registerComponent(cacheManager,EmbeddedCacheManager.class);
    registerComponent(configuration,GlobalConfiguration.class);
    registerComponent(new CacheManagerJmxRegistration(),CacheManagerJmxRegistration.class);
    registerComponent(new CacheManagerNotifierImpl(),CacheManagerNotifier.class);
    moduleProperties.loadModuleCommandHandlers(configuration.getClassLoader());
    Map<Byte,ModuleCommandFactory> factories=moduleProperties.moduleCommandFactories();
    if (factories != null && !factories.isEmpty())     registerNonVolatileComponent(factories,KnownComponentNames.MODULE_COMMAND_FACTORIES);
 else     registerNonVolatileComponent(Collections.<Object,Object>emptyMap(),KnownComponentNames.MODULE_COMMAND_FACTORIES);
    this.createdCaches=createdCaches;
  }
 catch (  Exception e) {
    throw new CacheException("Unable to construct a GlobalComponentRegistry!",e);
  }
}
