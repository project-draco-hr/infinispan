{
  super(configuration.classLoader());
  moduleLifecycles=moduleProperties.resolveModuleLifecycles(defaultClassLoader);
  ComponentMetadataRepo.initialize(moduleProperties.getModuleMetadataFiles(defaultClassLoader),defaultClassLoader);
  try {
    globalConfiguration=configuration;
    registerComponent(this,GlobalComponentRegistry.class);
    registerComponent(configuration,GlobalConfiguration.class);
    registerComponent(cacheManager,EmbeddedCacheManager.class);
    registerComponent(new CacheManagerJmxRegistration(),CacheManagerJmxRegistration.class);
    registerComponent(new CacheManagerNotifierImpl(),CacheManagerNotifier.class);
    moduleProperties.loadModuleCommandHandlers(configuration.classLoader());
    Map<Byte,ModuleCommandFactory> factories=moduleProperties.moduleCommandFactories();
    if (factories != null && !factories.isEmpty())     registerNonVolatileComponent(factories,KnownComponentNames.MODULE_COMMAND_FACTORIES);
 else     registerNonVolatileComponent(Collections.<Object,Object>emptyMap(),KnownComponentNames.MODULE_COMMAND_FACTORIES);
    this.createdCaches=createdCaches;
    getOrCreateComponent(Transport.class);
  }
 catch (  Exception e) {
    throw new CacheException("Unable to construct a GlobalComponentRegistry!",e);
  }
}
