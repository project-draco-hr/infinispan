{
  if (trace)   log.tracef("Doing a remote get for key %s",key);
  boolean acquireRemoteLock=false;
  if (ctx.isInTxScope() && ctx.isOriginLocal()) {
    TxInvocationContext txContext=(TxInvocationContext)ctx;
    acquireRemoteLock=isWrite && isPessimisticCache && !txContext.getAffectedKeys().contains(key);
  }
  InternalCacheEntry ice=retrieveFromRemoteSource(key,ctx,acquireRemoteLock,command,isWrite);
  if (acquireRemoteLock) {
    ((TxInvocationContext)ctx).addAffectedKey(key);
  }
  if (ice != null) {
    if (useClusteredWriteSkewCheck && ctx.isInTxScope()) {
      ((TxInvocationContext)ctx).getCacheTransaction().putLookedUpRemoteVersion(key,ice.getMetadata().version());
    }
    EntryFactory.Wrap wrap=isWrite ? EntryFactory.Wrap.WRAP_NON_NULL : EntryFactory.Wrap.STORE;
    entryFactory.wrapExternalEntry(ctx,key,ice,wrap,false);
    return ice;
  }
  return null;
}
