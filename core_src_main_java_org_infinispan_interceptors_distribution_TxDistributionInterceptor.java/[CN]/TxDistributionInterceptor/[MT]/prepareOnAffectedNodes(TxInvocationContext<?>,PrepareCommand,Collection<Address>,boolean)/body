{
  try {
    RpcOptions rpcOptions;
    if (sync && command.isOnePhaseCommit()) {
      rpcOptions=rpcManager.getRpcOptionsBuilder(ResponseMode.SYNCHRONOUS_IGNORE_LEAVERS,DeliverOrder.NONE).build();
    }
 else {
      rpcOptions=rpcManager.getDefaultRpcOptions(sync);
    }
    Map<Address,Response> responseMap=rpcManager.invokeRemotely(recipients,command,rpcOptions);
    checkTxCommandResponses(responseMap);
  }
  finally {
    transactionRemotelyPrepared(ctx);
  }
}
