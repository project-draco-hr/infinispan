{
  InternalCacheEntry ice=dataContainer.get(key);
  if (ice != null) {
    if (isWrite && isPessimisticCache && ctx.isInTxScope()) {
      ((TxInvocationContext)ctx).addAffectedKey(key);
    }
    if (!ctx.replaceValue(key,ice.getValue())) {
      if (isWrite)       lockAndWrap(ctx,key,ice,command);
 else       ctx.putLookedUpEntry(key,ice);
    }
    return command instanceof GetCacheEntryCommand ? ice : ice.getValue();
  }
  return null;
}
