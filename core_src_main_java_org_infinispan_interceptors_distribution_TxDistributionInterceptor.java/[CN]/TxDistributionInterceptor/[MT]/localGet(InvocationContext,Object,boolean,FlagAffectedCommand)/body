{
  CacheEntry ce=ctx.lookupEntry(key);
  if (ce == null || ce.isNull() || ce.isLockPlaceholder() || ce.getValue() == null) {
    InternalCacheEntry ice=dataContainer.get(key);
    if (ice != null) {
      if (isWrite && isPessimisticCache && ctx.isInTxScope()) {
        ((TxInvocationContext)ctx).addAffectedKey(key);
      }
      if (ce != null && ce.isChanged()) {
        ce.setValue(ice.getValue());
      }
 else {
        if (isWrite)         lockAndWrap(ctx,key,ice,command);
 else         ctx.putLookedUpEntry(key,ice);
      }
      return command instanceof GetCacheEntryCommand ? ice : ice.getValue();
    }
  }
  return null;
}
