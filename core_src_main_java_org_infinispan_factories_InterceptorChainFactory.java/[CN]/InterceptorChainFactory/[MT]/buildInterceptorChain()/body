{
  boolean invocationBatching=configuration.isInvocationBatchingEnabled();
  boolean autoCommit=configuration.isTransactionAutoCommit() && configuration.isTransactionalCache();
  CommandInterceptor first;
  if (invocationBatching) {
    first=createInterceptor(BatchingInterceptor.class);
  }
 else {
    first=autoCommit ? createInterceptor(AutoCommitInterceptor.class) : createInterceptor(InvocationContextInterceptor.class);
  }
  InterceptorChain interceptorChain=new InterceptorChain(first);
  componentRegistry.registerComponent(interceptorChain,InterceptorChain.class);
  if (isUsingMarshalledValues(configuration) || configuration.isUseAsyncMarshalling() || configuration.isUseReplQueue()|| hasAsyncStore())   interceptorChain.appendInterceptor(createInterceptor(IsMarshallableInterceptor.class));
  if (invocationBatching) {
    if (autoCommit)     interceptorChain.appendInterceptor(createInterceptor(AutoCommitInterceptor.class));
    interceptorChain.appendInterceptor(createInterceptor(InvocationContextInterceptor.class));
  }
 else   if (autoCommit) {
    interceptorChain.appendInterceptor(createInterceptor(InvocationContextInterceptor.class));
  }
  if (configuration.isExposeJmxStatistics())   interceptorChain.appendInterceptor(createInterceptor(CacheMgmtInterceptor.class));
  if (configuration.getCacheMode().isDistributed())   interceptorChain.appendInterceptor(createInterceptor(DistTxInterceptor.class));
 else   interceptorChain.appendInterceptor(createInterceptor(TxInterceptor.class));
  if (isUsingMarshalledValues(configuration))   interceptorChain.appendInterceptor(createInterceptor(MarshalledValueInterceptor.class));
  interceptorChain.appendInterceptor(createInterceptor(NotificationInterceptor.class));
  if (configuration.isEnableDeadlockDetection()) {
    interceptorChain.appendInterceptor(createInterceptor(DeadlockDetectingInterceptor.class));
  }
  if (configuration.isUsingCacheLoaders()) {
    if (configuration.getCacheLoaderManagerConfig().isPassivation()) {
      interceptorChain.appendInterceptor(createInterceptor(ActivationInterceptor.class));
      interceptorChain.appendInterceptor(createInterceptor(PassivationInterceptor.class));
    }
 else {
      interceptorChain.appendInterceptor(createInterceptor(CacheLoaderInterceptor.class));
switch (configuration.getCacheMode()) {
case DIST_SYNC:
case DIST_ASYNC:
        interceptorChain.appendInterceptor(createInterceptor(DistCacheStoreInterceptor.class));
      break;
default :
    interceptorChain.appendInterceptor(createInterceptor(CacheStoreInterceptor.class));
  break;
}
}
}
if (configuration.isTransactionalCache()) {
if (configuration.getTransactionLockingMode() == LockingMode.PESSIMISTIC) {
interceptorChain.appendInterceptor(createInterceptor(PessimisticLockingInterceptor.class));
}
 else {
interceptorChain.appendInterceptor(createInterceptor(OptimisticLockingInterceptor.class));
}
}
 else {
interceptorChain.appendInterceptor(createInterceptor(NonTransactionalLockingInterceptor.class));
}
switch (configuration.getCacheMode()) {
case REPL_SYNC:
case REPL_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(ReplicationInterceptor.class));
break;
case INVALIDATION_SYNC:
case INVALIDATION_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(InvalidationInterceptor.class));
break;
case DIST_SYNC:
case DIST_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(DistributionInterceptor.class));
break;
case LOCAL:
}
CommandInterceptor callInterceptor=createInterceptor(CallInterceptor.class);
interceptorChain.appendInterceptor(callInterceptor);
if (log.isTraceEnabled()) log.trace("Finished building default interceptor chain.");
buildCustomInterceptors(interceptorChain,configuration.getCustomInterceptors());
return interceptorChain;
}
