{
  boolean invocationBatching=configuration.isInvocationBatchingEnabled();
  CommandInterceptor first=invocationBatching ? createInterceptor(BatchingInterceptor.class) : createInterceptor(InvocationContextInterceptor.class);
  InterceptorChain interceptorChain=new InterceptorChain(first);
  componentRegistry.registerComponent(interceptorChain,InterceptorChain.class);
  if (isUsingMarshalledValues(configuration) || configuration.isUseAsyncMarshalling() || configuration.isUseReplQueue()|| hasAsyncStore())   interceptorChain.appendInterceptor(createInterceptor(IsMarshallableInterceptor.class));
  if (invocationBatching)   interceptorChain.appendInterceptor(createInterceptor(InvocationContextInterceptor.class));
  if (configuration.isExposeJmxStatistics())   interceptorChain.appendInterceptor(createInterceptor(CacheMgmtInterceptor.class));
  if ((configuration.getCacheMode().isDistributed() && configuration.isRehashEnabled()) || (configuration.getCacheMode().isReplicated() && configuration.isStateTransferEnabled()))   interceptorChain.appendInterceptor(createInterceptor(StateTransferLockInterceptor.class));
  if (configuration.getCacheMode().isDistributed())   interceptorChain.appendInterceptor(createInterceptor(DistTxInterceptor.class));
 else   interceptorChain.appendInterceptor(createInterceptor(TxInterceptor.class));
  if (configuration.isUseEagerLocking())   interceptorChain.appendInterceptor(createInterceptor(ImplicitEagerLockingInterceptor.class));
  if (isUsingMarshalledValues(configuration))   interceptorChain.appendInterceptor(createInterceptor(MarshalledValueInterceptor.class));
  interceptorChain.appendInterceptor(createInterceptor(NotificationInterceptor.class));
  if (configuration.isEnableDeadlockDetection()) {
    interceptorChain.appendInterceptor(createInterceptor(DeadlockDetectingInterceptor.class));
  }
  if (configuration.isUsingCacheLoaders()) {
    if (configuration.getCacheLoaderManagerConfig().isPassivation()) {
      interceptorChain.appendInterceptor(createInterceptor(ActivationInterceptor.class));
      interceptorChain.appendInterceptor(createInterceptor(PassivationInterceptor.class));
    }
 else {
      interceptorChain.appendInterceptor(createInterceptor(CacheLoaderInterceptor.class));
switch (configuration.getCacheMode()) {
case DIST_SYNC:
case DIST_ASYNC:
        interceptorChain.appendInterceptor(createInterceptor(DistCacheStoreInterceptor.class));
      break;
default :
    interceptorChain.appendInterceptor(createInterceptor(CacheStoreInterceptor.class));
  break;
}
}
}
if (configuration.getCacheMode().isDistributed()) interceptorChain.appendInterceptor(createInterceptor(DistLockingInterceptor.class));
 else interceptorChain.appendInterceptor(createInterceptor(LockingInterceptor.class));
switch (configuration.getCacheMode()) {
case REPL_SYNC:
case REPL_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(ReplicationInterceptor.class));
break;
case INVALIDATION_SYNC:
case INVALIDATION_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(InvalidationInterceptor.class));
break;
case DIST_SYNC:
case DIST_ASYNC:
interceptorChain.appendInterceptor(createInterceptor(DistributionInterceptor.class));
break;
case LOCAL:
}
CommandInterceptor callInterceptor=createInterceptor(CallInterceptor.class);
interceptorChain.appendInterceptor(callInterceptor);
if (log.isTraceEnabled()) log.trace("Finished building default interceptor chain.");
buildCustomInterceptors(interceptorChain,configuration.getCustomInterceptors());
return interceptorChain;
}
