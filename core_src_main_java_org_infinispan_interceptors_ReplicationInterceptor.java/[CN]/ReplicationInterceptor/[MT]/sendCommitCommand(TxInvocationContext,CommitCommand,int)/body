{
  try {
    Map<Address,Response> responses=rpcManager.invokeRemotely(null,command,configuration.isSyncCommitPhase(),true);
    if (!responses.isEmpty()) {
      List<Address> resendTo=new LinkedList<Address>();
      for (      Map.Entry<Address,Response> r : responses.entrySet()) {
        if (needToResendPrepare(r.getValue()))         resendTo.add(r.getKey());
      }
      if (!resendTo.isEmpty()) {
        log.debugf("Need to resend prepares for %s to %s",command.getGlobalTransaction(),resendTo);
        PrepareCommand pc=cf.buildPrepareCommand(command.getGlobalTransaction(),ctx.getModifications(),true);
        rpcManager.invokeRemotely(resendTo,pc,true,true);
      }
    }
  }
 catch (  RehashInProgressException e) {
    allowStateTransferToComplete(ctx);
    if (retries > 0) {
      sendCommitCommand(ctx,command,retries - 1);
    }
 else {
      throw e;
    }
  }
catch (  SuspectException e) {
    allowStateTransferToComplete(ctx);
    if (retries > 0) {
      sendCommitCommand(ctx,command,retries - 1);
    }
 else {
      throw e;
    }
  }
}
