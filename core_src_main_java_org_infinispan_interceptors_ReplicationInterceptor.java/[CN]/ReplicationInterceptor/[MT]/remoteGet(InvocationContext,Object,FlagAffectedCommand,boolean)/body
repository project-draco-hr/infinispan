{
  if (trace) {
    log.tracef("Key %s is not yet available on %s, so we may need to look elsewhere",toStr(key),rpcManager.getAddress());
  }
  boolean acquireRemoteLock=false;
  if (ctx.isInTxScope()) {
    TxInvocationContext txContext=(TxInvocationContext)ctx;
    acquireRemoteLock=isWrite && isPessimisticCache && !txContext.getAffectedKeys().contains(key);
  }
  InternalCacheEntry ice=retrieveFromRemoteSource(key,ctx,acquireRemoteLock,command);
  if (acquireRemoteLock) {
    ((TxInvocationContext)ctx).addAffectedKey(key);
  }
  if (ice != null) {
    if (!ctx.replaceValue(key,ice)) {
      if (isWrite) {
        lockAndWrap(ctx,key,ice,command);
      }
 else {
        ctx.putLookedUpEntry(key,ice);
      }
    }
    return ice.getValue();
  }
  return null;
}
