{
  long currentTimeMillis=0;
  int size=entrySet.size();
  for (  InternalCacheEntry e : entrySet) {
    if (e.canExpire()) {
      if (currentTimeMillis == 0)       currentTimeMillis=timeService.wallClockTime();
      if (e.isExpired(currentTimeMillis))       size--;
    }
  }
  for (  CacheEntry e : lookedUpEntries.values()) {
    if (e.isCreated()) {
      size++;
    }
 else     if (e.isRemoved()) {
      size--;
    }
  }
  return Math.max(size,0);
}
