{
  final MBeanServerLookup expectedMBeanServerLookup=new PlatformMBeanServerLookup();
  final InfinispanEmbeddedCacheManagerFactoryBean objectUnderTest=new TestInfinispanEmbeddedCacheManagerFactoryBean();
  objectUnderTest.setMBeanServerLookup(expectedMBeanServerLookup);
  objectUnderTest.afterPropertiesSet();
  withCacheManager(new CacheManagerCallable(objectUnderTest.getObject()){
    @Override public void call(){
      assertSame("SpringEmbeddedCacheManagerFactoryBean should have used explicitly set MBeanServerLookup. However, it didn't.",expectedMBeanServerLookup,cm.getCacheManagerConfiguration().globalJmxStatistics().mbeanServerLookup());
    }
  }
);
}
