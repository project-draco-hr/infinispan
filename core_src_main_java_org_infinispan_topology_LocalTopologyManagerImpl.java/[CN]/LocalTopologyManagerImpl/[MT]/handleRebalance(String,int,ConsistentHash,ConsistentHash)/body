{
  LocalCacheStatus cacheStatus=runningCaches.get(cacheName);
  if (cacheStatus == null) {
    log.tracef("Ignoring rebalance %s for cache %s that doesn't exist locally",topologyId,cacheName);
    return;
  }
  log.debugf("Starting local rebalance for cache %s, topology id = %d, new CH = %s",cacheName,topologyId,pendingCH);
  cacheStatus.joinedLatch.await();
  cacheStatus.topology=new CacheTopology(topologyId,currentCH,pendingCH);
  ConsistentHash unionCH=cacheStatus.joinInfo.getConsistentHashFactory().union(currentCH,pendingCH);
  CacheTopologyHandler handler=cacheStatus.handler;
  try {
    handler.rebalance(topologyId,currentCH,unionCH);
  }
  finally {
    ReplicableCommand command=new CacheTopologyControlCommand(cacheName,CacheTopologyControlCommand.Type.REBALANCE_CONFIRM,transport.getAddress(),topologyId,null,null);
    try {
      executeOnCoordinatorAsync(command);
    }
 catch (    Exception e) {
      log.debugf(e,"Error sending the rebalance completed notification for cache %s to coordinator",cacheName);
    }
  }
}
