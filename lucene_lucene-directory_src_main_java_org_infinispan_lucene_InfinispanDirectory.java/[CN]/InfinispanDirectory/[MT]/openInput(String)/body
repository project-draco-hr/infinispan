{
  final FileCacheKey fileKey=new FileCacheKey(indexName,name);
  FileMetadata fileMetadata=(FileMetadata)metadataCache.get(fileKey);
  if (fileMetadata == null) {
    throw new FileNotFoundException("Error loading metadata for index file: " + fileKey);
  }
 else   if (fileMetadata.getSize() <= fileMetadata.getBufferSize()) {
    IndexInputContext iic=new IndexInputContext(chunksCache,fileKey,fileMetadata,null);
    return new SingleChunkIndexInput(iic);
  }
 else {
    boolean locked=readLocks.acquireReadLock(name);
    if (!locked) {
      throw new FileNotFoundException("Error loading metadata for index file: " + fileKey);
    }
    IndexInputContext iic=new IndexInputContext(chunksCache,fileKey,fileMetadata,readLocks);
    return new InfinispanIndexInputV3(iic);
  }
}
