{
  final Object[] affectedKeys=command.getAffectedKeysToLock(true);
  ((TxInvocationContext<?>)ctx).addAllAffectedKeys(command.getAffectedKeys());
  if (affectedKeys.length != 0) {
    Collection<Object> lockedKeys=lockAllOrRegisterBackupLock(ctx,Arrays.asList(affectedKeys),cacheConfiguration.locking().lockAcquisitionTimeout());
    if (!lockedKeys.isEmpty()) {
      for (      Object key : lockedKeys) {
        performLocalWriteSkewCheck(ctx,key);
      }
    }
  }
  return invokeNextAndCommitIf1Pc(ctx,command);
}
