{
  final Collection<Object> keysToLock=command.getKeysToLock();
  ((TxInvocationContext<?>)ctx).addAllAffectedKeys(command.getAffectedKeys());
  if (!keysToLock.isEmpty()) {
    Collection<Object> lockedKeys=lockAllOrRegisterBackupLock(ctx,keysToLock,cacheConfiguration.locking().lockAcquisitionTimeout());
    if (!lockedKeys.isEmpty()) {
      for (      Object key : lockedKeys) {
        performLocalWriteSkewCheck(ctx,key);
      }
    }
  }
  return invokeNextAndCommitIf1Pc(ctx,command);
}
