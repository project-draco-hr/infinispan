{
  byte[] bytes=new byte[size];
  try {
    size=socket.getInputStream().read(bytes);
  }
 catch (  IOException e) {
    throw new TransportException(e);
  }
  if (size == -1) {
    throw new RuntimeException("End of stream reached!");
  }
  if (size != bytes.length) {
    throw new TransportException("Expected " + bytes.length + " bytes but only could read "+ size+ " bytes!");
  }
  return bytes;
}
