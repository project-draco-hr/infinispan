{
  byte type=input.readByte();
  byte methodId=(byte)input.readShort();
  String cacheName=input.readUTF();
  StreamingMarshaller marshaller=getCacheMarshaller(cacheName);
  ObjectInput paramsInput=reusableObjectInput.get();
  final boolean firsTime=paramsInput == null;
  if (firsTime) {
    paramsInput=marshaller.startObjectInput(convertInputStream(input),true);
    if (paramsInput instanceof ExtendedRiverUnmarshaller) {
      ((ExtendedRiverUnmarshaller)paramsInput).setInfinispanMarshaller(marshaller);
    }
    reusableObjectInput.set(paramsInput);
  }
  CacheRpcCommand cacheRpcCommand;
  try {
    cacheRpcCommand=cmdExt.fromStream(methodId,cmdExt.readLegacyParameters(paramsInput),type,cacheName);
    cmdExt.readCommandParameters(paramsInput,cacheRpcCommand);
  }
  finally {
    if (firsTime) {
      marshaller.finishObjectInput(paramsInput);
      reusableObjectInput.remove();
    }
  }
  return cacheRpcCommand;
}
