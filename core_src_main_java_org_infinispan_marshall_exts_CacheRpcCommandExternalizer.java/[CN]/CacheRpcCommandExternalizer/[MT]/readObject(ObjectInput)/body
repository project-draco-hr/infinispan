{
  byte type=input.readByte();
  byte methodId=(byte)input.readShort();
  String cacheName=input.readUTF();
  ComponentRegistry registry=gcr.getNamedComponentRegistry(cacheName);
  StreamingMarshaller marshaller;
  if (registry == null) {
    marshaller=globalMarshaller;
  }
 else {
    marshaller=registry.getCacheMarshaller();
  }
  byte[] paramsRaw=new byte[UnsignedNumeric.readUnsignedInt(input)];
  input.readFully(paramsRaw);
  ByteArrayInputStream is=new ByteArrayInputStream(paramsRaw,0,paramsRaw.length);
  ObjectInput paramsInput=marshaller.startObjectInput(is,true);
  if (paramsInput instanceof ExtendedRiverUnmarshaller)   ((ExtendedRiverUnmarshaller)paramsInput).setInfinispanMarshaller(marshaller);
  try {
    Object[] args=cmdExt.readParameters(paramsInput);
    CacheRpcCommand cacheRpcCommand=cmdExt.fromStream(methodId,args,type,cacheName);
    if (cacheRpcCommand instanceof TopologyAffectedCommand) {
      int topologyId=input.readInt();
      ((TopologyAffectedCommand)cacheRpcCommand).setTopologyId(topologyId);
    }
    return cacheRpcCommand;
  }
  finally {
    marshaller.finishObjectInput(paramsInput);
  }
}
