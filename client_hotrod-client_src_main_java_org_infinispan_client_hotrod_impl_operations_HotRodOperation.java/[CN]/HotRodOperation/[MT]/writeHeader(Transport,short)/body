{
  transport.writeByte(HotRodConstants.REQUEST_MAGIC);
  long messageId=MSG_ID.incrementAndGet();
  transport.writeVLong(messageId);
  transport.writeByte(HotRodConstants.HOTROD_VERSION);
  transport.writeByte(operationCode);
  transport.writeArray(cacheName);
  int flagInt=0;
  if (flags != null) {
    for (    Flag flag : flags) {
      flagInt=flag.getFlagInt() | flagInt;
    }
  }
  transport.writeVInt(flagInt);
  transport.writeByte(CLIENT_INTELLIGENCE_HASH_DISTRIBUTION_AWARE);
  transport.writeVInt(topologyId.get());
  transport.writeByte(NO_TX);
  if (log.isTraceEnabled()) {
    log.trace("wrote header for message %d. Operation code: %#04x. Flags: %#x",messageId,operationCode,flagInt);
  }
  return messageId;
}
