{
  short magic=transport.readByte();
  if (magic != HotRodConstants.RESPONSE_MAGIC) {
    String message="Invalid magic number. Expected %#x and received %#x";
    log.invalidMagicNumber(HotRodConstants.RESPONSE_MAGIC,magic);
    throw new InvalidResponseException(String.format(message,HotRodConstants.RESPONSE_MAGIC,magic));
  }
  long receivedMessageId=transport.readVLong();
  if (receivedMessageId != messageId) {
    String message="Invalid message id. Expected %d and received %d";
    log.invalidMessageId(messageId,receivedMessageId);
    throw new InvalidResponseException(String.format(message,messageId,receivedMessageId));
  }
  if (log.isTraceEnabled()) {
    log.tracef("Received response for message id: %d",receivedMessageId);
  }
  short receivedOpCode=transport.readByte();
  if (receivedOpCode != opRespCode) {
    if (receivedOpCode == HotRodConstants.ERROR_RESPONSE) {
      checkForErrorsInResponseStatus(transport.readByte(),messageId,transport);
    }
    throw new InvalidResponseException(String.format("Invalid response operation. Expected %#x and received %#x",opRespCode,receivedOpCode));
  }
  if (log.isTraceEnabled()) {
    log.tracef("Received operation code is: %#04x",receivedOpCode);
  }
  short status=transport.readByte();
  readNewTopologyIfPresent(transport);
  return status;
}
