{
  Object entryValue=e.getValue();
  Object o;
  if (!e.isCreated()) {
    notifier.notifyCacheEntryModified(key,value,entryValue,e.getMetadata(),true,ctx,this);
  }
  if (value instanceof Delta) {
    Delta dv=(Delta)value;
    DeltaAware toMergeWith=null;
    if (entryValue instanceof CopyableDeltaAware) {
      toMergeWith=((CopyableDeltaAware)entryValue).copy();
    }
 else     if (entryValue instanceof DeltaAware) {
      toMergeWith=(DeltaAware)entryValue;
    }
    e.setValue(dv.merge(toMergeWith));
    o=entryValue;
  }
 else {
    o=e.setValue(value);
    if (e.isRemoved()) {
      e.setRemoved(false);
      e.setValid(true);
      o=null;
    }
  }
  e.setChanged(true);
  return valueMatcher != ValueMatcher.MATCH_EXPECTED_OR_NEW ? o : null;
}
