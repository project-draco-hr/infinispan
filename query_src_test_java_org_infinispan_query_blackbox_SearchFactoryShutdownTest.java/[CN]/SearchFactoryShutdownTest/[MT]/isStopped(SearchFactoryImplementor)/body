{
  if (sfi instanceof MutableSearchFactory) {
    try {
      Field delegateField=MutableSearchFactory.class.getDeclaredField("delegate");
      delegateField.setAccessible(true);
      sfi=(SearchFactoryImplementor)delegateField.get(sfi);
    }
 catch (    Exception e) {
      throw new RuntimeException("Cannot test running state of the search factory",e);
    }
  }
  if (sfi instanceof ImmutableSearchFactory) {
    try {
      Field status=ImmutableSearchFactory.class.getDeclaredField("stopped");
      status.setAccessible(true);
      AtomicBoolean b=(AtomicBoolean)status.get(sfi);
      return b.get();
    }
 catch (    Exception e) {
      throw new RuntimeException("Cannot test running state of the search factory",e);
    }
  }
  throw new RuntimeException("Cannot test running state of the search factory as it is neither a MutableSearchFactory nor an ImmutableSearchFactory");
}
