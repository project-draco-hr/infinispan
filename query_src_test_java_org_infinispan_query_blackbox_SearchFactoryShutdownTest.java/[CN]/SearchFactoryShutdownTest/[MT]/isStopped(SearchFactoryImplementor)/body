{
  if (sfi instanceof ImmutableSearchFactory) {
    try {
      Field status=ImmutableSearchFactory.class.getDeclaredField("stopped");
      status.setAccessible(true);
      AtomicBoolean b=(AtomicBoolean)status.get(sfi);
      return b.get();
    }
 catch (    Exception e) {
      throw new RuntimeException("Cannot test running state of the search factory",e);
    }
  }
 else {
    if (sfi instanceof MutableSearchFactory) {
      try {
        Field delegateField=MutableSearchFactory.class.getDeclaredField("stopped");
        delegateField.setAccessible(true);
        SearchFactoryImplementor delegate=(SearchFactoryImplementor)delegateField.get(sfi);
        return isStopped(delegate);
      }
 catch (      Exception e) {
        throw new RuntimeException("Cannot test running state of the search factory",e);
      }
    }
  }
  throw new RuntimeException("Cannot test running state of the search factory as it is neither a MutableSearchFactory nor an ImmutableSearchFactory");
}
