{
  if (ctx == null)   ctx=invocationContextContainer.get();
  ctx.setLocalRollbackOnly(localRollbackOnly);
  setTransactionalContext(tx,gtx,transactionContext,ctx);
  if (transactionalOptions != null)   ctx.setOptions(transactionalOptions);
  try {
    super.afterCompletion(status);
  }
  finally {
    ctx.setOptions(originalOptions);
  }
}
