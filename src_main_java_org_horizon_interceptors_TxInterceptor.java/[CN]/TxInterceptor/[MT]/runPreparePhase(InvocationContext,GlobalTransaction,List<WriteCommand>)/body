{
  PrepareCommand prepareCommand=buildPrepareCommand(gtx,modifications,false);
  transactionLog.logPrepare(prepareCommand);
  Object result;
  Transaction ltx=ctx.getTransaction();
  Transaction currentTransaction=txManager.getTransaction();
  if (currentTransaction != null && ltx != null && currentTransaction.equals(ltx)) {
    result=invokeNextInterceptor(ctx,prepareCommand);
  }
 else {
    log.warn("Local transaction does not exist or does not match expected transaction " + gtx);
    throw new CacheException(" local transaction " + ltx + " does not exist or does not match expected transaction "+ gtx);
  }
  return result;
}
