{
  Map<Object,String> values=putValueInEachCache(3);
  Cache<Object,String> cache=cache(0,CACHE_NAME);
  TransactionTable txTable=TestingUtil.extractComponent(cache,TransactionTable.class);
  Object key="filtered-key";
  cache.put(key,"filtered-value");
  TransactionManager tm=TestingUtil.extractComponent(cache,TransactionManager.class);
  tm.begin();
  try {
    assertEquals(0,txTable.getLocalTxCount());
    CloseableIterator<CacheEntry<Object,String>> iterator=cache.getAdvancedCache().filterEntries(new KeyFilterAsKeyValueFilter<>(new CollectionKeyFilter<>(Collections.singleton(key)))).iterator();
    assertEquals(1,txTable.getLocalTxCount());
    Map<Object,String> results=mapFromIterator(iterator);
    assertEquals(values,results);
  }
  finally {
    tm.rollback();
  }
  assertEquals(0,txTable.getLocalTxCount());
}
