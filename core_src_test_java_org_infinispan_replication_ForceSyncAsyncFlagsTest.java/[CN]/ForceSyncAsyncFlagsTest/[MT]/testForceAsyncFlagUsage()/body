{
  ConfigurationBuilder builder=getDefaultClusteredCacheConfig(CacheMode.REPL_SYNC,false);
  createClusteredCaches(2,"replSync",builder);
  AdvancedCache cache1=cache(0,"replSync").getAdvancedCache();
  AdvancedCache cache2=cache(1,"replSync").getAdvancedCache();
  Transport originalTransport=TestingUtil.extractGlobalComponent(cache1.getCacheManager(),Transport.class);
  RpcManagerImpl rpcManager=(RpcManagerImpl)TestingUtil.extractComponent(cache1,RpcManager.class);
  Transport mockTransport=spy(originalTransport);
  rpcManager.setTransport(mockTransport);
  cache1.put("k","v");
  verify(mockTransport).invokeRemotely((List<Address>)anyObject(),(CacheRpcCommand)anyObject(),eq(ResponseMode.SYNCHRONOUS_IGNORE_LEAVERS),anyLong(),anyBoolean(),(ResponseFilter)anyObject(),anyBoolean(),anyBoolean());
  reset(mockTransport);
  cache1.withFlags(Flag.FORCE_ASYNCHRONOUS).put("k","v");
  verify(mockTransport).invokeRemotely((List<Address>)anyObject(),(CacheRpcCommand)anyObject(),eq(ResponseMode.ASYNCHRONOUS_WITH_SYNC_MARSHALLING),anyLong(),anyBoolean(),(ResponseFilter)anyObject(),anyBoolean(),anyBoolean());
}
