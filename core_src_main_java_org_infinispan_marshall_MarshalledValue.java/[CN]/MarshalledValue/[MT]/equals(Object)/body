{
  if (this == o)   return true;
  if (o == null || getClass() != o.getClass())   return false;
  MarshalledValue that=(MarshalledValue)o;
  if (raw != null && that.raw != null)   return Arrays.equals(raw,that.raw);
  if (instance != null && that.instance != null)   return instance.equals(that.instance);
  if (equalityPreferenceForInstance && that.equalityPreferenceForInstance) {
    if (instance == null)     deserialize();
    if (that.instance == null)     that.deserialize();
    return instance.equals(that.instance);
  }
 else {
    if (raw == null)     serialize();
    if (that.raw == null)     that.serialize();
    return Arrays.equals(raw,that.raw);
  }
}
