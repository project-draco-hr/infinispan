{
  acquireLocksIfNeeded();
  GetAllCommand command=commandsFactory.buildGetAllCommand(keys,flags,true);
  InvocationContext invocationContext=icf.createRemoteInvocationContextForCommand(command,getOrigin());
  Map<K,CacheEntry<K,V>> map=(Map<K,CacheEntry<K,V>>)invoker.invoke(invocationContext,command);
  if (trace)   log.trace("Found: " + map);
  if (map == null) {
    return null;
  }
  List<InternalCacheValue<V>> values=new ArrayList<>(keys.size());
  for (  Object key : keys) {
    if (map.containsKey(key)) {
      CacheEntry<K,V> entry=map.get(key);
      InternalCacheValue<V> value;
      if (entry instanceof InternalCacheEntry) {
        value=((InternalCacheEntry<K,V>)entry).toInternalCacheValue();
      }
 else       if (entry != null) {
        value=entryFactory.createValue(entry);
      }
 else {
        value=new ImmortalCacheValue(null);
      }
      values.add(value);
    }
 else {
      values.add(null);
    }
  }
  return values;
}
