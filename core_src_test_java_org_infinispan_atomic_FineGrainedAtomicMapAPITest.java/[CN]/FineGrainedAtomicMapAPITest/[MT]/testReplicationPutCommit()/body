{
  final Cache<String,Object> cache1=cache(0,"atomic");
  final Cache<String,Object> cache2=cache(1,"atomic");
  final FineGrainedAtomicMap<String,String> map=getFineGrainedAtomicMap(cache1,"testReplicationPutCommit");
  Map<Object,Object> expectedMap=createMap(new Object[]{"existing","blah"},new Object[]{"existing","blah"});
  tm(cache1).begin();
  map.put("existing","existing");
  map.put("blah","blah");
  tm(cache1).commit();
  assertMap(expectedMap,map);
  final FineGrainedAtomicMap<Object,Object> other=getFineGrainedAtomicMap(cache2,"testReplicationPutCommit",false);
  assertMap(expectedMap,other);
  tm(cache2).begin();
  other.put("existing","not existing");
  other.put("not existing","peace on Earth");
  tm(cache2).commit();
  expectedMap=createMap(new Object[]{"blah","existing","not existing"},new Object[]{"blah","not existing","peace on Earth"});
  assertMap(expectedMap,map);
  assertMap(expectedMap,other);
}
