{
  resetStreamSummary(cache());
  PrepareCommandBlocker blocker=addPrepareBlockerIfAbsent(cache());
  blocker.reset();
  ThrowableAwareThread thread=putInOtherThread(cache(),"key","value");
  blocker.awaitUntilPrepareBlocked();
  try {
    cache().put("key","value");
    Assert.fail("The key should be locked!");
  }
 catch (  Throwable t) {
  }
  blocker.unblock();
  thread.join();
  Assert.assertNull(thread.throwable);
  assertTopKeyAccesses(cache(),"key",2,false);
  assertTopKeyAccesses(cache(),"key",0,true);
  assertLockInformation(cache(),"key",2,1,1);
  assertWriteSkew(cache(),"key",0);
}
