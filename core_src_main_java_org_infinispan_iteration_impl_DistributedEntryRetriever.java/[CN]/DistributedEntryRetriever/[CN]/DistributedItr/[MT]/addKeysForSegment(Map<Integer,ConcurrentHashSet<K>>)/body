{
  for (  Map.Entry<Integer,ConcurrentHashSet<K>> entry : keysForSegment.entrySet()) {
    Set<K> values=entry.getValue();
    if (values.isEmpty()) {
      if (!keysNeededToComplete.containsKey(entry.getKey())) {
        notifyListenerCompletedSegment(entry.getKey(),false);
      }
 else {
        if (log.isTraceEnabled()) {
          log.tracef("No keys found for segment %s, but previous response had keys - so cannot complete " + "segment",entry.getKey());
        }
      }
    }
 else {
      Set<K> prevValues=keysNeededToComplete.putIfAbsent(entry.getKey(),values);
      if (prevValues != null) {
        for (        K value : values) {
          prevValues.add(value);
        }
      }
    }
  }
}
