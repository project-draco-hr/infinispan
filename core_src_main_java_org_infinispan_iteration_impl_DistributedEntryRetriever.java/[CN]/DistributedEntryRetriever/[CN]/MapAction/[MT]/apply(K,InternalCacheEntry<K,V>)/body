{
  ConsistentHash hash=getCurrentHash();
  if (segments.contains(hash.getSegment(k))) {
    CacheEntry<K,C> clone=(CacheEntry<K,C>)kvInternalCacheEntry.clone();
    if (converter != null) {
      C value=converter.convert(k,kvInternalCacheEntry.getValue(),kvInternalCacheEntry.getMetadata());
      clone.setValue(value);
    }
    queue.add(clone);
    if (insertionCount.incrementAndGet() % batchSize == 0) {
      Collection<CacheEntry<K,C>> entriesToSend=new ArrayList<>(batchSize);
      while (entriesToSend.size() != batchSize) {
        entriesToSend.add(queue.poll());
      }
      Set<Integer> emptySet=Collections.emptySet();
      handler.handleBatch(identifier,false,emptySet,emptySet,entriesToSend);
    }
  }
}
