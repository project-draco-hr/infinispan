{
  ConfigurationFor annotation=cfg.getClass().getAnnotation(ConfigurationFor.class);
  if (annotation == null) {
    throw log.loaderConfigurationDoesNotSpecifyLoaderClass(cfg.getClass().getName());
  }
  CacheLoader tmpLoader=(CacheLoader)Util.getInstance(annotation.value());
  if (tmpLoader != null) {
    if (cfg instanceof CacheStoreConfiguration) {
      CacheStore tmpStore=(CacheStore)tmpLoader;
      CacheStoreConfiguration cfg2=(CacheStoreConfiguration)cfg;
      if (cfg2.async().enabled()) {
        tmpStore=createAsyncStore(tmpStore);
        tmpLoader=tmpStore;
      }
      if (cfg2.ignoreModifications()) {
        tmpStore=new ReadOnlyStore(tmpStore);
        tmpLoader=tmpStore;
      }
      if (cfg2.singletonStore().enabled()) {
        tmpStore=new SingletonStore(tmpStore,cache);
        tmpLoader=tmpStore;
      }
    }
    tmpLoader.init(cfg,cache,m);
  }
  return tmpLoader;
}
