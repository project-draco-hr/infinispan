{
  if (currentChunkNumber == 0) {
    storeCurrentBuffer(true);
  }
 else {
    storeBufferAsChunk(this.firstChunkBuffer,0);
    storeCurrentBuffer(true);
  }
  buffer=null;
  firstChunkBuffer=null;
  file.touch();
  metadataCache.withFlags(Flag.SKIP_REMOTE_LOOKUP,Flag.SKIP_CACHE_LOAD).put(fileKey,file);
  fileOps.addFileName(this.fileKey.getFileName());
  if (trace) {
    log.tracef("Closed IndexOutput for %s",fileKey);
  }
}
