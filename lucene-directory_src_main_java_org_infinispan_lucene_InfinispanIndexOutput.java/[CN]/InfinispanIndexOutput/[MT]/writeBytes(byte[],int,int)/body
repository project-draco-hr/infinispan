{
  int writedBytes=0;
  while (writedBytes < length) {
    int pieceLength=Math.min(buffer.length - bufferPosition,length - writedBytes);
    System.arraycopy(b,offset + writedBytes,buffer,bufferPosition,pieceLength);
    bufferPosition+=pieceLength;
    filePosition+=pieceLength;
    writedBytes+=pieceLength;
    if (isNewChunkNeeded()) {
      newChunk();
    }
  }
}
