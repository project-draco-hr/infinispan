{
  Cache<Object,Object> cache1=cache(0,"replSync");
  Cache<Object,Object> cache2=cache(1,"replSync");
  TransactionManager tm1=TestingUtil.getTransactionManager(cache1);
  TransactionManager tm2=TestingUtil.getTransactionManager(cache2);
  RpcManager rpcManager=EasyMock.createMock(RpcManager.class);
  RpcManager originalRpcManager=TestingUtil.replaceComponent(cache1.getCacheManager(),RpcManager.class,rpcManager,true);
  try {
    replay(rpcManager);
    if (transactional)     tm1.begin();
    cache1.getAdvancedCache().withFlags(CACHE_MODE_LOCAL).putForExternalRead(key,value);
    if (transactional)     tm1.commit();
    verify(rpcManager);
  }
  finally {
    if (originalRpcManager != null) {
      TestingUtil.replaceComponent(cache1.getCacheManager(),RpcManager.class,originalRpcManager,true);
      cache1.remove(key);
      cache2.remove(key);
    }
  }
}
