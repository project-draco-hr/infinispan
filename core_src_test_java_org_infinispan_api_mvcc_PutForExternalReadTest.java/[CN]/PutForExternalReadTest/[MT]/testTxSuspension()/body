{
  final Cache cache1=cache(0,"replSync");
  final Cache cache2=cache(1,"replSync");
  cache1.put(key + "0",value);
  eventually(new Condition(){
    @Override public boolean isSatisfied() throws Exception {
      return value.equals(cache2.get(key + "0"));
    }
  }
);
  tm(0,"replSync").begin();
  cache1.get(key + "0");
  cache1.putForExternalRead(key,value);
  Transaction t=tm(0,"replSync").suspend();
  eventually(new Condition(){
    @Override public boolean isSatisfied() throws Exception {
      return value.equals(cache1.get(key)) && value.equals(cache2.get(key));
    }
  }
);
  tm(0,"replSync").resume(t);
  tm(0,"replSync").commit();
  eventually(new Condition(){
    @Override public boolean isSatisfied() throws Exception {
      return value.equals(cache1.get(key + "0")) && value.equals(cache2.get(key + "0"));
    }
  }
);
}
