{
  org.jboss.marshalling.Marshaller marshaller;
  if (isReentrant) {
    marshaller=factory.createMarshaller(configuration);
  }
 else {
    marshaller=marshallerTL.get();
  }
  if (log.isTraceEnabled())   log.trace("Start marshaller@{0} after retrieving marshaller from {1}",Integer.toHexString(System.identityHashCode(marshaller)),isReentrant ? "factory" : "thread local");
  marshaller.start(Marshalling.createByteOutput(os));
  return marshaller;
}
