{
  org.jboss.marshalling.Marshaller marshaller;
  if (isReentrant) {
    marshaller=factory.createMarshaller(configuration);
  }
 else {
    marshaller=marshallerTL.get();
  }
  if (log.isTraceEnabled())   log.trace("Start marshaller after retrieving marshaller from %s",isReentrant ? "factory" : "thread local");
  marshaller.start(Marshalling.createByteOutput(os));
  return marshaller;
}
