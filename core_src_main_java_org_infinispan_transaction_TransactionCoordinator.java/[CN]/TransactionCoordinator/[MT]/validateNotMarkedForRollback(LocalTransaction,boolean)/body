{
  if (localTransaction.isMarkedForRollback()) {
    if (trace)     log.tracef("Transaction already marked for rollback: %s",localTransaction);
    if (runRollback) {
      if (log.isTraceEnabled())       log.trace("Forcing rollback.");
      rollback(localTransaction);
    }
    throw new XAException(XAException.XA_RBROLLBACK);
  }
}
