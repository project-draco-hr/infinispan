{
  Collection<Address> preparedNodes=localTransaction.getRemoteLocksAcquired();
  List<Address> members=getClusterMembers();
  if (!members.containsAll(preparedNodes)) {
    if (trace)     log.tracef("Member(s) left, so re-applying prepare for %s",localTransaction);
    localTransaction.filterRemoteLocksAcquire(members);
    try {
      prepare(localTransaction);
    }
 catch (    XAException e) {
      if (!configuration.isTransactionRecoveryEnabled()) {
        rollback(localTransaction);
        throw new XAException(XAException.XA_RBROLLBACK);
      }
    }
  }
 else   if (trace)   log.trace("All prepared nodes are okay.");
}
