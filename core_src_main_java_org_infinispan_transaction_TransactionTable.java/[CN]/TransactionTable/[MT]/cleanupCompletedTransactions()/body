{
  if (!completedTransactions.isEmpty()) {
    try {
      log.tracef("About to cleanup completed transaction. Initial size is %d",completedTransactions.size());
      Iterator<Map.Entry<GlobalTransaction,Long>> iterator=completedTransactions.entrySet().iterator();
      long timeout=configuration.transaction().completedTxTimeout();
      int removedEntries=0;
      long beginning=System.nanoTime();
      while (iterator.hasNext()) {
        Map.Entry<GlobalTransaction,Long> e=iterator.next();
        long ageNanos=System.nanoTime() - e.getValue();
        if (TimeUnit.NANOSECONDS.toMillis(ageNanos) >= timeout) {
          iterator.remove();
          removedEntries++;
        }
      }
      long duration=System.nanoTime() - beginning;
      log.tracef("Finished cleaning up completed transactions. %d transactions were removed, total duration was %d millis, " + "current number of completed transactions is %d",removedEntries,TimeUnit.NANOSECONDS.toMillis(duration),completedTransactions.size());
    }
 catch (    Exception e) {
      log.errorf(e,"Failed to cleanup completed transactions: %s",e.getMessage());
    }
  }
}
