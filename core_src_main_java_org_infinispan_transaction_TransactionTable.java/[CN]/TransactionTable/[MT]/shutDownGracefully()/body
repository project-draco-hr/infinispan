{
  log.debugf("Wait for on-going transactions to finish for %d seconds.",TimeUnit.MILLISECONDS.toSeconds(configuration.getCacheStopTimeout()));
  long failTime=System.currentTimeMillis() + configuration.getCacheStopTimeout();
  boolean txsOnGoing=areTxsOnGoing();
  while (txsOnGoing && System.currentTimeMillis() < failTime) {
    try {
      Thread.sleep(100);
      txsOnGoing=areTxsOnGoing();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
      log.debugf("Interrupted waiting for on-going transactions to finish. localTransactions=%s, remoteTransactions%s",localTransactions,remoteTransactions);
    }
  }
  if (txsOnGoing) {
    log.unfinishedTransactionsRemain(localTransactions,remoteTransactions);
  }
 else {
    log.trace("All transactions terminated");
  }
}
