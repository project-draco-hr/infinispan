{
  Set<T> result=new HashSet<T>();
  for (  Entry<Address,Response> e : responses.entrySet()) {
    Response rsp=e.getValue();
    if (rsp.isSuccessful() && rsp.isValid()) {
      Set<T> mapResponse=(Set<T>)((SuccessfulResponse)rsp).getResponseValue();
      result.addAll(mapResponse);
    }
 else     if (rsp instanceof ExceptionResponse) {
      throw new CacheException("Map phase of MapReduce task on remote node " + e.getKey() + " threw Exception",((ExceptionResponse)rsp).getException());
    }
 else {
      throw new CacheException("Map phase of MapReduce task on remote node " + e.getKey() + " failed ");
    }
  }
  return result;
}
