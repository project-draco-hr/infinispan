{
  if (mapper == null)   throw new NullPointerException("A valid reference of Mapper is not set " + mapper);
  if (reducer == null)   throw new NullPointerException("A valid reference of Reducer is not set " + reducer);
  if (!isLocalOnly && distributeReducePhase()) {
    boolean useCompositeKeys=useIntermediateSharedCache();
    String intermediateCacheName=DEFAULT_TMP_CACHE_CONFIGURATION_NAME;
    if (useIntermediatePerTaskCache()) {
      intermediateCacheName=taskId.toString();
    }
    try {
      executeTaskInit(intermediateCacheName);
      Set<KOut> allMapPhasesResponses=executeMapPhase(useCompositeKeys);
      return executeReducePhase(allMapPhasesResponses,useCompositeKeys);
    }
 catch (    Exception cause) {
      throw new CacheException(cause);
    }
 finally {
      if (useIntermediatePerTaskCache()) {
        EmbeddedCacheManager cm=cache.getCacheManager();
        cm.removeCache(intermediateCacheName);
      }
    }
  }
 else {
    try {
      return executeMapPhaseWithLocalReduction();
    }
 catch (    Exception cause) {
      throw new CacheException(cause);
    }
  }
}
