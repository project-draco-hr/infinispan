{
  boolean notifyRehashStarted=false;
  if (cmd instanceof CacheViewControlCommand) {
    CacheViewControlCommand rcc=(CacheViewControlCommand)cmd;
    log.debugf("Intercepted command: %s",cmd);
switch (rcc.getType()) {
case PREPARE_VIEW:
      txsReady.await();
    notifyRehashStarted=true;
  break;
case COMMIT_VIEW:
joinEnded.countDown();
break;
}
}
Response r=delegate.handle(cmd,origin);
if (notifyRehashStarted) rehashStarted.countDown();
return r;
}
