{
  boolean notifyRehashStarted=false;
  if (cmd instanceof StateTransferControlCommand) {
    StateTransferControlCommand rcc=(StateTransferControlCommand)cmd;
    log.debugf("Intercepted command: %s",cmd);
switch (rcc.getType()) {
case APPLY_STATE:
      txsReady.await();
    notifyRehashStarted=true;
  break;
case PUSH_COMPLETED:
joinEnded.countDown();
break;
}
}
Response r=delegate.handle(cmd,origin);
if (notifyRehashStarted) rehashStarted.countDown();
return r;
}
