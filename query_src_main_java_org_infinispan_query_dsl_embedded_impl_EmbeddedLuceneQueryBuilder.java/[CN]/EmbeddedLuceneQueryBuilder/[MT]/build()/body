{
  String jpqlString=accept(new JPAQueryGenerator());
  if (log.isTraceEnabled()) {
    log.tracef("JPQL string : %s",jpqlString);
  }
  SearchFactoryIntegrator searchFactory=(SearchFactoryIntegrator)searchManager.getSearchFactory();
  LuceneProcessingChain processingChain=new LuceneProcessingChain.Builder(searchFactory,entityNamesResolver).buildProcessingChainForClassBasedEntities();
  QueryParser queryParser=new QueryParser();
  LuceneQueryParsingResult parsingResult=queryParser.parseQuery(jpqlString,processingChain);
  return new EmbeddedLuceneQuery(searchManager,parsingResult,startOffset,maxResults);
}
