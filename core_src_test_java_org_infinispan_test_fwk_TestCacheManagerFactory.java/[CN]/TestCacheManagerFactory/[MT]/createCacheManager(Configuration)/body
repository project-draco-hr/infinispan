{
  GlobalConfiguration globalConfiguration;
  if (defaultCacheConfig.getCacheMode().isClustered()) {
    globalConfiguration=GlobalConfiguration.getClusteredDefault();
    amendTransport(globalConfiguration);
  }
 else {
    globalConfiguration=GlobalConfiguration.getNonClusteredDefault();
  }
  globalConfiguration.setAllowDuplicateDomains(true);
  amendMarshaller(globalConfiguration);
  minimizeThreads(globalConfiguration);
  updateTransactionSupport(defaultCacheConfig);
  defaultCacheConfig.fluent().cacheStopTimeout(1000);
  return newDefaultCacheManager(true,globalConfiguration,defaultCacheConfig,false);
}
