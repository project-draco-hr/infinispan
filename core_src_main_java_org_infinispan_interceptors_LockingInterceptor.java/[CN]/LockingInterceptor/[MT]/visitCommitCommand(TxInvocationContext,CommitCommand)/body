{
  try {
    return invokeNextInterceptor(ctx,command);
  }
  finally {
    if (ctx.isInTxScope()) {
      cleanupLocks(ctx,ctx.getLockOwner(),true);
    }
 else {
      throw new IllegalStateException("Attempting to do a commit or rollback but there is no transactional context in scope. " + ctx);
    }
  }
}
