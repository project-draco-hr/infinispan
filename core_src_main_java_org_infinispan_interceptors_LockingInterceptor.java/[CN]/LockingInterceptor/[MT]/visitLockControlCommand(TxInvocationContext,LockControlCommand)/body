{
  boolean localTxScope=ctx.isOriginLocal() && ctx.isInTxScope();
  boolean shouldInvokeOnCluster=false;
  try {
    if (localTxScope) {
      c.attachGlobalTransaction((GlobalTransaction)ctx.getLockOwner());
    }
    for (    Object key : c.getKeys()) {
      if (c.isImplicit() && localTxScope && !lockManager.ownsLock(key,ctx.getLockOwner())) {
        shouldInvokeOnCluster=true;
      }
      entryFactory.wrapEntryForWriting(ctx,key,true,false,false,false,false);
    }
    if (shouldInvokeOnCluster || c.isExplicit())     return invokeNextInterceptor(ctx,c);
 else     return null;
  }
  finally {
    if (ctx.isInTxScope()) {
      doAfterCall(ctx);
    }
 else {
      throw new IllegalStateException("Attempting to lock but there is no transactional context in scope. " + ctx);
    }
  }
}
