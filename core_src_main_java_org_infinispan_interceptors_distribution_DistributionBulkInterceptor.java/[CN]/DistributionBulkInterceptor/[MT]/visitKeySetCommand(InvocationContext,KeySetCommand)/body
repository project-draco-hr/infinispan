{
  CacheSet<K> keySet;
  if (!command.hasFlag(Flag.CACHE_MODE_LOCAL)) {
    if (ctx.isInTxScope()) {
      keySet=new TxBackingKeySet<>(Caches.getCacheWithFlags(cache,command),cache.getAdvancedCache().withFlags(Flag.CACHE_MODE_LOCAL).cacheEntrySet(),command,(LocalTxInvocationContext)ctx);
    }
 else {
      keySet=new BackingKeySet<>(Caches.getCacheWithFlags(cache,command),cache.getAdvancedCache().withFlags(Flag.CACHE_MODE_LOCAL).cacheEntrySet(),command);
    }
  }
 else {
    keySet=(CacheSet<K>)ctx.forkInvocationSync(command);
  }
  return ctx.shortCircuit(keySet);
}
