{
  boolean commandAccepted=matcher.accept(command);
  StateSequencerUtil.advanceMultiple(stateSequencer,commandAccepted,statesBefore);
  try {
    return ctx.shortCircuit(ctx.forkInvocationSync(command));
  }
  finally {
    StateSequencerUtil.advanceMultiple(stateSequencer,commandAccepted,statesAfter);
  }
}
