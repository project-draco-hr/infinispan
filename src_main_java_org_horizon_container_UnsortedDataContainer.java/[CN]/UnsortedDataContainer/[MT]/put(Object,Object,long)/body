{
  CachedValue cv=immortalData.get(k);
  ExpirableCachedValue ecv;
  if (cv != null) {
    if (lifespan < 0) {
      cv.setValue(v);
      cv.touch();
    }
 else {
      ecv=new ExpirableCachedValue(v,lifespan);
      immortalData.remove(k);
      expirableData.put(k,ecv);
    }
  }
 else   if ((ecv=expirableData.get(k)) != null) {
    if (lifespan < 0) {
      cv=new CachedValue(v);
      expirableData.remove(k);
      immortalData.put(k,cv);
    }
 else {
      ecv.setValue(v);
      ecv.touch();
    }
  }
 else {
    if (lifespan < 0) {
      cv=new CachedValue(v);
      immortalData.put(k,cv);
    }
 else {
      ecv=new ExpirableCachedValue(v,lifespan);
      expirableData.put(k,ecv);
    }
  }
}
