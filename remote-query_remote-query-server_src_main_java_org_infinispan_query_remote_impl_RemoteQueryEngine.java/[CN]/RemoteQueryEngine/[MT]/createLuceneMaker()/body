{
  if (isCompatMode) {
    EntityNamesResolver entityNamesResolver=new EntityNamesResolver(){
      @Override public Class<?> getClassFromName(      String entityName){
        return serCtx.canMarshall(entityName) ? serCtx.getMarshaller(entityName).getJavaClass() : null;
      }
    }
;
    HibernateSearchPropertyHelper propertyHelper=new HibernateSearchPropertyHelper(getSearchFactory(),entityNamesResolver,null);
    return new LuceneQueryMaker(getSearchFactory(),propertyHelper,null);
  }
 else {
    return new LuceneQueryMaker(getSearchFactory(),null,protobufFieldBridgeProvider);
  }
}
