{
  if (enabled) {
    storesMutex.writeLock().lock();
    try {
      Iterator<CacheLoader> clIt=loaders.iterator();
      while (clIt.hasNext()) {
        CacheLoader l=clIt.next();
        if (undelegate(l).getClass().getName().equals(storeType))         clIt.remove();
      }
      Iterator<CacheWriter> cwIt=writers.iterator();
      while (cwIt.hasNext()) {
        CacheWriter w=cwIt.next();
        if (undelegate(w).getClass().getName().equals(storeType))         cwIt.remove();
      }
    }
  finally {
      storesMutex.writeLock().unlock();
    }
    if (loaders.isEmpty() && writers.isEmpty()) {
      SequentialInterceptorChain chain=cache.getAdvancedCache().getSequentialInterceptorChain();
      SequentialInterceptor loaderInterceptor=chain.findInterceptorExtending(CacheLoaderInterceptor.class);
      if (loaderInterceptor == null) {
        log.persistenceWithoutCacheLoaderInterceptor();
      }
 else {
        ((CacheLoaderInterceptor)loaderInterceptor).disableInterceptor();
        chain.removeInterceptor(loaderInterceptor.getClass());
      }
      SequentialInterceptor writerInterceptor=chain.findInterceptorExtending(CacheWriterInterceptor.class);
      if (writerInterceptor == null) {
        log.persistenceWithoutCacheWriteInterceptor();
      }
 else {
        ((CacheWriterInterceptor)writerInterceptor).disableInterceptor();
        chain.removeInterceptor(writerInterceptor.getClass());
      }
      enabled=false;
    }
  }
}
