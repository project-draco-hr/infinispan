{
synchronized (this) {
    boolean modeChanged=setAvailabilityMode(newAvailabilityMode);
    if (modeChanged) {
      log.debugf("Updating availability for cache %s to %s",cacheName,newAvailabilityMode);
      CacheTopology newTopology=new CacheTopology(currentTopology.getTopologyId() + 1,currentTopology.getRebalanceId(),currentTopology.getCurrentCH(),currentTopology.getPendingCH());
      setCurrentTopology(newTopology);
      clusterTopologyManager.broadcastTopologyUpdate(cacheName,newTopology,newAvailabilityMode,isTotalOrder(),isDistributed());
    }
  }
}
