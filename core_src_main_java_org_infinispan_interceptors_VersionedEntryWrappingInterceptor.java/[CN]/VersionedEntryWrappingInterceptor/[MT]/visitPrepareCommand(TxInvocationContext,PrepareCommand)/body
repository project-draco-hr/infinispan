{
  wrapEntriesForPrepare(ctx,command);
  EntryVersionsMap newVersionData=null;
  if (ctx.isOriginLocal() && !((LocalTransaction)ctx.getCacheTransaction()).isFromStateTransfer())   newVersionData=cdl.createNewVersionsAndCheckForWriteSkews(versionGenerator,ctx,(VersionedPrepareCommand)command);
  Object retval=invokeNextInterceptor(ctx,command);
  if (!ctx.isOriginLocal())   newVersionData=cdl.createNewVersionsAndCheckForWriteSkews(versionGenerator,ctx,(VersionedPrepareCommand)command);
  if (command.isOnePhaseCommit())   ctx.getCacheTransaction().setUpdatedEntryVersions(((VersionedPrepareCommand)command).getVersionsSeen());
  if (newVersionData != null)   retval=newVersionData;
  if (command.isOnePhaseCommit())   commitContextEntries(ctx,null);
  return retval;
}
