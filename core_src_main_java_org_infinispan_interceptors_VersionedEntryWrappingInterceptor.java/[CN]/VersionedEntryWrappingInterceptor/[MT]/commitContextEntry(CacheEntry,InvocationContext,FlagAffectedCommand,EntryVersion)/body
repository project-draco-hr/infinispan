{
  if (ctx.isInTxScope() && !isFromStateTransfer(ctx)) {
    EntryVersion version=userProvidedVersion == null ? ((TxInvocationContext)ctx).getCacheTransaction().getUpdatedEntryVersions().get(entry.getKey()) : userProvidedVersion;
    cdl.commitEntry(entry,version,command,ctx);
  }
 else {
    cdl.commitEntry(entry,entry.getVersion(),command,ctx);
  }
}
