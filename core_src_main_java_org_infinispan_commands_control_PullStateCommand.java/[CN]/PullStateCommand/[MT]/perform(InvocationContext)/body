{
  self=transport.getAddress();
  oldCH=distributionManager.getConsistentHash();
  numCopies=configuration.getNumOwners();
  Map<Object,InternalCacheValue> state=new HashMap<Object,InternalCacheValue>();
  for (  InternalCacheEntry ice : dataContainer) {
    Object k=ice.getKey();
    if (shouldAddToMap(k)) {
      state.put(k,ice.toInternalCacheValue());
    }
  }
  CacheStore cacheStore=getCacheStore();
  if (cacheStore != null) {
    for (    InternalCacheEntry ice : cacheStore.loadAll()) {
      Object k=ice.getKey();
      if (shouldAddToMap(k) && !state.containsKey(k)) {
        state.put(k,ice.toInternalCacheValue());
      }
    }
  }
  return state;
}
