{
  if (trace) {
    log.trace("Setting up transactional context.");
    log.trace("Setting tx as " + tx + " and gtx as "+ gtx);
  }
  ctx.setTransaction(tx);
  ctx.setGlobalTransaction(gtx);
  if (tCtx == null) {
    if (gtx != null) {
      ctx.setTransactionContext(txTable.getTransactionContext(gtx));
    }
 else     if (tx == null) {
      ctx.setTransactionContext(null);
    }
  }
 else {
    ctx.setTransactionContext(tCtx);
  }
}
