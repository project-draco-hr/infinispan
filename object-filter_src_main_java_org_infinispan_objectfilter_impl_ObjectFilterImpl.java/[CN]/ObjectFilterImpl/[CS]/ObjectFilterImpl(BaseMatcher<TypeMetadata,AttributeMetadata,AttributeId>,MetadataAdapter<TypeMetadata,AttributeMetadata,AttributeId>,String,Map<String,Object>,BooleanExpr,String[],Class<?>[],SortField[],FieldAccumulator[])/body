{
  if (acc != null) {
    if (projectionTypes == null) {
      throw new IllegalArgumentException("Accumulators can only be used with projections");
    }
    if (sortFields != null) {
      throw new IllegalArgumentException("Accumulators cannot be used with sorting");
    }
  }
  this.matcher=matcher;
  this.acc=acc;
  FilterRegistry<TypeMetadata,AttributeMetadata,AttributeId> filterRegistry=new FilterRegistry<>(metadataAdapter,false);
  filterSubscription=filterRegistry.addFilter(queryString,namedParameters,query,projections,projectionTypes,sortFields,emptyCallback,null);
  root=filterRegistry.getPredicateIndex().getRoot();
}
