{
  try {
    if (trace) {
      log.tracef("Waiting reply from %s",task.address);
    }
    Map<Address,Response> responseMap=task.awaitRemote();
    if (trace) {
      log.tracef("Response received is %s",responseMap);
    }
    if (responseMap.size() > 1 || !responseMap.containsKey(task.address)) {
      throw new IllegalStateException("Shouldn't happen. Map is " + responseMap);
    }
    Response response=responseMap.get(task.address);
    if (response == CacheNotFoundResponse.INSTANCE) {
      if (trace) {
        log.tracef("Cache not found in node '%s'. Retrying locally!",task.address);
      }
      if (!cache.getStatus().allowInvocations()) {
        throw new CacheException("Cache is stopping or terminated: " + cache.getStatus());
      }
      task.executeLocal();
    }
  }
 catch (  Exception e) {
    if (!cache.getStatus().allowInvocations()) {
      throw new CacheException("Cache is stopping or terminated: " + cache.getStatus());
    }
    if (cache.getAdvancedCache().getRpcManager().getMembers().contains(task.address)) {
      if (trace) {
        log.tracef(e,"An exception was sent by %s. Retrying!",task.address);
      }
      task.executeRemote();
    }
 else {
      if (trace) {
        log.tracef(e,"An exception was sent by %s. Retrying locally!",task.address);
      }
      task.executeLocal();
    }
  }
}
