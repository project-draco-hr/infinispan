{
  boolean wasCompleted=completed;
  Iterator<CacheEntry<K,C>> itr=entries.iterator();
  while (!wasCompleted && itr.hasNext()) {
    CacheEntry<K,C> entry=null;
    while (itr.hasNext()) {
      entry=itr.next();
      if (!queue.offer(entry)) {
        break;
      }
      entry=null;
    }
    nextLock.lock();
    try {
      wasCompleted=completed;
      nextCondition.signalAll();
    }
  finally {
      nextLock.unlock();
    }
    if (entry != null) {
      while (!wasCompleted) {
        if (queue.offer(entry,100,TimeUnit.MILLISECONDS)) {
          break;
        }
        nextLock.lock();
        try {
          wasCompleted=completed;
        }
  finally {
          nextLock.unlock();
        }
      }
    }
  }
}
