{
  GlobalConfiguration gc=componentRegistry.getComponent(GlobalConfiguration.class);
  CacheManagerJmxRegistration managerJmxReg=componentRegistry.getComponent(CacheManagerJmxRegistration.class);
  if (!gc.isExposeGlobalJmxStatistics() && jmxDomain == null) {
    String tmpJmxDomain=JmxUtil.buildJmxDomain(gc,mBeanServer,groupName);
synchronized (managerJmxReg) {
      if (managerJmxReg.jmxDomain == null) {
        if (!tmpJmxDomain.equals(gc.getJmxDomain()) && !gc.isAllowDuplicateDomains()) {
          log.cacheManagerAlreadyRegistered(gc.getJmxDomain());
          throw new JmxDomainConflictException(String.format("Domain already registered %s",gc.getJmxDomain()));
        }
        managerJmxReg.jmxDomain=tmpJmxDomain;
      }
      jmxDomain=managerJmxReg.jmxDomain;
    }
  }
 else {
    jmxDomain=managerJmxReg.jmxDomain == null ? gc.getJmxDomain() : managerJmxReg.jmxDomain;
  }
  registrar.setJmxDomain(jmxDomain);
}
