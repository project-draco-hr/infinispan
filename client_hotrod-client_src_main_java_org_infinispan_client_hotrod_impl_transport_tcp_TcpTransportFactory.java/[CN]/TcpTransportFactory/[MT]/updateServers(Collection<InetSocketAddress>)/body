{
synchronized (this) {
    Set<InetSocketAddress> addedServers=new HashSet<InetSocketAddress>(newServers);
    addedServers.removeAll(servers);
    Set<InetSocketAddress> failedServers=new HashSet<InetSocketAddress>(servers);
    failedServers.removeAll(newServers);
    if (failedServers.isEmpty() || newServers.isEmpty()) {
      log.info("Same list of servers, not changing the pool");
      return;
    }
    for (    InetSocketAddress server : newServers) {
      try {
        connectionPool.addObject(server);
      }
 catch (      Exception e) {
        log.warn("Failed adding new server " + server,e);
      }
      log.info("New server added(" + server + "), adding to the pool.");
    }
    balancer.setServers(newServers);
    for (    InetSocketAddress server : failedServers) {
      log.info("Server not in cluster anymore(" + server + "), removing from the pool.");
      connectionPool.clear(server);
    }
    servers.clear();
    servers.addAll(addedServers);
  }
}
