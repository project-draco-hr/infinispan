{
synchronized (this) {
    Set<InetSocketAddress> addedServers=new HashSet<InetSocketAddress>(newServers);
    addedServers.removeAll(servers);
    Set<InetSocketAddress> failedServers=new HashSet<InetSocketAddress>(servers);
    failedServers.removeAll(newServers);
    if (log.isTraceEnabled()) {
      log.tracef("Current list: %s",servers);
      log.tracef("New list: ",newServers);
      log.tracef("Added servers: ",addedServers);
      log.tracef("Removed servers: ",failedServers);
    }
    if (failedServers.isEmpty() && newServers.isEmpty()) {
      log.debug("Same list of servers, not changing the pool");
      return;
    }
    for (    InetSocketAddress server : newServers) {
      log.newServerAdded(server);
      try {
        connectionPool.addObject(server);
      }
 catch (      Exception e) {
        log.failedAddingNewServer(server,e);
      }
    }
    balancer.setServers(newServers);
    for (    InetSocketAddress server : failedServers) {
      log.removingServer(server);
      connectionPool.clear(server);
    }
    servers.clear();
    servers.addAll(newServers);
  }
}
