{
  SocketAddress server;
synchronized (lock) {
    ConsistentHash consistentHash=consistentHashes.get(cacheName);
    if (consistentHash != null) {
      server=consistentHash.getServer(key);
      if (log.isTraceEnabled()) {
        log.tracef("Using consistent hash for determining the server: " + server);
      }
    }
 else {
      server=getNextServer(failedServers,cacheName);
    }
  }
  return borrowTransportFromPool(server);
}
