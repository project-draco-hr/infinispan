{
  ExposedByteArrayOutputStream baos=new ExposedByteArrayOutputStream(128);
  ObjectOutputStream out=new ObjectOutputStream(baos);
  out.writeShort(VERSION_400);
  log.trace("Wrote version {0}",VERSION_400);
  defaultMarshaller.objectToObjectStream(obj,out);
  out.close();
  return new ByteBuffer(baos.getRawBuffer(),0,baos.size());
}
