{
  long endTime=System.currentTimeMillis() + configuration.getRehashRpcTimeout();
synchronized (rehashInProgressMonitor) {
    while (!receivedRehashCompletedNotification && lastViewId == viewId && System.currentTimeMillis() < endTime) {
      rehashInProgressMonitor.wait(configuration.getRehashRpcTimeout());
    }
  }
  if (!receivedRehashCompletedNotification) {
    if (lastViewId != viewId) {
      log.debug("Received a new view while waiting for cluster-wide rehash to finish");
      return false;
    }
 else {
      throw new TimeoutException("Timeout waiting for cluster-wide rehash to finish");
    }
  }
 else {
    log.debug("Cluster-wide rehash finished successfully.");
  }
  return true;
}
