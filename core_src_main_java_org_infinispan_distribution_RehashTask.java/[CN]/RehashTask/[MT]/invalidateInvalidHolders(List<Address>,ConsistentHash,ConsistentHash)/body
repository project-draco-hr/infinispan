{
  if (log.isDebugEnabled())   log.debug("Invalidating entries that have migrated across");
  Map<Address,Set<Object>> invalidations=new HashMap<Address,Set<Object>>();
  for (  Object key : dataContainer.keySet()) {
    Collection<Address> invalidHolders=getInvalidHolders(key,chOld,chNew);
    for (    Address a : invalidHolders) {
      Set<Object> s=invalidations.get(a);
      if (s == null) {
        s=new HashSet<Object>();
        invalidations.put(a,s);
      }
      s.add(key);
    }
  }
  invalidations.keySet().removeAll(doNotInvalidate);
  for (  Map.Entry<Address,Set<Object>> e : invalidations.entrySet()) {
    InvalidateCommand ic=cf.buildInvalidateFromL1Command(true,e.getValue().toArray());
    rpcManager.invokeRemotely(Collections.singletonList(e.getKey()),ic,false);
  }
}
