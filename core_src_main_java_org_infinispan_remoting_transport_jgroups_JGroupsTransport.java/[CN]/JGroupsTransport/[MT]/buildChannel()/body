{
  String cfg;
  if (p != null) {
    if (p.containsKey(CONFIGURATION_FILE)) {
      cfg=p.getProperty(CONFIGURATION_FILE);
      try {
        channel=new JChannel(new FileLookup().lookupFileLocation(cfg));
      }
 catch (      Exception e) {
        log.error("Error while trying to create a channel using config files: " + cfg);
        throw new CacheException(e);
      }
    }
    if (p.containsKey(CONFIGURATION_XML)) {
      cfg=p.getProperty(CONFIGURATION_XML);
      try {
        channel=new JChannel(XmlConfigHelper.stringToElement(cfg));
      }
 catch (      Exception e) {
        log.error("Error while trying to create a channel using config XML: " + cfg);
        throw new CacheException(e);
      }
    }
    if (p.containsKey(CONFIGURATION_STRING)) {
      cfg=p.getProperty(CONFIGURATION_STRING);
      try {
        channel=new JChannel(cfg);
      }
 catch (      Exception e) {
        log.error("Error while trying to create a channel using config string: " + cfg);
        throw new CacheException(e);
      }
    }
  }
  if (channel == null) {
    log.info("Unable to use any JGroups configuration mechanisms provided in properties {0}.  Using default JGroups configuration!",p);
    try {
      channel=new JChannel(new FileLookup().lookupFileLocation(DEFAULT_JGROUPS_CONFIGURATION_FILE));
    }
 catch (    ChannelException e) {
      throw new CacheException("Unable to start JGroups channel",e);
    }
  }
}
