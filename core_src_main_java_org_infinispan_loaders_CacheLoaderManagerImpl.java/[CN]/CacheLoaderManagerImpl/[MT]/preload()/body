{
  if (loader != null) {
    if (clmConfig.isPreload()) {
      long start=0;
      boolean debugTiming=log.isDebugEnabled();
      if (debugTiming) {
        start=System.currentTimeMillis();
        log.debug("Preloading transient state from cache loader %s",loader);
      }
      Set<InternalCacheEntry> state;
      try {
        state=loadState();
      }
 catch (      CacheLoaderException e) {
        throw new CacheException("Unable to preload!",e);
      }
      for (      InternalCacheEntry e : state) {
        if (clmConfig.isShared() || !(loader instanceof ChainingCacheStore)) {
          cache.getAdvancedCache().withFlags(SKIP_CACHE_STATUS_CHECK,CACHE_MODE_LOCAL,SKIP_CACHE_STORE,SKIP_REMOTE_LOOKUP).put(e.getKey(),e.getValue(),e.getLifespan(),MILLISECONDS,e.getMaxIdle(),MILLISECONDS);
        }
 else {
          cache.getAdvancedCache().withFlags(SKIP_CACHE_STATUS_CHECK,CACHE_MODE_LOCAL,SKIP_REMOTE_LOOKUP).put(e.getKey(),e.getValue(),e.getLifespan(),MILLISECONDS,e.getMaxIdle(),MILLISECONDS);
        }
      }
      if (debugTiming) {
        long stop=System.currentTimeMillis();
        log.debug("Preloaded %s keys in %s milliseconds",state.size(),stop - start);
      }
    }
  }
}
