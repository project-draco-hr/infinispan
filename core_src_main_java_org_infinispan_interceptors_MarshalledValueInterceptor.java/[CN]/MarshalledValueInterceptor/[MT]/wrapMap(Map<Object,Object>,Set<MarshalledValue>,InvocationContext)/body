{
  if (m == null) {
    if (trace)     log.trace("Map is nul; returning an empty map.");
    return Collections.emptyMap();
  }
  if (trace)   log.trace("Wrapping map contents of argument " + m);
  Map copy=new HashMap();
  for (  Map.Entry me : m.entrySet()) {
    Object key=me.getKey();
    Object value=me.getValue();
    Object newKey=(key == null || isTypeExcluded(key.getClass())) ? key : createMarshalledValue(key,ctx);
    Object newValue=(value == null || isTypeExcluded(value.getClass())) ? value : createMarshalledValue(value,ctx);
    if (newKey instanceof MarshalledValue)     marshalledValues.add((MarshalledValue)newKey);
    if (newValue instanceof MarshalledValue)     marshalledValues.add((MarshalledValue)newValue);
    copy.put(newKey,newValue);
  }
  return copy;
}
