{
  sharedCacheLoader.set(false);
  Cache<Object,Object> cache1, cache2, cache3;
  EmbeddedCacheManager cm1=createCacheManager();
  cache1=cm1.getCache(cacheName);
  writeLargeInitialData(cache1);
  assertEquals(INSERTION_COUNT,cache1.getAdvancedCache().getDataContainer().size());
  verifyInitialDataOnLoader(cache1);
  JoiningNode node=new JoiningNode(createCacheManager());
  cache2=node.getCache(cacheName);
  node.waitForJoin(60000,cache1,cache2);
  assertEquals(INSERTION_COUNT,cache1.getAdvancedCache().getDataContainer().size());
  assertEquals(INSERTION_COUNT,cache2.getAdvancedCache().getDataContainer().size());
  node.verifyStateTransfer(new CacheLoaderCounter(INSERTION_COUNT,cache2));
  JoiningNode node2=new JoiningNode(createCacheManager());
  cache3=node2.getCache(cacheName);
  node2.waitForJoin(60000,cache1,cache2,cache3);
  node2.verifyStateTransfer(new CacheLoaderCounter(INSERTION_COUNT * 2,cache1,cache2,cache3));
  assertEquals(INSERTION_COUNT * 2,getDataContainerSize(cache1,cache2,cache3));
}
