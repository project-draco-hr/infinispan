{
  if (valueObject == null)   return null;
  String propDefName=propDefMap.getName();
  PropertyMap propertyMap=new PropertyMap(propDefName);
  String specialNameProp=null;
  if (propDefName.startsWith("*:")) {
    specialNameProp=propDefName.substring(2);
    PropertySimple additionalNameProperty=new PropertySimple(specialNameProp,optionalEntryName);
    propertyMap.put(additionalNameProperty);
  }
  List<PropertyDefinition> propDefs=propDefMap.getPropertyDefinitions();
  if (propDefName.endsWith(":collapsed")) {
    if (propDefs.size() < 1 || propDefs.size() > 2)     throw new IllegalArgumentException("Collapsed map [" + propDefName + "] needs 1 or 2 entries and not "+ propDefs.size());
    Iterator<PropertyDefinition> iterator=propDefs.iterator();
    String name=iterator.next().getName();
    Map<String,String> objects=(Map<String,String>)valueObject;
    String val=objects.keySet().iterator().next();
    PropertySimple ps=new PropertySimple(name,val);
    propertyMap.put(ps);
    if (iterator.hasNext()) {
      name=iterator.next().getName();
      val=objects.values().iterator().next();
      ps=new PropertySimple(name,val);
      propertyMap.put(ps);
    }
    return propertyMap;
  }
  Map<String,Object> objects=(Map<String,Object>)valueObject;
  for (  PropertyDefinition propDef : propDefs) {
    String key=propDef.getName();
    if (key.equals(specialNameProp))     continue;
    Object o;
    if (key.equals("*")) {
      o=objects.entrySet().iterator().next().getValue();
    }
 else     if (key.endsWith(":expr")) {
      String tmp=key.substring(0,key.indexOf(":"));
      o=objects.get(tmp);
    }
 else {
      o=objects.get(key);
    }
    Property property;
    if (propDef instanceof PropertyDefinitionSimple)     property=loadHandlePropertySimple((PropertyDefinitionSimple)propDef,o);
 else     if (propDef instanceof PropertyDefinitionList)     property=loadHandlePropertyList((PropertyDefinitionList)propDef,o);
 else     if (propDef instanceof PropertyDefinitionMap)     property=loadHandlePropertyMap((PropertyDefinitionMap)propDef,o,null);
 else     throw new IllegalArgumentException("Unknown property type in map property [" + propDefName + "]");
    if (property != null)     propertyMap.put(property);
 else {
      if (log.isDebugEnabled())       log.debug("Property " + key + " was null");
    }
  }
  return propertyMap;
}
