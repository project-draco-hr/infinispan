{
  LockTestBaseTL tl=new LockTestBaseTL();
  ConfigurationBuilder defaultCfg=TestCacheManagerFactory.getDefaultCacheConfiguration(true);
  defaultCfg.locking().isolationLevel(repeatableRead ? IsolationLevel.REPEATABLE_READ : IsolationLevel.READ_COMMITTED).lockAcquisitionTimeout(200).transaction().transactionManagerLookup(new DummyTransactionManagerLookup());
  cm=TestCacheManagerFactory.createCacheManager(defaultCfg);
  tl.cache=cm.getCache();
  tl.lockManager=TestingUtil.extractComponentRegistry(tl.cache).getComponent(LockManager.class);
  tl.tm=TestingUtil.extractComponentRegistry(tl.cache).getComponent(TransactionManager.class);
  threadLocal.set(tl);
}
