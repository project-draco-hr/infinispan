{
  Address origin=ctx.getOrigin();
  if (trace)   log.tracef("handleTxWriteCommand for command %s, origin %s",command,origin);
  if (isLocalOnly(command)) {
    return ctx.continueInvocation();
  }
  updateTopologyId(command);
  int retryTopologyId=-1;
  Object localResult=null;
  try {
    localResult=ctx.forkInvocationSync(command);
  }
 catch (  OutdatedTopologyException e) {
    retryTopologyId=Math.max(currentTopologyId(),command.getTopologyId() + 1);
  }
  if (ctx.isOriginLocal()) {
    if (retryTopologyId > 0) {
      command.setTopologyId(retryTopologyId);
      waitForTransactionData(retryTopologyId);
      log.tracef("Retrying command %s for topology %d",command,retryTopologyId);
      return handleTxWriteCommand(ctx,command);
    }
  }
 else {
    if (currentTopologyId() > command.getTopologyId()) {
      return ctx.shortCircuit(UnsureResponse.INSTANCE);
    }
  }
  return ctx.shortCircuit(localResult);
}
