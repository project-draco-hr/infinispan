{
  String host=properties.getProperty("infinispan.server.host");
  int port=Integer.parseInt(properties.getProperty("infinispan.server.port"));
  int masterThreads=Integer.parseInt(properties.getProperty("infinispan.server.master.threads"));
  int workerThreads=Integer.parseInt(properties.getProperty("infinispan.server.worker.threads"));
  InetSocketAddress address=new InetSocketAddress(host,port);
  Executor masterExecutor=masterThreads == 0 ? Executors.newCachedThreadPool() : Executors.newFixedThreadPool(masterThreads);
  Executor workerExecutor=workerThreads == 0 ? Executors.newCachedThreadPool() : Executors.newFixedThreadPool(workerThreads);
  NioServerSocketChannelFactory factory=workerThreads == 0 ? new NioServerSocketChannelFactory(masterExecutor,workerExecutor) : new NioServerSocketChannelFactory(masterExecutor,workerExecutor,workerThreads);
  ServerBootstrap bootstrap=new ServerBootstrap(factory);
  bootstrap.setPipelineFactory(new WebSocketServerPipelineFactory(cacheManager));
  bootstrap.bind(address);
}
