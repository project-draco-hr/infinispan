{
  Configuration cfg=cache.getCacheConfiguration();
  SearchFactoryIntegrator sf=getSearchFactory(cfg.indexing().properties(),cr);
  GlobalConfiguration globalCfg=cr.getGlobalComponentRegistry().getGlobalConfiguration();
  mbeanServer=JmxUtil.lookupMBeanServer(globalCfg);
  String cacheManagerName=cr.getGlobalComponentRegistry().getGlobalConfiguration().globalJmxStatistics().cacheManagerName();
  String queryGroupName=getQueryGroupName(cacheManagerName,cacheName);
  jmxDomain=JmxUtil.buildJmxDomain(globalCfg,mbeanServer,queryGroupName);
  InfinispanQueryStatisticsInfo stats=new InfinispanQueryStatisticsInfo(sf);
  stats.setStatisticsEnabled(cfg.jmxStatistics().enabled());
  try {
    ObjectName statsObjName=new ObjectName(jmxDomain + ":" + queryGroupName+ ",component=Statistics");
    JmxUtil.registerMBean(stats,statsObjName,mbeanServer);
  }
 catch (  Exception e) {
    throw new CacheException("Unable to register query module statistics mbean",e);
  }
  ManageableComponentMetadata massIndexerCompMetadata=cr.getGlobalComponentRegistry().getComponentMetadataRepo().findComponentMetadata(MassIndexer.class).toManageableComponentMetadata();
  try {
    MapReduceMassIndexer maxIndexer=new MapReduceMassIndexer(cache,sf);
    ResourceDMBean mbean=new ResourceDMBean(maxIndexer,massIndexerCompMetadata);
    ObjectName massIndexerObjName=new ObjectName(jmxDomain + ":" + queryGroupName+ ",component="+ massIndexerCompMetadata.getJmxObjectName());
    JmxUtil.registerMBean(mbean,massIndexerObjName,mbeanServer);
  }
 catch (  Exception e) {
    throw new CacheException("Unable to create ",e);
  }
}
