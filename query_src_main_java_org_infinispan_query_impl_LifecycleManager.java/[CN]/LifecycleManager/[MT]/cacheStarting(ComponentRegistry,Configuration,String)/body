{
  InternalCacheRegistry icr=cr.getGlobalComponentRegistry().getComponent(InternalCacheRegistry.class);
  if (!icr.isInternalCache(cacheName) || icr.internalCacheHasFlag(cacheName,Flag.QUERYABLE)) {
    ClassLoader classLoader=cr.getGlobalComponentRegistry().getComponent(ClassLoader.class);
    cr.registerComponent(new ReflectionMatcher(classLoader),ReflectionMatcher.class);
    if (cfg.indexing().index().isEnabled()) {
      log.registeringQueryInterceptor();
      SearchIntegrator searchFactory=getSearchFactory(cfg.indexing().properties(),cr);
      createQueryInterceptorIfNeeded(cr,cfg,searchFactory);
      EmbeddedCacheManager cacheManager=cr.getGlobalComponentRegistry().getComponent(EmbeddedCacheManager.class);
      addCacheDependencyIfNeeded(cacheName,cacheManager,cfg.indexing().properties());
    }
  }
}
