{
  QueryInterceptor queryInterceptor=cr.getComponent(QueryInterceptor.class);
  if (queryInterceptor == null) {
    queryInterceptor=buildQueryInterceptor(cfg,searchFactory);
    cr.registerComponent(queryInterceptor,QueryInterceptor.class);
    CustomInterceptorPosition customInterceptorPosition=cfg.fluent().customInterceptors().add(queryInterceptor);
    if (!cfg.isTransactionalCache()) {
      customInterceptorPosition.after(NonTransactionalLockingInterceptor.class);
    }
 else     if (cfg.getTransactionLockingMode() == LockingMode.OPTIMISTIC) {
      customInterceptorPosition.after(OptimisticLockingInterceptor.class);
    }
 else {
      customInterceptorPosition.after(PessimisticLockingInterceptor.class);
    }
  }
}
