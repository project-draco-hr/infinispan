{
  Configuration configuration=cr.getComponent(Configuration.class);
  boolean indexingEnabled=configuration.indexing().enabled();
  if (!indexingEnabled) {
    if (verifyChainContainsQueryInterceptor(cr)) {
      throw new IllegalStateException("It was NOT expected to find the Query interceptor registered in the InterceptorChain as indexing was disabled, but it was found");
    }
    return;
  }
  if (!verifyChainContainsQueryInterceptor(cr)) {
    throw new IllegalStateException("It was expected to find the Query interceptor registered in the InterceptorChain but it wasn't found");
  }
  Cache<?,?> cache=cr.getComponent(Cache.class);
  CommandInitializer initializer=cr.getComponent(CommandInitializer.class);
  initializer.setCache(cache);
  QueryBox queryBox=new QueryBox();
  queryBox.setCache(cache.getAdvancedCache());
  cr.registerComponent(queryBox,QueryBox.class);
}
