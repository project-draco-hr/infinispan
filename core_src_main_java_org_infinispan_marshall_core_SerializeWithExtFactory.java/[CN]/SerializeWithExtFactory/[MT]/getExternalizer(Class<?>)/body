{
  try {
    final org.infinispan.commons.marshall.Externalizer<?> ext;
    SerializeWith ann=type.getAnnotation(SerializeWith.class);
    if (ann != null) {
      ext=ann.value().newInstance();
    }
 else {
      org.infinispan.marshall.SerializeWith legacy=type.getAnnotation(org.infinispan.marshall.SerializeWith.class);
      if (legacy != null) {
        ext=new LegacyExternalizerAdapter(legacy.value().newInstance());
      }
 else {
        return jbmarExtFactory.getExternalizer(type);
      }
    }
    return new JBossExternalizerAdapter(ext);
  }
 catch (  Exception e) {
    throw new IllegalArgumentException(String.format("Cannot instantiate externalizer for %s",type),e);
  }
}
