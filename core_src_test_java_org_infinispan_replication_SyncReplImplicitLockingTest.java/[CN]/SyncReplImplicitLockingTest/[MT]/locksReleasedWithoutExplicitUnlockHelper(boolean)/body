{
  assertClusterSize("Should only be 2  caches in the cluster!!!",2);
  assertNull("Should be null",cache1.get(k));
  assertNull("Should be null",cache2.get(k));
  String name="Infinispan";
  TransactionManager mgr=TestingUtil.getTransactionManager(cache1);
  mgr.begin();
  cache1.put(k,name);
  if (useCommit)   mgr.commit();
 else   mgr.rollback();
  if (useCommit) {
    assertEquals(name,cache1.get(k));
    assertEquals("Should have replicated",name,cache2.get(k));
  }
 else {
    assertEquals(null,cache1.get(k));
    assertEquals("Should not have replicated",null,cache2.get(k));
  }
  cache2.remove(k);
  cleanup();
}
