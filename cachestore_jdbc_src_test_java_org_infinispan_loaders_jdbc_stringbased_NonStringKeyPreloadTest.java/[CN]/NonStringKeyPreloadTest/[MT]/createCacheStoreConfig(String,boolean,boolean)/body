{
  ConfigurationBuilder cfg=TestCacheManagerFactory.getDefaultCacheConfiguration(false);
  JdbcStringBasedCacheStoreConfigurationBuilder store=cfg.loaders().preload(preload).addStore(JdbcStringBasedCacheStoreConfigurationBuilder.class).fetchPersistentState(true).key2StringMapper(mapperName);
  UnitTestDatabaseManager.buildTableManipulation(store.table(),false);
  if (wrap) {
    ConnectionFactoryConfigurationBuilder<?> tmp=UnitTestDatabaseManager.configureUniqueConnectionFactory(new ConfigurationBuilder().loaders().addStore(JdbcStringBasedCacheStoreConfigurationBuilder.class));
    store.connectionFactory(new SharedConnectionFactoryConfigurationBuilder(store)).read((PooledConnectionFactoryConfiguration)tmp.create());
  }
 else {
    UnitTestDatabaseManager.configureUniqueConnectionFactory(store);
  }
  return cfg;
}
