{
  final FileCacheKey fromKey=new FileCacheKey(indexName,from);
  final FileMetadata metadata=(FileMetadata)metadataCache.get(fromKey);
  final int bufferSize=metadata.getBufferSize();
  int i=-1;
  Object ob;
  do {
    ChunkCacheKey fromChunkKey=new ChunkCacheKey(indexName,from,++i,bufferSize);
    ob=chunksCache.get(fromChunkKey);
    if (ob == null) {
      break;
    }
    ChunkCacheKey toChunkKey=new ChunkCacheKey(indexName,to,i,bufferSize);
    chunksCache.withFlags(Flag.IGNORE_RETURN_VALUES).put(toChunkKey,ob);
  }
 while (true);
  metadataCache.put(new FileCacheKey(indexName,to),metadata);
  fileOps.removeAndAdd(from,to);
  readLocks.deleteOrReleaseReadLock(from);
  if (log.isTraceEnabled()) {
    log.tracef("Renamed file from: %s to: %s in index %s",from,to,indexName);
  }
}
