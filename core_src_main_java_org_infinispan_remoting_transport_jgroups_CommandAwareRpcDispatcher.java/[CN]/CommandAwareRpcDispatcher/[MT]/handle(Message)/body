{
  if (isValid(req)) {
    ReplicableCommand cmd=null;
    try {
      Object o=req_marshaller.objectFromBuffer(req.getRawBuffer(),req.getOffset(),req.getLength());
      if (o != null) {
        cmd=(ReplicableCommand)o;
        return executeCommand(cmd,req);
      }
      return null;
    }
 catch (    InterruptedException e) {
      log.warnf("Shutdown while handling command %s",cmd);
      return new ExceptionResponse(new CacheException("Cache is shutting down"));
    }
catch (    Throwable x) {
      if (cmd == null)       log.warnf(x,"Problems unmarshalling remote command from byte buffer");
 else       log.warnf(x,"Problems invoking command %s",cmd);
      return new ExceptionResponse(new CacheException("Problems invoking command.",x));
    }
  }
 else {
    return null;
  }
}
