{
  Message msg=new Message();
  msg.setBuffer(buf);
  if (oob)   msg.setFlag(Message.OOB);
  if (oob || mode != ResponseMode.GET_NONE) {
    msg.setFlag(Message.DONT_BUNDLE);
  }
  if (rsvp)   msg.setFlag(Message.RSVP);
  if (!totalOrder) {
    msg.setFlag(Message.Flag.NO_TOTAL_ORDER);
  }
 else {
    msg.setFlag(Message.Flag.NO_FC);
    msg.setFlag(Message.Flag.DONT_BUNDLE);
    msg.clearFlag(Message.Flag.OOB);
  }
  if (recipient != null)   msg.setDest(recipient);
  return msg;
}
