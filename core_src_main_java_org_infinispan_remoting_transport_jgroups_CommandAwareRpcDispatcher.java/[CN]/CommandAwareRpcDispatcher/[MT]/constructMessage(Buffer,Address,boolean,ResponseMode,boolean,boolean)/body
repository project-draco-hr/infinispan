{
  Message msg=new Message();
  msg.setBuffer(buf);
  if (oob)   msg.setFlag(Message.Flag.OOB);
  if (oob || mode != ResponseMode.GET_NONE)   msg.setFlag(Message.Flag.DONT_BUNDLE);
  if (rsvp)   msg.setFlag(Message.Flag.RSVP);
  if (!totalOrder) {
    msg.setFlag(Message.Flag.NO_TOTAL_ORDER);
    msg.setTransientFlag(Message.TransientFlag.DONT_LOOPBACK);
  }
 else {
    msg.clearFlag(Message.Flag.OOB);
  }
  if (recipient != null)   msg.setDest(recipient);
  return msg;
}
