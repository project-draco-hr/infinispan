{
  if (cmd == null)   throw new NullPointerException("Unable to execute a null command!  Message was " + req);
  if (trace)   log.trace("Attempting to execute command: {0} [sender={1}]",cmd,req.getSrc());
  boolean unlock=false;
  try {
    distributedSync.acquireProcessingLock(false,distributedSyncTimeout,MILLISECONDS);
    unlock=true;
    DistributedSync.SyncResponse sr=distributedSync.blockUntilReleased(distributedSyncTimeout,MILLISECONDS);
    boolean replayIgnored=sr == DistributedSync.SyncResponse.STATE_ACHIEVED;
    if (trace)     log.trace("Enough waiting; replayIgnored = {0}, sr {1}",replayIgnored,sr);
    Response resp=inboundInvocationHandler.handle(cmd);
    if (resp == null || resp.isValid()) {
      if (replayIgnored)       resp=new ExtendedResponse(resp,true);
    }
 else {
      newCacheStarting.set(true);
      if (trace)       log.trace("Unable to execute command, got invalid response");
    }
    return resp;
  }
  finally {
    if (unlock)     distributedSync.releaseProcessingLock();
  }
}
