{
  if (trace)   log.tracef("Replication task sending %s to addresses %s with response mode %s",command,dests,mode);
  boolean rsvp=isRsvpCommand(command);
  RspList<Object> retval=null;
  Buffer buf;
  if (deliverOrder == DeliverOrder.TOTAL) {
    buf=marshallCall(marshaller,command);
    Message message=constructMessage(buf,new AnycastAddress(dests),mode,rsvp,deliverOrder);
    retval=card.castMessage(dests,message,new RequestOptions(mode,timeout,false,filter));
  }
 else   if (broadcast || FORCE_MCAST) {
    buf=marshallCall(marshaller,command);
    RequestOptions opts=new RequestOptions(mode,timeout,false,filter);
    opts.setExclusionList(card.local_addr);
    Message message=constructMessage(buf,null,mode,rsvp,deliverOrder);
    retval=card.castMessage(dests,message,opts);
  }
 else {
    RequestOptions opts=new RequestOptions(mode,timeout,true,filter);
    if (dests.contains(card.local_addr)) {
      throw new IllegalArgumentException("Local address is not allowed in the recipients list at this point");
    }
    if (dests.isEmpty())     return EMPTY_RESPONSES_LIST;
    buf=marshallCall(marshaller,command);
    Message msg=constructMessage(buf,null,mode,rsvp,deliverOrder);
    if (mode != ResponseMode.GET_NONE) {
      GroupRequest<Object> request=card.cast(dests,msg,opts,true);
      retval=request != null ? request.get() : EMPTY_RESPONSES_LIST;
    }
 else {
      card.cast(dests,msg,opts,false);
      retval=EMPTY_RESPONSES_LIST;
    }
  }
  if (mode != ResponseMode.GET_NONE) {
    if (trace)     log.tracef("Responses: %s",retval);
    if (retval == null)     throw new NotSerializableException("RpcDispatcher returned a null.  This is most often caused by args for " + command.getClass().getSimpleName() + " not being serializable.");
  }
  return retval;
}
