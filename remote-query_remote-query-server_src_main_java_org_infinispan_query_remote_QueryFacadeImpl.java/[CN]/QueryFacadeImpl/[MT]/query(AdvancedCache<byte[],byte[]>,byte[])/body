{
  try {
    SerializationContext serCtx=ProtobufMetadataManager.getSerializationContextInternal(cache.getCacheManager());
    QueryRequest request=ProtobufUtil.fromByteArray(serCtx,query,0,query.length,QueryRequest.class);
    QueryResponse response;
    if (cache.getCacheConfiguration().indexing().index().isEnabled()) {
      response=executeQuery(cache,serCtx,request);
    }
 else {
      response=executeNonIndexedQuery(cache,serCtx,request);
    }
    return ProtobufUtil.toByteArray(serCtx,response);
  }
 catch (  IOException e) {
    throw log.errorExecutingQuery(e);
  }
}
