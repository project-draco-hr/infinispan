{
  try {
    SerializationContext serCtx=ProtobufMetadataManager.getSerializationContextInternal(cache.getCacheManager());
    QueryRequest request=ProtobufUtil.fromByteArray(serCtx,query,0,query.length,QueryRequest.class);
    Configuration cacheConfiguration=SecurityActions.getCacheConfiguration(cache);
    QueryResponse response;
    if (cacheConfiguration.indexing().index().isEnabled()) {
      response=executeIndexedQuery(cache,cacheConfiguration,serCtx,request);
    }
 else {
      response=executeNonIndexedQuery(cache,cacheConfiguration,serCtx,request);
    }
    return ProtobufUtil.toByteArray(serCtx,response);
  }
 catch (  IOException e) {
    throw log.errorExecutingQuery(e);
  }
}
