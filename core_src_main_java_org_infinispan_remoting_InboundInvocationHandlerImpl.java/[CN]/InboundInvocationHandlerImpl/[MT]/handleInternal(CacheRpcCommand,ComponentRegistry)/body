{
  try {
    if (trace)     log.tracef("Calling perform() on %s",cmd);
    ResponseGenerator respGen=cr.getResponseGenerator();
    if (cmd instanceof CancellableCommand) {
      cancelService.register(Thread.currentThread(),((CancellableCommand)cmd).getUUID());
    }
    Object retval=cmd.perform(null);
    Response response=respGen.getResponse(cmd,retval);
    log.tracef("About to send back response %s for command %s",response,cmd);
    return response;
  }
 catch (  OutdatedTopologyException oe) {
    log.outdatedTopology(oe);
    return new ExceptionResponse(oe);
  }
catch (  Exception e) {
    log.exceptionExecutingInboundCommand(e);
    return new ExceptionResponse(e);
  }
 finally {
    if (cmd instanceof CancellableCommand) {
      cancelService.unregister(((CancellableCommand)cmd).getUUID());
    }
  }
}
