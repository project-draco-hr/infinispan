{
  IndexingConfigurationBuilder cfgBuilder=new ConfigurationBuilder().loaders().passivation(false).preload(false).addFileCacheStore().location(TMP_DIR + File.separator + "cacheStore").fetchPersistentState(true).purgeOnStartup(false).indexing().enable().indexLocalOnly(true).addProperty("hibernate.search.default.directory_provider","filesystem").addProperty("hibernate.search.default.indexBase",TMP_DIR + File.separator + "idx");
  if (batchingEnabled) {
    cfgBuilder.invocationBatching().enable();
  }
 else {
    cfgBuilder.invocationBatching().disable();
  }
  org.infinispan.configuration.cache.Configuration configuration=cfgBuilder.build();
  EmbeddedCacheManager manager=new DefaultCacheManager(configuration);
  return manager;
}
