{
  CollectionGeneratingBucketHandler<InternalCacheEntry> g=new CollectionGeneratingBucketHandler<InternalCacheEntry>(){
    @Override public boolean consider(    Collection<? extends InternalCacheEntry> entries){
      for (Iterator<? extends InternalCacheEntry> i=entries.iterator(); i.hasNext() && generated.size() < max; ) {
        generated.add(i.next());
      }
      return generated.size() >= max;
    }
  }
;
  loopOverBuckets(g);
  return g.generate();
}
