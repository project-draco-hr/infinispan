{
  if (!ctx.isOriginLocal()) {
    return invokeNextInterceptor(ctx,command);
  }
  Transaction tx;
  if (transactionManager.getTransaction() != null || (tx=batchContainer.getBatchTransaction()) == null) {
    return invokeNextInterceptor(ctx,command);
  }
  try {
    transactionManager.resume(tx);
    InvocationContext invocationContext=ctx;
    if (!ctx.isInTxScope()) {
      log.tracef("Called with a non-tx invocation context: %s",ctx);
      invocationContext=invocationContextFactory.createInvocationContext(true,-1);
    }
    return invokeNextInterceptor(invocationContext,command);
  }
  finally {
    if (transactionManager.getTransaction() != null && batchContainer.isSuspendTxAfterInvocation())     transactionManager.suspend();
  }
}
