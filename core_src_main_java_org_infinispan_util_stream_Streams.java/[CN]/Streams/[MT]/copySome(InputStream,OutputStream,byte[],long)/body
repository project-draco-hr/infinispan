{
  long total=0;
  int read;
  int readLength;
  boolean trace=log.isTraceEnabled();
  readLength=Math.min((int)length,buffer.length);
  if (trace) {
    log.trace("initial read length: " + readLength);
  }
  while (readLength != 0 && (read=input.read(buffer,0,readLength)) != -1) {
    if (trace)     log.trace("read bytes: " + read);
    output.write(buffer,0,read);
    total+=read;
    if (trace)     log.trace("total bytes read: " + total);
    readLength=Math.min((int)(length - total),buffer.length);
    if (trace)     log.trace("next read length: " + readLength);
  }
  return total;
}
