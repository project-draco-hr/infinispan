{
  EntityManager em=emf.createEntityManager();
  try {
    CriteriaBuilder builder=em.getCriteriaBuilder();
    CriteriaQuery<Long> cq=builder.createQuery(Long.class);
    cq.select(builder.count(cq.from(configuration.entityClass())));
    return em.createQuery(cq).getSingleResult().intValue();
  }
  finally {
    em.close();
  }
}
