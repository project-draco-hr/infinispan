{
  boolean trace=log.isTraceEnabled();
  JMXComponent<?> parentComponent=ctx.getParentResourceComponent();
  EmsConnection conn=parentComponent.getEmsConnection();
  if (conn != null) {
    if (trace)     log.trace("Connection to ems server established: " + conn);
    ObjectNameQueryUtility queryUtility=new ObjectNameQueryUtility(objectName);
    List<EmsBean> beans=conn.queryBeans(queryUtility.getTranslatedQuery());
    if (trace)     log.trace("Querying [" + queryUtility.getTranslatedQuery() + "] returned beans: "+ beans);
    Set<DiscoveredResourceDetails> discoveredResources=new HashSet<DiscoveredResourceDetails>();
    for (    EmsBean bean : beans) {
      if (CacheManagerComponent.isCacheManagerComponent(bean)) {
        String managerName=bean.getBeanName().getCanonicalName();
        String resourceName=bean.getAttribute("Name").getValue().toString();
        String version=bean.getAttribute("Version").getValue().toString();
        if (trace)         log.trace("Add resource with version '" + version + "' and type "+ ctx.getResourceType());
        DiscoveredResourceDetails detail=new DiscoveredResourceDetails(ctx.getResourceType(),resourceName,resourceName,version,"A cache manager within Infinispan",pluginConfiguration,null);
        if (log.isInfoEnabled()) {
          log.info(String.format("Discovered Infinispan instance with key %s and name %s",resourceName,managerName));
        }
        discoveredResources.add(detail);
      }
 else {
        log.warn(String.format("MBeanServer returned spurious object %s",bean.getBeanName().getCanonicalName()));
      }
    }
    return discoveredResources;
  }
 else {
    log.debug("Unable to establish connection");
    return null;
  }
}
