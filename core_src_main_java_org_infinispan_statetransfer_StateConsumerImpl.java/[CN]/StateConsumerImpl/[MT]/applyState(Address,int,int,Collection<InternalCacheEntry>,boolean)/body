{
  if (!cacheTopology.getWriteConsistentHash().getSegmentsForOwner(rpcManager.getAddress()).contains(segmentId)) {
    if (trace) {
      log.warnf("Discarding received cache entries for segment %d because they do not belong to this node.",segmentId);
    }
    return;
  }
  if (cacheEntries != null) {
    doApplyState(sender,segmentId,cacheEntries);
  }
  InboundTransferTask inboundTransfer;
synchronized (this) {
    inboundTransfer=transfersBySegment.get(segmentId);
  }
  if (inboundTransfer != null) {
    inboundTransfer.onStateReceived(segmentId,isLastChunk);
  }
 else {
    log.debugf("Received unsolicited state for segment %d from node %s",segmentId,sender);
    return;
  }
  if (trace) {
    log.tracef("After applying the received state the data container has %d keys",dataContainer.size());
synchronized (this) {
      log.tracef("Segments not received yet: %s",transfersBySource);
    }
  }
}
