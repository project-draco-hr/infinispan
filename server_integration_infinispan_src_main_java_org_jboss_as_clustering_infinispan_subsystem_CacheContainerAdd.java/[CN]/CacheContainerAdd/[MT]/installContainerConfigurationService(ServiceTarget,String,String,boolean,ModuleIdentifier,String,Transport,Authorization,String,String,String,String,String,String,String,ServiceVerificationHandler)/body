{
  final ServiceName configServiceName=EmbeddedCacheManagerConfigurationService.getServiceName(containerName);
  final EmbeddedCacheManagerDependencies dependencies=new EmbeddedCacheManagerDependencies(transportConfig,authorizationConfig);
  final Service<EmbeddedCacheManagerConfiguration> service=new EmbeddedCacheManagerConfigurationService(containerName,defaultCache,statistics,moduleId,dependencies);
  final ServiceBuilder<EmbeddedCacheManagerConfiguration> configBuilder=target.addService(configServiceName,service).addDependency(Services.JBOSS_SERVICE_MODULE_LOADER,ModuleLoader.class,dependencies.getModuleLoaderInjector()).addDependency(MBeanServerService.SERVICE_NAME,MBeanServer.class,dependencies.getMBeanServerInjector()).setInitialMode(ServiceController.Mode.ON_DEMAND);
  if (transportConfig != null) {
    if (transportExecutor != null) {
      addExecutorDependency(configBuilder,transportExecutor,transportConfig.getExecutorInjector());
      addExecutorDependency(configBuilder,totalOrderExecutor,transportConfig.getTotalorderExecutorInjector());
      addExecutorDependency(configBuilder,remoteCommandExecutor,transportConfig.getRemoteCommandExecutorInjector());
    }
    configBuilder.addDependency(ChannelFactoryService.getServiceName(stack),ChannelFactory.class,transportConfig.getChannelFactoryInjector());
  }
  addExecutorDependency(configBuilder,listenerExecutor,dependencies.getListenerExecutorInjector());
  addExecutorDependency(configBuilder,stateTransferExecutor,dependencies.getStateTransferExecutorInjector());
  addScheduledExecutorDependency(configBuilder,expirationExecutor,dependencies.getExpirationExecutorInjector());
  addScheduledExecutorDependency(configBuilder,replicationQueueExecutor,dependencies.getReplicationQueueExecutorInjector());
  return configBuilder.install();
}
