{
  Connection conn=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    String sql=tableManipulation.getLoadAllRowsSql();
    if (log.isTraceEnabled()) {
      log.trace("Running loadAll. Sql: '" + sql + "'");
    }
    conn=connectionFactory.getConnection();
    ps=conn.prepareStatement(sql);
    rs=ps.executeQuery();
    rs.setFetchSize(config.getFetchSize());
    Set<StoredEntry> result=new HashSet<StoredEntry>();
    while (rs.next()) {
      InputStream binaryStream=rs.getBinaryStream(1);
      Bucket bucket=(Bucket)JdbcUtil.unmarshall(getMarshaller(),binaryStream);
      result.addAll(bucket.getStoredEntries());
    }
    return result;
  }
 catch (  SQLException e) {
    String message="sql failure while loading key: ";
    log.error(message,e);
    throw new CacheLoaderException(message,e);
  }
 finally {
    JdbcUtil.safeClose(rs);
    JdbcUtil.safeClose(ps);
    connectionFactory.releaseConnection(conn);
  }
}
