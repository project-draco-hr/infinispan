{
  Connection conn=null;
  PreparedStatement ps=null;
  ResultSet rs=null;
  try {
    conn=connectionFactory.getConnection();
    String sql=tableManipulation.getLoadAllRowsSql();
    ps=conn.prepareStatement(sql);
    rs=ps.executeQuery();
    rs.setFetchSize(config.getFetchSize());
    while (rs.next()) {
      InputStream inputStream=rs.getBinaryStream(1);
      Bucket bucket=(Bucket)JdbcUtil.unmarshall(getMarshaller(),inputStream);
      String bucketName=rs.getString(2);
      objectOutput.writeObject(bucketName);
      objectOutput.writeObject(bucket);
    }
    objectOutput.writeObject(BINARY_STREAM_DELIMITER);
  }
 catch (  SQLException ex) {
    logAndThrow(ex,"SQL failure while writing store's content to stream");
  }
catch (  IOException e) {
    logAndThrow(e,"IO failure while writing store's content to stream");
  }
 finally {
    JdbcUtil.safeClose(rs);
    JdbcUtil.safeClose(ps);
    connectionFactory.releaseConnection(conn);
  }
}
