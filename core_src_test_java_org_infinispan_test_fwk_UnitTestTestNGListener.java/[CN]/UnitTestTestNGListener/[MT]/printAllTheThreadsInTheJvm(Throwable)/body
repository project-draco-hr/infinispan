{
  if (e instanceof OutOfMemoryError) {
    Map<Thread,StackTraceElement[]> allStackTraces=Thread.getAllStackTraces();
    log.tracef("Dumping all %s threads in the system.",allStackTraces.size());
    for (    Map.Entry<Thread,StackTraceElement[]> s : allStackTraces.entrySet()) {
      StringBuilder sb=new StringBuilder();
      sb.append("Thread: ").append(s.getKey().getName()).append(". Stack trace:\n");
      for (      StackTraceElement ste : s.getValue()) {
        sb.append("      ").append(ste.toString()).append("\n");
      }
      log.trace(sb.toString());
    }
  }
}
