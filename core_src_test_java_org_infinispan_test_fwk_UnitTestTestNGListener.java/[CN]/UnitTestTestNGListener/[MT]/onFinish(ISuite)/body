{
  if (log.isTraceEnabled()) {
    log.trace("Possible leaked threads at the end of the test suite:");
    for (    Map.Entry<Thread,StackTraceElement[]> s : Thread.getAllStackTraces().entrySet()) {
      Thread thread=s.getKey();
      if (thread.getName().startsWith("TestNG") || seenThreads != null && seenThreads.contains(thread.getName() + "-" + thread.getId()+ "-"+ thread.hashCode())) {
        continue;
      }
      StringBuilder sb=new StringBuilder();
      sb.append("Thread: name=").append(thread.getName()).append(", group=").append(thread.getThreadGroup().getName()).append(", isDaemon=").append(thread.isDaemon()).append(", isInterrupted=").append(thread.isInterrupted()).append(", Stack trace:\n");
      for (      StackTraceElement ste : s.getValue()) {
        sb.append("      ").append(ste.toString()).append("\n");
      }
      log.trace(sb.toString());
    }
    seenThreads=null;
  }
}
