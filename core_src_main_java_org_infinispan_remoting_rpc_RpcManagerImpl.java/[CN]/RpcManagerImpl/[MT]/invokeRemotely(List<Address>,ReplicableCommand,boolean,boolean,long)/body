{
  if (trace)   log.trace("{0} broadcasting call {1} to recipient list {2}",t.getAddress(),rpc,recipients);
  if (useReplicationQueue(sync)) {
    replicationQueue.add(rpc);
  }
 else {
    if (!(rpc instanceof CacheRpcCommand)) {
      rpc=cf.buildSingleRpcCommand(rpc);
    }
    List rsps;
    try {
      rsps=invokeRemotely(recipients,rpc,getResponseMode(sync),timeout,usePriorityQueue);
      if (trace)       log.trace("responses=" + rsps);
      if (sync)       checkResponses(rsps);
    }
 catch (    CacheException e) {
      log.error("Replication exception",e);
      throw e;
    }
catch (    Exception ex) {
      log.error("Unexpected exception",ex);
      throw new ReplicationException("Unexpected exception while replicating",ex);
    }
  }
}
