{
  if (config.transaction().transactionMode().isTransactional()) {
    Transaction transaction=tx == null ? getOngoingTransaction() : tx;
    if (transaction != null)     return getInvocationContext(transaction,explicitClassLoader);
  }
  InvocationContext result=icc.createInvocationContext(false,keyCount);
  setInvocationContextFlagsAndClassLoader(result,explicitClassLoader);
  return result;
}
