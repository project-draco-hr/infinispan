{
  assertKeyValueNotNull(key,value);
  assertValueNotNull(oldValue);
  ReplaceCommand command;
  if (version == null) {
    command=commandsFactory.buildReplaceCommand(key,oldValue,value,lifespanUnit.toMillis(lifespan),idleTimeUnit.toMillis(maxIdleTime),explicitFlags);
  }
 else {
    command=commandsFactory.buildVersionedReplaceCommand(key,oldValue,value,lifespanUnit.toMillis(lifespan),idleTimeUnit.toMillis(maxIdleTime),version,explicitFlags);
  }
  return (Boolean)executeCommandAndCommitIfNeeded(ctx,command);
}
