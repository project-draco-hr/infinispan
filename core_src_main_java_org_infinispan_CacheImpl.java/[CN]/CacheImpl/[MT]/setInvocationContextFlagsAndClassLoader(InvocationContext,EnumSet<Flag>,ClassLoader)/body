{
  PreInvocationContext pic=null;
  if (explicitFlags == null) {
    pic=preInvocationContextHolder.get();
    if (!pic.flags.isEmpty())     ctx.setFlags(pic.flags);
  }
 else {
    ctx.setFlags(explicitFlags);
  }
  if (explicitClassLoader == null) {
    if (pic == null)     pic=preInvocationContextHolder.get();
    ClassLoader cl=pic.classLoader != null ? pic.classLoader : getClassLoader();
    ctx.setClassLoader(cl);
  }
 else {
    ctx.setClassLoader(explicitClassLoader);
  }
  if (pic != null)   pic.reset();
  return ctx;
}
