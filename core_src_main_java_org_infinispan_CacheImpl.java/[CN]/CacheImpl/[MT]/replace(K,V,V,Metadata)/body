{
  TimeUnit lifespanUnit=metadata.lifespanUnit();
  TimeUnit maxIdleUnit=metadata.maxIdleUnit();
  long lifespan=metadata.lifespan();
  long maxIdleTime=metadata.maxIdle();
  EntryVersion version=metadata.version();
  if (version == null) {
    if (lifespanUnit != null && maxIdleUnit != null)     return replace(key,oldValue,value,lifespan,lifespanUnit,maxIdleTime,maxIdleUnit);
 else     if (lifespanUnit != null)     return replace(key,oldValue,value,lifespan,lifespanUnit);
 else     return replace(key,oldValue,value);
  }
 else {
    if (lifespanUnit != null && maxIdleUnit != null)     return replace(key,oldValue,value,lifespan,lifespanUnit,maxIdleTime,maxIdleUnit,null,null,version);
 else     if (lifespanUnit != null)     return replace(key,oldValue,value,lifespan,lifespanUnit,defaultMaxIdleTime,MILLISECONDS,null,null,version);
 else     return replace(key,oldValue,value,defaultLifespan,MILLISECONDS,defaultMaxIdleTime,MILLISECONDS,null,null,version);
  }
}
