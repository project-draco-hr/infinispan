{
  final IndexShardingStrategy indexShardingStrategy=builder.getDirectoryProviderSelectionStrategy();
  final DirectoryProvider[] directoryProviders;
  if (filterDefinitions != null && !filterDefinitions.isEmpty()) {
    directoryProviders=indexShardingStrategy.getDirectoryProvidersForQuery(filterDefinitions.values().toArray(new FullTextFilterImplementor[filterDefinitions.size()]));
  }
 else {
    directoryProviders=indexShardingStrategy.getDirectoryProvidersForQuery(EMPTY_FULL_TEXT_FILTER_IMPLEMENTOR);
  }
  for (  DirectoryProvider provider : directoryProviders) {
    if (!directories.contains(provider)) {
      directories.add(provider);
    }
  }
}
