{
  final String fileName=key.getFileName();
  final int chunkId=key.getChunkId();
  int bufferSize=key.getBufferSize();
  final int seekTo=chunkId * bufferSize;
  final byte[] buffer;
  final IndexInput input=directory.openInput(fileName,IOContext.READ);
  final int length=(int)input.length();
  try {
    if (seekTo != 0) {
      input.seek(seekTo);
    }
    bufferSize=Math.min(length - seekTo,bufferSize);
    buffer=new byte[bufferSize];
    input.readBytes(buffer,0,bufferSize);
  }
  finally {
    input.close();
  }
  return buffer;
}
