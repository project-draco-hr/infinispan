{
  jmxConnectionProvider=new MBeanServerConnectionProvider(getServer().getHotrodEndpoint().getInetAddress().getHostName(),SERVER1_MGMT_PORT);
  rcmFactory=new RemoteCacheManagerFactory();
  ConfigurationBuilder clientBuilder=new ConfigurationBuilder();
  clientBuilder.addServer().host(getServer().getHotrodEndpoint().getInetAddress().getHostName()).port(getServer().getHotrodEndpoint().getPort()).marshaller(new ProtoStreamMarshaller());
  remoteCacheManager=rcmFactory.createManager(clientBuilder);
  remoteCache=remoteCacheManager.getCache(cacheName);
  String mbean="jboss.infinispan:type=RemoteQuery,name=" + ObjectName.quote(cacheContainerName) + ",component=ProtobufMetadataManager";
  String[] fileNames={"sample_bank_account/bank.proto","infinispan/indexing.proto","google/protobuf/descriptor.proto"};
  String[] fileContents={read("/sample_bank_account/bank.proto"),read("/infinispan/indexing.proto"),read("/google/protobuf/descriptor.proto")};
  invokeOperation(jmxConnectionProvider,mbean,"registerProtofiles",new Object[]{fileNames,fileContents},new String[]{String[].class.getName(),String[].class.getName()});
  MarshallerRegistration.registerMarshallers(ProtoStreamMarshaller.getSerializationContext(remoteCacheManager));
}
