{
  if (trace)   log.trace("purgeInternal");
  Cassandra.Client cassandraClient=null;
  try {
    cassandraClient=dataSource.getConnection();
    SlicePredicate predicate=new SlicePredicate();
    predicate.setSlice_range(new SliceRange(ByteBufferUtil.EMPTY_BYTE_BUFFER,ByteBufferUtil.bytes(System.currentTimeMillis()),false,SLICE_SIZE));
    for (boolean complete=false; !complete; ) {
      Map<ByteBuffer,Map<String,List<Mutation>>> mutationMap=new HashMap<ByteBuffer,Map<String,List<Mutation>>>(SLICE_SIZE);
      List<ColumnOrSuperColumn> slice=cassandraClient.get_slice(expirationKey,expirationColumnParent,predicate,readConsistencyLevel);
      complete=slice.size() < SLICE_SIZE;
      for (      ColumnOrSuperColumn crumb : slice) {
        SuperColumn scol=crumb.getSuper_column();
        for (Iterator<Column> i=scol.getColumnsIterator(); i.hasNext(); ) {
          Column col=i.next();
          remove0(ByteBuffer.wrap(col.getName()),mutationMap);
        }
        addMutation(mutationMap,expirationKey,config.expirationColumnFamily,ByteBuffer.wrap(scol.getName()),null,null);
      }
      cassandraClient.batch_mutate(mutationMap,writeConsistencyLevel);
    }
  }
 catch (  Exception e) {
    throw new CacheLoaderException(e);
  }
 finally {
    dataSource.releaseConnection(cassandraClient);
  }
}
