{
  MVCCEntry e=ctx.lookupEntry(key);
  if (e != null) {
    if (ctx.isOriginLocal()) {
      if (e.isNullEntry())       return returnValue(null,false);
      if (oldValue == null || oldValue.equals(e.getValue())) {
        Object old=e.setValue(newValue);
        e.setLifespan(lifespanMillis);
        return returnValue(old,true);
      }
      return returnValue(null,false);
    }
 else {
      Object old=e.setValue(newValue);
      e.setLifespan(lifespanMillis);
      return returnValue(old,true);
    }
  }
  return returnValue(null,false);
}
