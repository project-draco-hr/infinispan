{
  if (!stateTransferLock.acquireForCommand(ctx,cmd)) {
    throw new RehashInProgressException("Timed out waiting for the transaction lock");
  }
  try {
    return super.visitPrepareCommand(ctx,cmd);
  }
  finally {
    stateTransferLock.releaseForCommand(ctx,cmd);
  }
}
