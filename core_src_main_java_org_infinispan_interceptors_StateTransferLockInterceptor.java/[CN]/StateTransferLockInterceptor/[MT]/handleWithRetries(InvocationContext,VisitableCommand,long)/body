{
  long endNanos=System.nanoTime() + TimeUnit.MILLISECONDS.toNanos(timeoutMillis);
  while (true) {
    int newCacheViewId=-1;
    try {
      return invokeNextInterceptor(ctx,command);
    }
 catch (    StateTransferInProgressException e) {
      newCacheViewId=e.getNewCacheViewId();
    }
catch (    SuspectException e) {
      newCacheViewId=newCacheViewId + 1;
    }
    if (endNanos < System.nanoTime()) {
      throw new TimeoutException("Timed out waiting for the state transfer to end");
    }
    stateTransferLock.waitForStateTransferToEnd(ctx,command,newCacheViewId);
  }
}
