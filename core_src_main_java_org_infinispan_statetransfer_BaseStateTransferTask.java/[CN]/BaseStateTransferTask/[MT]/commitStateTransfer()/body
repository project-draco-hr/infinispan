{
  if (running)   throw new IllegalStateException("State transfer has not finished, cannot commit");
  try {
    stateTransferLock.unblockNewTransactions(newViewId);
  }
 catch (  Exception e) {
    log.errorUnblockingTransactions(e);
  }
  stateTransferManager.endStateTransfer();
  log.debugf("Node %s completed state transfer for view %d in %s!",self,newViewId,Util.prettyPrintTime(System.currentTimeMillis() - stateTransferStartMillis));
}
