{
  ExecutorService service=Executors.newCachedThreadPool();
  List<HashSet<Integer>> sets=new ArrayList<>();
  List<Future<Integer>> futures=new ArrayList<Future<Integer>>();
  for (  EmbeddedCacheManager manager : cacheManagers) {
    Cache<?,?> cache=manager.getCache();
    AtomicObjectFactory factory=new AtomicObjectFactory(cache);
    HashSet<Integer> set=factory.getInstanceOf(HashSet.class,"aset",false,null,false);
    set.add(-1);
    sets.add(set);
  }
  for (  Set<Integer> s : sets) {
    futures.add(service.submit(new ExerciseAtomicSetTask(s,NCALLS)));
  }
  Integer total=0;
  for (  Future<Integer> future : futures) {
    total+=future.get();
  }
  service.shutdown();
  assertEquals(NCALLS,total.intValue());
}
