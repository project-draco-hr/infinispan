{
  log.debugf("Injecting BlockCommandInterceptor in %s",cache);
  AsyncInterceptorChain chain=cache.getAdvancedCache().getAsyncInterceptorChain();
  BlockCommandInterceptor interceptor=chain.findInterceptorExtending(BlockCommandInterceptor.class);
  if (interceptor == null) {
    interceptor=new BlockCommandInterceptor(log);
    if (!chain.addInterceptorAfter(interceptor,EntryWrappingInterceptor.class)) {
      if (!chain.addInterceptorAfter(interceptor,VersionedEntryWrappingInterceptor.class)) {
        AssertJUnit.assertTrue(chain.addInterceptorAfter(interceptor,TotalOrderVersionedEntryWrappingInterceptor.class));
      }
    }
  }
  interceptor.reset();
  log.debugf("Injected BlockCommandInterceptor in %s. Interceptor=%s",cache,interceptor);
  return interceptor;
}
