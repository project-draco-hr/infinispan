{
  if (trace) {
    log.tracef("Installing new cache topology %s",newCacheTopology);
  }
  newCacheTopology=addGrouping(newCacheTopology);
  CacheTopology oldCacheTopology=stateConsumer.getCacheTopology();
  ConsistentHash oldCH=oldCacheTopology != null ? oldCacheTopology.getWriteConsistentHash() : null;
  ConsistentHash newCH=newCacheTopology.getWriteConsistentHash();
  cacheNotifier.notifyTopologyChanged(oldCH,newCH,true);
  stateConsumer.onTopologyUpdate(newCacheTopology,isRebalance);
  stateProvider.onTopologyUpdate(newCacheTopology,isRebalance);
  cacheNotifier.notifyTopologyChanged(oldCH,newCH,false);
}
