{
  int cmdTopologyId=command.getTopologyId();
  CacheTopology cacheTopology=getCacheTopology();
  int localTopologyId=cacheTopology != null ? cacheTopology.getTopologyId() : -1;
  log.tracef("CommandTopologyId=%s, localTopologyId=%s",cmdTopologyId,localTopologyId);
  if (cmdTopologyId < localTopologyId) {
    ConsistentHash readCh=cacheTopology.getReadConsistentHash();
    ConsistentHash writeCh=cacheTopology.getWriteConsistentHash();
    Set<Address> newTargets=writeCh.locateAllOwners(affectedKeys);
    newTargets.remove(rpcManager.getAddress());
    newTargets.remove(origin);
    if (!newTargets.isEmpty()) {
      command.setTopologyId(localTopologyId);
      log.tracef("Forwarding command %s to new targets %s",command,newTargets);
      rpcManager.invokeRemotely(newTargets,command,sync,false);
    }
  }
}
