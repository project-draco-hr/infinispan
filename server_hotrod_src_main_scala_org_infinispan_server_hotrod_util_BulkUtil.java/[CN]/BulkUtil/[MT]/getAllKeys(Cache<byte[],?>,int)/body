{
  CacheMode cacheMode=cache.getAdvancedCache().getCacheConfiguration().clustering().cacheMode();
  boolean keysAreLocal=!cacheMode.isClustered() || cacheMode.isReplicated();
  if (keysAreLocal || scope == LOCAL_SCOPE) {
    return cache.keySet();
  }
 else {
    MapReduceTask<byte[],Object,byte[],Object> task=new MapReduceTask<byte[],Object,byte[],Object>((Cache<byte[],Object>)cache).mappedWith(new KeyMapper<byte[]>()).reducedWith(new KeyReducer<byte[]>());
    return task.execute(createCollator(cache));
  }
}
