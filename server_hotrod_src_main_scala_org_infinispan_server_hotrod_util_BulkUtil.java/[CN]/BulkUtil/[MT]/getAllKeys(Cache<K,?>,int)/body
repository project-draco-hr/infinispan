{
  CacheMode cacheMode=cache.getAdvancedCache().getCacheConfiguration().clustering().cacheMode();
  boolean keysAreLocal=!cacheMode.isClustered() || cacheMode.isReplicated();
  if (keysAreLocal || scope == LOCAL_SCOPE) {
    return cache.keySet();
  }
 else {
    MapReduceTask<K,Object,K,Object> task=new MapReduceTask<K,Object,K,Object>((Cache<K,Object>)cache).mappedWith(new KeyMapper<K>()).reducedWith(new KeyReducer<K>());
    return task.execute(new KeysCollator<K>());
  }
}
