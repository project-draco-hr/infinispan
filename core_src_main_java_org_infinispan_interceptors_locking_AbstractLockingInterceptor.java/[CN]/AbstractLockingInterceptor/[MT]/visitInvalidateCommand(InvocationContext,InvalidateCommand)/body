{
  try {
    if (hasSkipLocking(command)) {
      return invokeNextInterceptor(ctx,command);
    }
    lockAllAndRecord(ctx,Arrays.asList(command.getKeys()),getLockTimeoutMillis(command));
    return invokeNextInterceptor(ctx,command);
  }
  finally {
    if (!ctx.isInTxScope()) {
      lockManager.unlockAll(ctx);
    }
  }
}
