{
  try {
    if (hasSkipLocking(command)) {
      return ctx.shortCircuit(ctx.forkInvocationSync(command));
    }
    lockAllAndRecord(ctx,Arrays.asList(command.getKeys()),getLockTimeoutMillis(command));
    return ctx.shortCircuit(ctx.forkInvocationSync(command));
  }
  finally {
    if (!ctx.isInTxScope()) {
      lockManager.unlockAll(ctx);
    }
  }
}
