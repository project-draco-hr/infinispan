{
  provider=new MBeanServerConnectionProvider(server.getHotrodEndpoint().getInetAddress().getHostName(),9999);
  rcmFactory=new RemoteCacheManagerFactory();
  ConfigurationBuilder clientBuilder=new ConfigurationBuilder();
  clientBuilder.addServer().host(server.getHotrodEndpoint().getInetAddress().getHostName()).port(server.getHotrodEndpoint().getPort()).marshaller(new ProtoStreamMarshaller());
  remoteCacheManager=rcmFactory.createManager(clientBuilder);
  remoteCache=remoteCacheManager.getCache(CACHE_NAME);
  ObjectName protobufMetadataManagerName=new ObjectName("jboss.infinispan:type=RemoteQuery,name=" + ObjectName.quote(CACHE_MANAGER_NAME) + ",component=ProtobufMetadataManager");
  ProtobufMetadataManagerMBean protobufMetadataManagerMBean=JMX.newMBeanProxy(provider.getConnection(),protobufMetadataManagerName,ProtobufMetadataManagerMBean.class);
  protobufMetadataManagerMBean.registerProtofile(readClasspathResource("/sample_bank_account/bank.protobin"));
  MarshallerRegistration.registerMarshallers(ProtoStreamMarshaller.getSerializationContext(remoteCacheManager));
}
