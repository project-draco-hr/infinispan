{
  InvocationContext invocationContext;
  boolean txInjected=false;
  if (config.transaction().transactionMode().isTransactional() && !isPutForExternalRead) {
    Transaction transaction=getOngoingTransaction();
    if (transaction == null && config.transaction().autoCommit()) {
      transaction=tryBegin();
      txInjected=true;
    }
    invocationContext=getInvocationContext(transaction,explicitClassLoader,txInjected);
  }
 else {
    invocationContext=getInvocationContextForWrite(explicitClassLoader,keyCount,isPutForExternalRead);
  }
  return invocationContext;
}
