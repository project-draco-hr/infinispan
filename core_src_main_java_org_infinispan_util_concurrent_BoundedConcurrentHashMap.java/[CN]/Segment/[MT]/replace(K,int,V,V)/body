{
  lock();
  Set<HashEntry<K,V>> evicted=null;
  try {
    HashEntry<K,V> e=getFirst(hash);
    while (e != null && (e.hash != hash || !map.comparingKey.equals(key,e.key))) {
      e=e.next;
    }
    boolean replaced=false;
    if (e != null && map.comparingValue.equals(oldValue,e.value)) {
      replaced=true;
      e.value=newValue;
      if (eviction.onEntryHit(e)) {
        evicted=attemptEviction(true);
      }
    }
    return replaced;
  }
  finally {
    unlock();
    notifyEvictionListener(evicted);
  }
}
