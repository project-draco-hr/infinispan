{
  if (resultSize == null) {
    IndexSearcher searcher=buildSearcher(searchFactory);
    if (searcher == null) {
      resultSize=0;
    }
 else {
      TopDocs hits;
      try {
        hits=getQueryHits(searcher,1).topDocs;
        resultSize=hits.totalHits;
      }
 catch (      IOException e) {
        throw new HibernateException("Unable to query Lucene index",e);
      }
 finally {
        try {
          closeSearcher(searcher,searchFactory.getReaderProvider());
        }
 catch (        SearchException e) {
          log.warn("Unable to properly close searcher during lucene query: " + e);
        }
      }
    }
  }
  return this.resultSize;
}
