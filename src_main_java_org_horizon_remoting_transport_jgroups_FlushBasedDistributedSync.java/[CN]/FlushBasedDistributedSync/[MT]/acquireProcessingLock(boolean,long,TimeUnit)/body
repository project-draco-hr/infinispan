{
  while (true) {
    try {
      Lock lock=exclusive ? processingLock.writeLock() : processingLock.readLock();
      if (!lock.tryLock(timeout,timeUnit))       throw new TimeoutException("Could not obtain " + (exclusive ? "exclusive" : "shared") + " processing lock");
      break;
    }
 catch (    InterruptedException ie) {
      Thread.currentThread().interrupt();
    }
  }
}
