{
  this.parserMappings=CollectionFactory.makeConcurrentMap();
  this.cl=new WeakReference<ClassLoader>(classLoader);
  Collection<Class<ConfigurationParser>> parsers=ServiceFinder.load(ConfigurationParser.class,cl.get(),ParserRegistry.class.getClassLoader());
  for (  Class<ConfigurationParser> parserClass : parsers) {
    try {
      ConfigurationParser parser=parserClass.newInstance();
      Namespaces namespacesAnnotation=parserClass.getAnnotation(Namespaces.class);
      Namespace[] namespaces;
      if (namespacesAnnotation != null) {
        namespaces=namespacesAnnotation.value();
      }
 else {
        Namespace namespaceAnnotation=parserClass.getAnnotation(Namespace.class);
        if (namespaceAnnotation != null) {
          namespaces=new Namespace[]{namespaceAnnotation};
        }
 else {
          throw log.parserDoesNotDeclareNamespaces(parserClass.getName());
        }
      }
      for (      Namespace ns : namespaces) {
        QName qName=new QName(ns.uri(),ns.root());
        if (parserMappings.putIfAbsent(qName,parser) != null) {
          throw log.parserRootElementAlreadyRegistered(qName);
        }
      }
    }
 catch (    Exception e) {
    }
  }
}
