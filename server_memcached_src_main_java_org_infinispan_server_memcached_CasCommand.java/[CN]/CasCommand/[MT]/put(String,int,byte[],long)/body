{
  Value old=(Value)cache.get(key);
  if (old != null) {
    if (old.getCas() == cas) {
      Value value=new Value(flags,data);
      boolean replaced=cache.replace(key,old,value);
      if (replaced)       return StorageReply.STORED;
 else       return StorageReply.EXISTS;
    }
 else {
      return StorageReply.EXISTS;
    }
  }
  return StorageReply.NOT_FOUND;
}
