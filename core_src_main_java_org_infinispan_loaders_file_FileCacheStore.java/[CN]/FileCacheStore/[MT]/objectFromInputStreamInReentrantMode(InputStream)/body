{
  int len=is.available();
  ExposedByteArrayOutputStream bytes=new ExposedByteArrayOutputStream(len);
  byte[] buf=new byte[Math.min(len,1024)];
  int bytesRead;
  while ((bytesRead=is.read(buf,0,buf.length)) != -1) {
    bytes.write(buf,0,bytesRead);
  }
  is=new ByteArrayInputStream(bytes.getRawBuffer(),0,bytes.size());
  ObjectInput unmarshaller=marshaller.startObjectInput(is,true);
  Object o=null;
  try {
    o=marshaller.objectFromObjectStream(unmarshaller);
  }
  finally {
    marshaller.finishObjectInput(unmarshaller);
  }
  return o;
}
