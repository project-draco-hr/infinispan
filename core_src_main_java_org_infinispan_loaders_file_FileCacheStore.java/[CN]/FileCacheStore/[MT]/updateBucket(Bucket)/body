{
  File f=new File(root,b.getBucketName());
  if (f.exists()) {
    if (!deleteFile(f))     log.warn("Had problems removing file {0}",f);
  }
 else   if (log.isTraceEnabled()) {
    log.trace("Successfully deleted file: '" + f.getName() + "'");
  }
  if (!b.getEntries().isEmpty()) {
    FileOutputStream fos=null;
    try {
      byte[] bytes=marshaller.objectToByteBuffer(b);
      fos=new FileOutputStream(f);
      fos.write(bytes);
      fos.flush();
    }
 catch (    IOException ex) {
      log.error("Exception while saving bucket " + b,ex);
      throw new CacheLoaderException(ex);
    }
catch (    InterruptedException ie) {
      if (trace)       log.trace("Interrupted while marshalling a bucket");
      Thread.currentThread().interrupt();
    }
 finally {
      safeClose(fos);
    }
  }
}
