{
  File f=new File(root,b.getBucketName());
  if (f.exists()) {
    if (!deleteFile(f))     log.problemsRemovingFile(f);
  }
 else   if (log.isTraceEnabled()) {
    log.tracef("Successfully deleted file: '%s'",f.getName());
  }
  if (!b.getEntries().isEmpty()) {
    FileOutputStream fos=null;
    try {
      byte[] bytes=marshaller.objectToByteBuffer(b);
      fos=new FileOutputStream(f);
      fos.write(bytes);
      fos.flush();
    }
 catch (    IOException ex) {
      log.errorSavingBucket(b,ex);
      throw new CacheLoaderException(ex);
    }
catch (    InterruptedException ie) {
      if (trace)       log.trace("Interrupted while marshalling a bucket");
      Thread.currentThread().interrupt();
    }
 finally {
      safeClose(fos);
    }
  }
}
