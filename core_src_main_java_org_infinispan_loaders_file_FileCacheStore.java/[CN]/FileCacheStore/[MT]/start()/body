{
  super.start();
  String location=configuration.location();
  if (location == null || location.trim().length() == 0) {
    location="Infinispan-FileCacheStore";
  }
  location+=File.separator + cache.getName();
  root=new File(location);
  if (!root.exists()) {
    if (!root.mkdirs()) {
      log.problemsCreatingDirectory(root);
    }
  }
  if (!root.exists()) {
    throw new CacheConfigurationException("Directory " + root.getAbsolutePath() + " does not exist and cannot be created!");
  }
  streamBufferSize=configuration.streamBufferSize();
  FileCacheStoreConfigurationBuilder.FsyncMode fsyncMode=configuration.fsyncMode();
switch (fsyncMode) {
case DEFAULT:
    fileSync=new BufferedFileSync();
  break;
case PER_WRITE:
fileSync=new PerWriteFileSync();
break;
case PERIODIC:
fileSync=new PeriodicFileSync(configuration.fsyncInterval());
break;
}
log.debugf("Using %s file sync mode",fsyncMode);
timerService=cache.getAdvancedCache().getComponentRegistry().getTimeService();
}
