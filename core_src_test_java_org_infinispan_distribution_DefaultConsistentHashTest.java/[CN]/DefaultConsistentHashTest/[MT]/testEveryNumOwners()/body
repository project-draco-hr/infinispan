{
  for (int nodesCount=1; nodesCount < 10; nodesCount++) {
    ArrayList servers=new ArrayList(nodesCount);
    for (int i=0; i < nodesCount; i++) {
      servers.add(new TestAddress(i * 1000));
    }
    DefaultConsistentHash ch=createConsistentHash(servers);
    List<Address> sortedServers=new ArrayList<Address>(ch.getCaches());
    for (int numOwners=1; numOwners < nodesCount; numOwners++) {
      for (int i=0; i < nodesCount; i++) {
        List<Address> owners=ch.locate(sortedServers.get(i),numOwners);
        assertEquals(owners.size(),numOwners);
        for (int j=0; j < numOwners; j++) {
          assertEquals(owners.get(j),sortedServers.get((i + j) % nodesCount));
        }
      }
    }
    for (int i=0; i < nodesCount; i++) {
      List<Address> owners=ch.locate(sortedServers.get(i),nodesCount + 1);
      assertEquals(owners.size(),nodesCount);
      for (int j=0; j < nodesCount; j++) {
        assertEquals(owners.get(j),sortedServers.get((i + j) % nodesCount));
      }
    }
  }
}
