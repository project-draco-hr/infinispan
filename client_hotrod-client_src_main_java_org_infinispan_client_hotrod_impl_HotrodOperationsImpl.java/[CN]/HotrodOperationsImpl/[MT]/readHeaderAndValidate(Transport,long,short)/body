{
  short magic=transport.readByte();
  if (magic != RESPONSE_MAGIC) {
    String message="Invalid magic number. Expected " + Integer.toHexString(RESPONSE_MAGIC) + " and received "+ Integer.toHexString(magic);
    log.error(message);
    throw new InvalidResponseException(message);
  }
  long receivedMessageId=transport.readVLong();
  if (receivedMessageId != messageId) {
    String message="Invalid message id. Expected " + Long.toHexString(messageId) + " and received "+ Long.toHexString(receivedMessageId);
    log.error(message);
    throw new InvalidResponseException(message);
  }
  if (log.isTraceEnabled()) {
    log.trace("Received response for message id: " + receivedMessageId);
  }
  short receivedOpCode=transport.readByte();
  if (receivedOpCode != opRespCode) {
    if (receivedOpCode == ERROR_RESPONSE) {
      checkForErrorsInResponseStatus(transport.readByte(),messageId,transport);
      throw new IllegalStateException("Error expected! (i.e. exception in the prev statement)");
    }
    throw new InvalidResponseException("Invalid response operation. Expected " + Integer.toHexString(opRespCode) + " and received "+ Integer.toHexString(receivedOpCode));
  }
  if (log.isTraceEnabled()) {
    log.trace("Received operation code is: " + receivedOpCode);
  }
  short status=transport.readByte();
  transport.readByte();
  checkForErrorsInResponseStatus(status,messageId,transport);
  return status;
}
