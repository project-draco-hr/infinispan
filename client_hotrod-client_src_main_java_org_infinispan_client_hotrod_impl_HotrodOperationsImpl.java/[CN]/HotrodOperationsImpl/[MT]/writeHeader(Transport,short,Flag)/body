{
  transport.writeByte(REQUEST_MAGIC);
  long messageId=MSG_ID.incrementAndGet();
  transport.writeVLong(messageId);
  transport.writeByte(HOTROD_VERSION);
  transport.writeByte(operationCode);
  transport.writeArray(cacheNameBytes);
  int flagInt=0;
  if (flags != null) {
    for (    Flag flag : flags) {
      flagInt=flag.getFlagInt() | flagInt;
    }
  }
  transport.writeVInt(flagInt);
  transport.writeByte(clientIntelligence);
  transport.writeVInt(TOPOLOGY_ID.get());
  if (log.isTraceEnabled()) {
    log.trace("wrote header for message " + messageId + ". Operation code: "+ operationCode+ ". Flags: "+ Integer.toHexString(flagInt));
  }
  return messageId;
}
