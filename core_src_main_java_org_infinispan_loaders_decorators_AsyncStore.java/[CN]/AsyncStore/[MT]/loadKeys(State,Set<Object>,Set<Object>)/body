{
  if (!s.clear) {
    State next=s.next;
    if (next != null)     loadKeys(next,exclude,result);
 else     result.addAll(super.loadAllKeys(exclude));
  }
  for (  Modification mod : s.modifications.values()) {
switch (mod.getType()) {
case STORE:
      Object key=((Store)mod).getStoredEntry().getKey();
    if (exclude == null || !exclude.contains(key))     result.add(key);
  break;
case REMOVE:
result.remove(((Remove)mod).getKey());
break;
}
}
}
