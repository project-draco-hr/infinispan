{
  if (trace)   log.trace("Checking for modifications");
  boolean unlock=false;
  try {
    acquireLock(write);
    unlock=true;
    swap=state;
    state=new ConcurrentHashMap<Object,Modification>();
  }
  finally {
    if (unlock)     write.unlock();
  }
  int size=swap.size();
  if (size == 0)   awaitNotEmpty();
 else   decrementAndGet(size);
  if (trace)   log.trace("Calling put(List) with {0} modifications",size);
  put(swap);
}
