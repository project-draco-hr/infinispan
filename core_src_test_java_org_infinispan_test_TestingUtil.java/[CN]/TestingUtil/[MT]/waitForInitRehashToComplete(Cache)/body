{
  int gracetime=30000;
  long giveup=System.currentTimeMillis() + gracetime;
  for (  Cache c : caches) {
    StateTransferManager stateTransferManager=TestingUtil.extractComponent(c,StateTransferManager.class);
    RpcManager rpcManager=TestingUtil.extractComponent(c,RpcManager.class);
    while (!stateTransferManager.isJoinComplete()) {
      if (System.currentTimeMillis() > giveup) {
        String message="Timed out waiting for join to complete on node " + rpcManager.getAddress() + " !";
        log.error(message);
        throw new RuntimeException(message);
      }
      LockSupport.parkNanos(TimeUnit.SECONDS.toNanos(1));
    }
    log.trace("Node " + rpcManager.getAddress() + " finished join task.");
  }
}
