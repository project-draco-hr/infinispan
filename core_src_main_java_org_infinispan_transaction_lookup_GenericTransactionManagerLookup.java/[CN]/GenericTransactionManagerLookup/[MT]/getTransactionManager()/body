{
  if (!lookupDone)   doLookups(configuration.getClassLoader());
  if (tm != null)   return tm;
  if (lookupFailed) {
    if (!noJBossTM) {
      tryEmbeddedJBossTM();
    }
    if (noJBossTM) {
      useDummyTM();
    }
  }
  return tm;
}
