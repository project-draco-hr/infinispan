{
  GlobalTransaction thisTransaction=txContext.getGlobalTransaction();
  for (  CacheTransaction tx : transactions) {
    if (tx.getTopologyId() < transactionTopologyId) {
      if (tx.getGlobalTransaction().equals(thisTransaction))       continue;
      boolean txCompleted=false;
      long remaining;
      while ((remaining=timeService.remainingTime(expectedEndTime,TimeUnit.MILLISECONDS)) > 0) {
        if (tx.waitForLockRelease(key,remaining)) {
          txCompleted=true;
          break;
        }
      }
      if (!txCompleted) {
        throw newTimeoutException(key,txContext);
      }
    }
  }
}
