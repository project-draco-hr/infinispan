{
  checkIsOpen();
  int i=-1;
  Object ob;
  do {
    ChunkCacheKey fromChunkKey=new ChunkCacheKey(indexName,from,++i);
    ob=cache.get(fromChunkKey);
    if (ob == null) {
      break;
    }
    ChunkCacheKey toChunkKey=new ChunkCacheKey(indexName,to,i);
    cache.withFlags(Flag.SKIP_REMOTE_LOOKUP).put(toChunkKey,ob);
  }
 while (true);
  cache.startBatch();
  CacheKey fromKey=new FileCacheKey(indexName,from);
  FileMetadata metadata=(FileMetadata)cache.remove(fromKey);
  cache.put(new FileCacheKey(indexName,to),metadata);
  Set<String> fileList=getFileList();
  fileList.remove(from);
  fileList.add(to);
  createRefCountForNewFile(to);
  cache.put(fileListCacheKey,fileList);
  cache.endBatch(true);
  FileReadLockKey fileFromReadLockKey=new FileReadLockKey(indexName,from);
  InfinispanIndexInput.releaseReadLock(fileFromReadLockKey,cache);
  if (log.isTraceEnabled()) {
    log.trace("Renamed file from: {0} to: {1} in index {2}",from,to,indexName);
  }
}
