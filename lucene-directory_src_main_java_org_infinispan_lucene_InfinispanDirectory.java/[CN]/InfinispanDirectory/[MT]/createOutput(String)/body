{
  final FileCacheKey key=new FileCacheKey(indexName,name);
  FileMetadata newFileMetadata=new FileMetadata();
  FileMetadata previous=(FileMetadata)cache.putIfAbsent(key,newFileMetadata);
  if (previous == null) {
    FileReadLockKey readLockKey=new FileReadLockKey(indexName,name);
    cache.put(readLockKey,Integer.valueOf(1));
    Set<String> fileList=getFileList();
    fileList.add(name);
    cache.put(fileListCacheKey,fileList);
    return new InfinispanIndexOutput(cache,key,chunkSize,newFileMetadata);
  }
 else {
    return new InfinispanIndexOutput(cache,key,chunkSize,previous);
  }
}
