{
  if (usesValueWrapper) {
    if (oldValue instanceof ProtobufValueWrapper) {
      oldValue=((ProtobufValueWrapper)oldValue).getBinary();
    }
    if (newValue instanceof ProtobufValueWrapper) {
      newValue=((ProtobufValueWrapper)newValue).getBinary();
    }
  }
  if (eventType.isExpired()) {
    oldValue=newValue;
    newValue=null;
  }
  ObjectFilter.FilterResult f1=filterAndConvert(oldValue);
  ObjectFilter.FilterResult f2=filterAndConvert(newValue);
  ContinuousQueryResult result;
  if (f1 == null && f2 != null) {
    result=new ContinuousQueryResult(true,(byte[])key,(byte[])newValue);
  }
 else   if (f1 != null && f2 == null) {
    result=new ContinuousQueryResult(false,(byte[])key,null);
  }
 else {
    return null;
  }
  try {
    return ProtobufUtil.toByteArray(serCtx,result);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
