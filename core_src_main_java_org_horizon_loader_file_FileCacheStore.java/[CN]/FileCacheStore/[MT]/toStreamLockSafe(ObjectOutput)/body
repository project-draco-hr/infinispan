{
  try {
    File[] files=root.listFiles();
    objectOutput.writeInt(files.length);
    byte[] buffer=new byte[streamBufferSize];
    for (    File file : files) {
      int bytesRead, totalBytesRead=0;
      FileInputStream fileInStream=new FileInputStream(file);
      int sz=fileInStream.available();
      BufferedInputStream bis=new BufferedInputStream(fileInStream);
      objectOutput.writeObject(file.getName());
      objectOutput.writeInt(sz);
      while (sz > totalBytesRead) {
        bytesRead=bis.read(buffer,0,streamBufferSize);
        if (bytesRead == -1)         break;
        totalBytesRead+=bytesRead;
        objectOutput.write(buffer,0,bytesRead);
      }
      bis.close();
      fileInStream.close();
    }
  }
 catch (  IOException e) {
    throw new CacheLoaderException("I/O expcetion while generating stream",e);
  }
}
