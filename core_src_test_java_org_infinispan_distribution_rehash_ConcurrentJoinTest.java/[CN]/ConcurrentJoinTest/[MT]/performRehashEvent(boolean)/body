{
  joinerManagers=new CopyOnWriteArrayList<EmbeddedCacheManager>();
  joiners=new CopyOnWriteArrayList<Cache<Object,String>>(new Cache[NUM_JOINERS]);
  for (int i=0; i < NUM_JOINERS; i++) {
    EmbeddedCacheManager joinerManager=addClusterEnabledCacheManager(new TransportFlags().withFD(false));
    joinerManager.defineConfiguration(cacheName,configuration);
    joinerManagers.add(joinerManager);
    joiners.set(i,null);
  }
  Thread[] threads=new Thread[NUM_JOINERS];
  for (int i=0; i < NUM_JOINERS; i++) {
    final int ii=i;
    threads[i]=new Thread(new Runnable(){
      public void run(){
        EmbeddedCacheManager joinerManager=joinerManagers.get(ii);
        Cache<Object,String> joiner=joinerManager.getCache(cacheName);
        joiners.set(ii,joiner);
      }
    }
,"ConcurrentJoinTest-Worker-" + i);
  }
  for (int i=0; i < NUM_JOINERS; i++) {
    threads[i].start();
  }
  for (int i=0; i < NUM_JOINERS; i++) {
    try {
      threads[i].join();
    }
 catch (    InterruptedException e) {
      Thread.currentThread().interrupt();
    }
  }
}
