{
  int status;
  DummyTransaction tx=getTransaction();
  if (tx == null)   throw new IllegalStateException("thread not associated with transaction");
  status=tx.getStatus();
  if (status == Status.STATUS_MARKED_ROLLBACK) {
    tx.setStatus(Status.STATUS_ROLLEDBACK);
    rollback();
    throw new RollbackException("Transaction status is Status.STATUS_MARKED_ROLLBACK");
  }
 else {
    tx.commit();
  }
  setTransaction(null);
}
