{
  CacheEntry entry=container.get(key);
  DeltaAware containerValue=entry == null ? null : (DeltaAware)entry.getValue();
  if (containerValue != null && containerValue != value) {
    value=containerValue;
  }
  if (value != null && !deltas.isEmpty()) {
    final boolean makeCopy=value instanceof CopyableDeltaAware;
    if (makeCopy) {
      value=((CopyableDeltaAware)value).copy();
    }
    for (    Delta delta : deltas) {
      delta.merge(value);
    }
    if (makeCopy) {
      container.put(key,value,extractMetadata(entry,metadata));
    }
    value.commit();
    if (wrappedEntry != null) {
      wrappedEntry.setChanged(!makeCopy);
    }
  }
  reset();
  if (wrappedEntry != null) {
    wrappedEntry.commit(container,metadata);
  }
}
