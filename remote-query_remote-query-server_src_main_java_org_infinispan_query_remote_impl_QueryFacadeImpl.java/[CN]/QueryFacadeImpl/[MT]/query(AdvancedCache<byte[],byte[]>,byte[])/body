{
  try {
    SerializationContext serCtx=ProtobufMetadataManagerImpl.getSerializationContextInternal(cache.getCacheManager());
    QueryRequest request=ProtobufUtil.fromByteArray(serCtx,query,0,query.length,QueryRequest.class);
    Configuration cacheConfiguration=SecurityActions.getCacheConfiguration(cache);
    boolean isIndexed=cacheConfiguration.indexing().index().isEnabled();
    boolean isCompatMode=cacheConfiguration.compatibility().enabled();
    SearchManager searchManager=isIndexed ? Search.getSearchManager(cache) : null;
    Query q=new RemoteQueryEngine(cache,searchManager,isCompatMode,serCtx).buildQuery(null,request.getJpqlString(),request.getStartOffset(),request.getMaxResults());
    QueryResponse response=makeResponse(q);
    return ProtobufUtil.toByteArray(serCtx,response);
  }
 catch (  IOException e) {
    throw log.errorExecutingQuery(e);
  }
}
